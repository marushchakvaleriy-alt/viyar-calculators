<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Калькулятор поінтів — Viyar</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1976d2 0%, #1565c0 50%, #0d47a1 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        .main-container {
            width: 100%;
            max-width: 1200px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            position: relative;
            z-index: 1;
        }

        .calculator-selector {
            text-align: center;
            padding: 60px 40px;
            background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
            color: white;
            position: relative;
            overflow: hidden;
        }

        /* Хлопчик замість VIYAR */
        .flying-logo {
            position: absolute;
            top: 15px;
            left: 30px;
            z-index: 15;
        }

        .flying-logo-right {
            position: absolute;
            top: 15px;
            right: 50px;
            z-index: 15;
        }

        .flying-logo img {
            height: 80px;
            width: auto;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
        }
        
        .flying-logo-right img {
            height: 150px;
            width: auto;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
        }

        .selector-title {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 10px;
            color: white;
        }

        .selector-subtitle {
            font-size: 20px;
            margin-bottom: 40px;
            opacity: 0.95;
            font-weight: 500;
        }

        .calculator-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .calculator-option {
            background: white;
            color: #333;
            padding: 40px 30px;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.4s;
            box-shadow: 0 8px 25px rgba(25, 118, 210, 0.1);
            position: relative;
            overflow: hidden;
            border: 2px solid transparent;
            text-decoration: none;
            display: block;
        }

        .calculator-option:hover {
            transform: translateY(-12px) scale(1.02);
            box-shadow: 0 25px 50px rgba(25, 118, 210, 0.2);
            border-color: #1976d2;
            text-decoration: none;
            color: #333;
        }

        .option-icon img {
            max-width: 100%;
            max-height: 80px;
            display: block;
            margin: 0 auto 20px auto;
        }

        .option-title {
            font-size: 24px;
            font-weight: 600;
            color: #1976d2;
            margin-bottom: 12px;
        }

        .option-description {
            font-size: 16px;
            color: #6b7280;
            line-height: 1.5;
        }

        .calculator-option.coming-soon {
            position: relative;
            opacity: 0.7;
        }

        .calculator-option.coming-soon::after {
            content: "Скоро";
            position: absolute;
            top: 15px;
            right: 15px;
            background: #ff9800;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .calculator-option.coming-soon:hover {
            transform: translateY(-8px) scale(1.01);
            opacity: 0.8;
        }

        /* Адаптивність */
        @media (max-width: 768px) {
            .calculator-selector {
                padding: 40px 20px;
            }

            .selector-title {
                font-size: 28px;
            }

            .selector-subtitle {
                font-size: 18px;
            }

            .calculator-options {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .calculator-option {
                padding: 30px 20px;
            }

            .flying-logo img {
                height: 60px;
                filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
            }
            
            .flying-logo-right {
                right: 45px;
            }
            
            .flying-logo-right img {
                height: 100px;
                filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
            }
        }

        /* Медіа-запит для мобільних телефонів */
        @media (max-width: 480px) {
            .flying-logo {
                top: 8px;
                left: 10px;
            }
            
            .flying-logo img {
                height: 30px;
            }
            
            .flying-logo-right {
                top: 8px;
                right: 15px;
            }
            
            .flying-logo-right img {
                height: 50px;
            }
            
            .settings-btn {
                top: 12px;
                right: 12px;
                font-size: 18px;
            }
        }

        /* Медіа-запит для дуже маленьких екранів */
        @media (max-width: 360px) {
            .flying-logo {
                top: 5px;
                left: 8px;
            }
            
            .flying-logo img {
                height: 25px;
            }
            
            .flying-logo-right {
                top: 5px;
                right: 10px;
            }
            
            .flying-logo-right img {
                height: 40px;
            }
            
            .settings-btn {
                top: 8px;
                right: 8px;
                font-size: 16px;
            }
        }

        /* Анімації */
        .fade-in {
            animation: fadeIn 0.6s ease-in;
        }

        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(30px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        .bounce-in {
            animation: bounceIn 0.8s ease-out;
        }

        @keyframes bounceIn {
            0% { 
                opacity: 0; 
                transform: scale(0.3); 
            }
            50% { 
                opacity: 1; 
                transform: scale(1.05); 
            }
            70% { 
                transform: scale(0.9); 
            }
            100% { 
                opacity: 1; 
                transform: scale(1); 
            }
        }

        /* Додаткові стилі для красивого вигляду */
        .calculator-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .calculator-option:hover::before {
            left: 100%;
        }

        /* Стилі для налаштувань */
        .settings-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            padding: 0;
            cursor: pointer;
            font-size: 24px;
            font-weight: 600;
            transition: all 0.3s ease;
            z-index: 20;
            width: auto;
            height: auto;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .settings-btn:hover {
            color: rgba(255, 255, 255, 0.8);
            transform: scale(1.1);
        }

        /* Модальне вікно налаштувань */
        .settings-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease-out;
        }

        .settings-content {
            background: white;
            border-radius: 20px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            animation: slideUp 0.3s ease-out;
        }

        .settings-header {
            background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .settings-header h2 {
            margin: 0;
            font-size: 24px;
            font-weight: 600;
        }

        .settings-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .settings-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .settings-body {
            padding: 0;
            max-height: 60vh;
            overflow: hidden;
        }

        /* Вкладки */
        .tabs-container {
            display: flex;
            background: #f8fafc;
            border-bottom: 1px solid #e5e7eb;
        }

        .tab-button {
            flex: 1;
            padding: 15px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #6b7280;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .tab-button img {
            width: 20px;
            height: 20px;
            object-fit: contain;
        }

        .tab-button:hover {
            background: #e5e7eb;
            color: #374151;
        }

        .tab-button.active {
            color: #1976d2;
            border-bottom-color: #1976d2;
            background: white;
        }

        .tab-content {
            display: none;
            padding: 30px;
            max-height: 50vh;
            overflow-y: auto;
        }

        .tab-content.active {
            display: block;
        }

        .calculator-section {
            margin-bottom: 0;
            border: none;
        }

        .calculator-section-header {
            display: none; /* Прибираємо заголовки, оскільки тепер є вкладки */
        }

        .points-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            padding: 20px;
        }

        .points-section {
            margin-bottom: 30px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
        }

        .points-section-header {
            background: #f8fafc;
            padding: 15px 20px;
            border-bottom: 1px solid #e5e7eb;
            font-weight: 600;
            font-size: 16px;
            color: #374151;
        }

        .points-section-content {
            padding: 20px;
        }

        .points-section-content .points-grid {
            padding: 0;
            gap: 12px;
        }

        .point-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: #f9fafb;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        .point-label {
            font-size: 14px;
            color: #374151;
            flex: 1;
            margin-right: 10px;
        }

        .point-input {
            width: 80px;
            padding: 6px 10px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            text-align: center;
            font-size: 14px;
        }

        .point-input:focus {
            outline: none;
            border-color: #1976d2;
            box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.1);
        }

        .settings-actions {
            padding: 20px 30px;
            background: #f8fafc;
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            border-top: 1px solid #e5e7eb;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #1976d2;
            color: white;
        }

        .btn-primary:hover {
            background: #1565c0;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        @media (max-width: 768px) {
            .settings-btn {
                top: 15px;
                right: 15px;
                font-size: 20px;
            }

            .settings-content {
                width: 95%;
                margin: 20px;
            }

            .settings-body {
                padding: 0;
            }

            .tabs-container {
                flex-wrap: wrap;
            }

            .tab-button {
                flex: 1 1 50%;
                padding: 12px 8px;
                font-size: 12px;
            }

            .tab-content {
                padding: 20px;
                max-height: 45vh;
            }

            .points-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .point-item {
                padding: 8px 12px;
            }

            .point-label {
                font-size: 13px;
            }

            .point-input {
                width: 70px;
                padding: 4px 8px;
                font-size: 13px;
            }

            .settings-actions {
                flex-direction: column;
                padding: 15px 20px;
            }

            .btn {
                padding: 8px 16px;
                font-size: 13px;
            }
        }

    </style>
</head>
<body>
    <div class="main-container">
        <!-- Екран вибору калькулятора -->
        <div class="calculator-selector">
            <!-- Logo в лівому куті -->
            <div class="flying-logo">
                <img src="калькулятори/Картинки/logo.svg" alt="VIYAR Logo">
            </div>
            
            <!-- Хлопчик в правому куті -->
            <div class="flying-logo-right">
                <img src="калькулятори/Картинки/hlopchyk.png" alt="Хлопчик">
            </div>
            
            <h1 class="selector-title">
                Калькулятор
            </h1>
            <p class="selector-subtitle">Розраховуй і створюй — легко, швидко, зручно</p>
            
            <div class="calculator-options">
                <!-- Кухня -->
                <a href="калькулятори/калькулятор кухні.html" class="calculator-option bounce-in">
                    <div class="option-icon">
                        <img src="калькулятори/Картинки/кухня.png" alt="Кухня">
                    </div>
                    <div class="option-title">Кухня</div>
                    <div class="option-description">
                        Детальний калькулятор для розрахунку поінтів кухонних меблів з усіма опціями
                    </div>
                </a>
                
                <!-- Шафа -->
                <a href="калькулятори/калькулятор шафи гардероби.html" class="calculator-option bounce-in">
                    <div class="option-icon">
                        <img src="калькулятори/Картинки/шафа.png" alt="Шафа">
                    </div>
                    <div class="option-title">Шафа-гардероб</div>
                    <div class="option-description">
                        Професійний калькулятор для розрахунку поінтів шаф та гардеробних кімнат з повним функціоналом
                    </div>
                </a>
                
                <!-- Інші меблі -->
                <a href="калькулятори/інші меблі.html" class="calculator-option bounce-in">
                    <div class="option-icon">
                        <img src="калькулятори/Картинки/інші меблі.png" alt="Інші меблі">
                    </div>
                    <div class="option-title">Інші меблі</div>
                    <div class="option-description">
                        Універсальний калькулятор для розрахунку поінтів різних типів меблів
                    </div>
                </a>
                
                <!-- Гардиробні системи -->
                <a href="калькулятори/гардеробні системи.html" class="calculator-option bounce-in">
                    <div class="option-icon">
                        <img src="калькулятори/Картинки/гардеробні системи.png" alt="Гардиробні системи">
                    </div>
                    <div class="option-title">Гардиробні системи</div>
                    <div class="option-description">
                        Спеціалізований калькулятор для розрахунку поінтів гардиробних систем з інтегрованими елементами
                    </div>
                </a>
                
                <!-- Стінові панелі -->
                <a href="калькулятори/калькулятор стінових панелей.html" class="calculator-option bounce-in">
                    <div class="option-icon">
                        <img src="калькулятори/Картинки/стінові панелі.png" alt="Стінові панелі">
                    </div>
                    <div class="option-title">Стінові панелі</div>
                    <div class="option-description">
                        Професійний калькулятор для розрахунку матеріалів та вартості стінових панелей
                    </div>
                </a>
                
                <!-- Ліжко -->
                <div class="calculator-option coming-soon bounce-in">
                    <div class="option-icon">
                        <img src="калькулятори/Картинки/ліжко.png" alt="Ліжко">
                    </div>
                    <div class="option-title">Ліжко</div>
                    <div class="option-description">
                        Калькулятор для розрахунку поінтів ліжок та спальних меблів
                    </div>
                </div>
            </div>
            
            <!-- Кнопка налаштувань -->
            <button class="settings-btn" onclick="openSettings()">
                ⚙️
            </button>
        </div>
    </div>

    <!-- Модальне вікно налаштувань -->
    <div id="settingsModal" class="settings-modal">
        <div class="settings-content">
            <div class="settings-header">
                <h2>⚙️ Налаштування поінтів</h2>
                <button class="settings-close" onclick="closeSettings()">&times;</button>
            </div>
            <div class="settings-body">
                <!-- Вкладки -->
                <div class="tabs-container">
                    <button class="tab-button active" onclick="switchTab('kitchen')">
                        <img src="калькулятори/Картинки/кухня.png" alt="Кухня">
                        Кухня
                    </button>
                    <button class="tab-button" onclick="switchTab('wardrobe')">
                        <img src="калькулятори/Картинки/шафа.png" alt="Шафа">
                        Шафа
                    </button>
                    <button class="tab-button" onclick="switchTab('wardrobeSystems')">
                        <img src="калькулятори/Картинки/гардеробні системи.png" alt="Гардеробні системи">
                        Системи
                    </button>
                    <button class="tab-button" onclick="switchTab('wallPanels')">
                        <img src="калькулятори/Картинки/стінові панелі.png" alt="Стінові панелі">
                        Панелі
                    </button>
                    <button class="tab-button" onclick="switchTab('otherFurniture')">
                        <img src="калькулятори/Картинки/інші меблі.png" alt="Інші меблі">
                        Меблі
                    </button>
                </div>

                <!-- Контент вкладок -->
                <div id="kitchenTab" class="tab-content active">
                    <div class="calculator-section">
                        <div class="points-grid" id="kitchenPoints">
                            <!-- Поінти для кухні будуть додані через JavaScript -->
                        </div>
                    </div>
                </div>
                
                <div id="wardrobeTab" class="tab-content">
                    <div class="calculator-section">
                        <div class="points-grid" id="wardrobePoints">
                            <!-- Поінти для шафи будуть додані через JavaScript -->
                        </div>
                    </div>
                </div>
                
                <div id="wardrobeTab" class="tab-content">
                    <div class="calculator-section">
                        <div class="points-grid" id="wardrobePoints">
                            <!-- Поінти для шафи будуть додані через JavaScript -->
                        </div>
                    </div>
                </div>
                
                <div id="otherFurnitureTab" class="tab-content">
                    <div class="calculator-section">
                        <div class="points-grid" id="otherFurniturePoints">
                            <!-- Поінти для інших меблів будуть додані через JavaScript -->
                        </div>
                    </div>
                </div>
                
                <div id="wardrobeSystemsTab" class="tab-content">
                    <div class="calculator-section">
                        <div class="points-grid" id="wardrobeSystemsPoints">
                            <!-- Поінти для гардиробних систем будуть додані через JavaScript -->
                        </div>
                    </div>
                </div>
                
                <div id="wallPanelsTab" class="tab-content">
                    <div class="calculator-section">
                        <div class="points-grid" id="wallPanelsPoints">
                            <!-- Поінти для стінових панелей будуть додані через JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="settings-actions">
                <button class="btn btn-primary" onclick="saveSettings()">💾 Зберегти</button>
                <button class="btn btn-success" onclick="downloadSettings()">📥 Завантажити файл</button>
                <button class="btn btn-secondary" onclick="resetToDefaults()">🔄 Скинути</button>
                <button class="btn btn-secondary" onclick="closeSettings()">❌ Закрити</button>
            </div>
        </div>
    </div>

    <!-- Підключаємо спільну бібліотеку налаштувань -->
    <script src="калькулятори/налаштування/calculator-settings.js"></script>

    <script>
        // Додаємо анімації при завантаженні
        document.addEventListener('DOMContentLoaded', function() {
            const options = document.querySelectorAll('.calculator-option');
            options.forEach((option, index) => {
                option.style.animationDelay = `${index * 0.1}s`;
            });
            
            // Завантажуємо налаштування при старті
            loadSettings();
        });

        // Обробка кліків на "Скоро"
        document.querySelectorAll('.coming-soon').forEach(option => {
            option.addEventListener('click', function(e) {
                e.preventDefault();
                showComingSoonMessage();
            });
        });

        function showComingSoonMessage() {
            alert(`🚧 Калькулятор знаходиться в розробці!\n\nЦей калькулятор буде доступний найближчим часом.\n\nДякуємо за розуміння! 😊`);
        }

        // Додаємо ефект при наведенні
        document.querySelectorAll('.calculator-option:not(.coming-soon)').forEach(option => {
            option.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-12px) scale(1.02)';
            });
            
            option.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0) scale(1)';
            });
        });

        // ===== ФУНКЦІЇ НАЛАШТУВАНЬ =====
        
        let currentSettings = {};

        // Відкриття модального вікна налаштувань
        function openSettings() {
            // Перевіряємо пароль
            const passwordValid = checkPassword();
            if (!passwordValid) {
                return;
            }
            
            document.getElementById('settingsModal').style.display = 'flex';
            loadSettingsOld();
            // Показуємо першу вкладку
            switchTab('kitchen');
        }
        // Перемикання вкладок
        function switchTab(tabName) {
            // Прибираємо активний клас з усіх кнопок та контенту
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Додаємо активний клас до обраної вкладки
            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        // Система паролів для налаштувань
        let settingsPassword = null;

        // Функція для отримання пароля з налаштувань
        function getPasswordFromSettings() {
            try {
                // Використовуємо глобальну функцію з calculator-settings.js
                if (typeof loadCalculatorSettings === 'function') {
                    const settings = loadCalculatorSettings();
                    return settings.password ? settings.password.value : "1111";
                }
                return "1111"; // За замовчуванням
            } catch (error) {
                console.error('Помилка завантаження пароля:', error);
                return "1111"; // За замовчуванням
            }
        }

        // Функція для завантаження налаштувань (стара логіка)
        function loadSettingsOld() {
            // Завжди завантажуємо з бібліотеки
            currentSettings = loadCalculatorSettings();
            
            // Заповнюємо всі секції
            Object.keys(currentSettings).forEach(calcType => {
                const container = document.getElementById(calcType + 'Points');
                if (container) {
                    container.innerHTML = '';
                    
                    // Динамічно групуємо поінти по розділах
                    const sections = groupPointsBySections(currentSettings[calcType]);
                    
                    // Створюємо секції
                    Object.keys(sections).forEach(sectionName => {
                        const sectionPoints = sections[sectionName];
                        
                        // Якщо є поінти для цього розділу, створюємо секцію
                        if (Object.keys(sectionPoints).length > 0) {
                            const sectionDiv = document.createElement('div');
                            sectionDiv.className = 'points-section';
                            
                            const headerDiv = document.createElement('div');
                            headerDiv.className = 'points-section-header';
                            headerDiv.textContent = sectionName;
                            
                            const contentDiv = document.createElement('div');
                            contentDiv.className = 'points-section-content';
                            
                            const gridDiv = document.createElement('div');
                            gridDiv.className = 'points-grid';
                            
                            // Додаємо поінти до сітки
                            Object.keys(sectionPoints).forEach(pointId => {
                                const point = sectionPoints[pointId];
                                const pointItem = document.createElement('div');
                                pointItem.className = 'point-item';
                                pointItem.innerHTML = `
                                    <label for="${pointId}">${point.label}</label>
                                    <input type="number" id="${pointId}" value="${point.value}" min="0" step="1">
                                `;
                                gridDiv.appendChild(pointItem);
                            });
                            
                            contentDiv.appendChild(gridDiv);
                            sectionDiv.appendChild(headerDiv);
                            sectionDiv.appendChild(contentDiv);
                            container.appendChild(sectionDiv);
                        }
                    });
                }
            });
        }

        // Функція для встановлення пароля
        async function setPassword() {
            const password = prompt('Введіть пароль для налаштувань:');
            if (password) {
                // Оновлюємо налаштування з паролем
                if (!currentSettings.password) {
                    currentSettings.password = { value: password, label: "Пароль для налаштувань" };
                } else {
                    currentSettings.password.value = password;
                }
                
                // Зберігаємо в налаштування
                updateCalculatorSettings(currentSettings);
                generateUpdatedJSFile();
                
                settingsPassword = password;
                alert('✅ Пароль встановлено та збережено в налаштуваннях!');
            }
        }

        // Функція для перевірки пароля
        function checkPassword() {
            // Отримуємо пароль з налаштувань
            const savedPassword = getPasswordFromSettings();
            
            const enteredPassword = prompt('Введіть пароль для доступу до налаштувань:');
            if (enteredPassword === savedPassword) {
                settingsPassword = savedPassword;
                return true;
            } else {
                alert('❌ Невірний пароль!');
                return false;
            }
        }

        // Закриття модального вікна налаштувань
        function closeSettings() {
            document.getElementById('settingsModal').style.display = 'none';
        }

        // Завантаження налаштувань з бібліотеки
        // Функція для динамічного групування поінтів по розділах
        function groupPointsBySections(points) {
            const sections = {};
            
            Object.keys(points).forEach(pointId => {
                const point = points[pointId];
                
                // Визначаємо розділ на основі ID поінта
                let sectionName = "Інші";
                
                if (pointId.startsWith('p_forma_') || pointId.startsWith('p_geo') || 
                    pointId.startsWith('p_vent') || pointId.startsWith('p_bez_zamiriv') || 
                    pointId.startsWith('p_zamir_') || pointId.startsWith('p_island') ||
                    pointId.startsWith('p_installation_') || pointId.startsWith('p_attic')) {
                    sectionName = "1. Основні параметри";
                } else if (pointId.startsWith('p_mat_') || pointId.startsWith('p_facade_')) {
                    sectionName = "2. Матеріали";
                } else if (pointId.startsWith('p_tabletop_')) {
                    sectionName = "3. Стільниці";
                } else if (pointId.startsWith('p_fartukh_')) {
                    sectionName = "4. Фартух";
                } else if (pointId.startsWith('p_mod_')) {
                    sectionName = "5. Корпуса-модулі";
                } else if (pointId.startsWith('p_false_') || pointId.startsWith('p_detail_') || 
                          pointId.startsWith('p_metal_')) {
                    sectionName = "6. Додаткові елементи";
                } else if (pointId.startsWith('p_furn_')) {
                    sectionName = "7. Функціональна фурнітура";
                } else if (pointId.startsWith('p_handle_')) {
                    sectionName = "8. Ручки";
                } else if (pointId.startsWith('p_light_')) {
                    sectionName = "9. Підсвітка";
                } else if (pointId.startsWith('p_appliance')) {
                    sectionName = "10. Вбудована техніка";
                }
                
                if (!sections[sectionName]) {
                    sections[sectionName] = {};
                }
                sections[sectionName][pointId] = point;
            });
            
            return sections;
        }

        async function loadSettings() {
            try {
                // Завжди завантажуємо з бібліотеки
                currentSettings = await loadCalculatorSettings();
                
                // Встановлюємо пароль "1111" за замовчуванням якщо його немає
                if (!currentSettings.password) {
                    currentSettings.password = { value: "1111", label: "Пароль для налаштувань" };
                }
                
                // Заповнюємо всі секції
                Object.keys(currentSettings).forEach(calcType => {
                    const container = document.getElementById(calcType + 'Points');
                    if (container) {
                        container.innerHTML = '';
                        
                        // Динамічно групуємо поінти по розділах
                        const sections = groupPointsBySections(currentSettings[calcType]);
                        
                        // Створюємо секції
                        Object.keys(sections).forEach(sectionName => {
                            const sectionPoints = sections[sectionName];
                            
                            // Якщо є поінти для цього розділу, створюємо секцію
                            if (Object.keys(sectionPoints).length > 0) {
                                const sectionDiv = document.createElement('div');
                                sectionDiv.className = 'points-section';
                                
                                const headerDiv = document.createElement('div');
                                headerDiv.className = 'points-section-header';
                                headerDiv.textContent = sectionName;
                                
                                const contentDiv = document.createElement('div');
                                contentDiv.className = 'points-section-content';
                                
                                const gridDiv = document.createElement('div');
                                gridDiv.className = 'points-grid';
                                
                                // Додаємо поінти до сітки
                                Object.keys(sectionPoints).forEach(pointId => {
                                    const point = sectionPoints[pointId];
                                    const pointItem = document.createElement('div');
                                    pointItem.className = 'point-item';
                                    pointItem.innerHTML = `
                                        <label for="${pointId}">${point.label}</label>
                                        <input type="number" id="${pointId}" value="${point.value}" min="0" step="1">
                                    `;
                                    gridDiv.appendChild(pointItem);
                                });
                                
                                contentDiv.appendChild(gridDiv);
                                sectionDiv.appendChild(headerDiv);
                                sectionDiv.appendChild(contentDiv);
                                container.appendChild(sectionDiv);
                            }
                        });
                    }
                });
            } catch (error) {
                console.error('Помилка завантаження налаштувань:', error);
                alert('❌ Помилка завантаження налаштувань. Перевірте, чи існує файл calculator-settings.js');
            }
        }

        // Збереження налаштувань




        function saveSettings() {
            try {
                // Збираємо дані з усіх полів
                Object.keys(currentSettings).forEach(calcType => {
                    Object.keys(currentSettings[calcType]).forEach(pointId => {
                        const input = document.getElementById(pointId);
                        if (input) {
                            currentSettings[calcType][pointId].value = parseInt(input.value) || 0;
                        }
                    });
                });
                
                // Оновлюємо бібліотеку
                updateCalculatorSettings(currentSettings);
                
                // Генеруємо оновлений JS файл
                generateUpdatedJSFile();
                
                alert('✅ Налаштування збережено локально!\n\n💾 Завантажте файл calculator-settings.js та замініть ним старий файл в папці "калькулятори/налаштування/".\n\n🔄 Після заміни файлу на GitHub всі калькулятори отримають нові налаштування!');
            } catch (error) {
                console.error('Помилка збереження налаштувань:', error);
                alert('❌ Помилка збереження налаштувань. Спробуйте ще раз.');
            }
        }

        // Завантаження файлу налаштувань
        function downloadSettings() {
            // Перевіряємо пароль
            const passwordValid = checkPassword();
            if (!passwordValid) {
                return;
            }
            
            // Генеруємо файл
            const jsContent = generateUpdatedJSFile();
            
            // Створюємо файл для завантаження
            const blob = new Blob([jsContent], { type: 'application/javascript' });
            const url = URL.createObjectURL(blob);
            
            // Створюємо посилання для завантаження
            const a = document.createElement('a');
            a.href = url;
            a.download = 'calculator-settings.js';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('✅ Файл calculator-settings.js завантажено!\n\n📁 Замініть ним старий файл в папці "калькулятори/налаштування/" на GitHub');
        }

        // Скидання до стандартних значень
        function resetToDefaults() {
            alert('❌ Функція скидання до стандартних значень тимчасово недоступна.\n\nВсі налаштування зберігаються в файлі calculator-settings.js.');
        }

        // Функція для генерації оновленого JS файлу
        function generateUpdatedJSFile() {
            // Додаємо пароль до налаштувань якщо він є, або встановлюємо "1111" за замовчуванням
            if (!currentSettings.password) {
                currentSettings.password = { value: "1111", label: "Пароль для налаштувань" };
            }
            
            // Генеруємо JS код з поточними налаштуваннями
            let jsContent = `// Централізована бібліотека поінтів для всіх калькуляторів
// Дані зберігаються тут і можуть редагуватися через налаштування

let calculatorSettings = ${JSON.stringify(currentSettings, null, 4)};

// Функція для отримання поточних налаштувань
function loadCalculatorSettings() {
    return calculatorSettings;
}

// Функція для отримання значення поінтів за ID
function getSettingValue(id) {
    const settings = loadCalculatorSettings();
    console.log('✅ Використовую бібліотеку налаштувань для ID:', id);
    
    // Визначаємо тип калькулятора на основі контексту
    let calcType = 'wardrobe'; // за замовчуванням
    
    // Спроба визначити тип калькулятора з URL або інших індикаторів
    if (window.location.pathname.includes('кухні') || window.location.pathname.includes('kitchen')) {
        calcType = 'kitchen';
    } else if (window.location.pathname.includes('шафи гардероби') || window.location.pathname.includes('wardrobe')) {
        calcType = 'wardrobe';
    } else if (window.location.pathname.includes('інші меблі') || window.location.pathname.includes('other')) {
        calcType = 'otherFurniture';
    } else if (window.location.pathname.includes('гардеробні системи') || window.location.pathname.includes('wardrobe-systems')) {
        calcType = 'wardrobeSystems';
    } else if (window.location.pathname.includes('стінових панелей') || window.location.pathname.includes('wall-panels')) {
        calcType = 'wallPanels';
    }
    
    console.log('🔍 Тип калькулятора:', calcType);
    
    // Шукаємо значення в налаштуваннях
    if (settings[calcType] && settings[calcType][id]) {
        console.log('✅ Знайдено значення для', id, ':', settings[calcType][id].value);
        return settings[calcType][id].value;
    }
    
    // Якщо не знайдено, шукаємо в усіх типах калькуляторів
    for (const type in settings) {
        if (settings[type][id]) {
            return settings[type][id].value;
        }
    }
    
    // Якщо все ще не знайдено, повертаємо стандартне значення
    console.warn('⚠️ Не знайдено значення для', id, ', використовую стандартне значення: 1');
    return 1;
}

// Функція для оновлення налаштувань (використовується в налаштуваннях)
function updateCalculatorSettings(newSettings) {
    calculatorSettings = newSettings;
}

// Функція для отримання копії налаштувань (для редагування)
function getCalculatorSettingsCopy() {
    return JSON.parse(JSON.stringify(calculatorSettings));
}`;

            // Створюємо та завантажуємо файл
            const blob = new Blob([jsContent], { type: 'application/javascript' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'calculator-settings.js';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Експорт налаштувань
        function exportSettings() {
            const dataStr = JSON.stringify(currentSettings, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'calculator-settings-backup.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        // Закриття модального вікна при кліку поза ним
        window.onclick = function(event) {
            const modal = document.getElementById('settingsModal');
            if (event.target === modal) {
                closeSettings();
            }
        }
        // Завантажуємо налаштування при завантаженні сторінки
        loadSettingsOld();
    </script>

</body>
</html>
