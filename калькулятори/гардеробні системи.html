<html lang="uk">
<head>
<!-- Refactored on 2025-10-03T09:07:53. Styles moved to <head>; scripts moved to end of <body>. Logic & interface preserved. -->

<meta charset="utf-8"/>
<title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–æ—ñ–Ω—Ç—ñ–≤ ‚Äî Viyar</title>

    </style>
  
  <!-- –î–æ–¥–∞—Ç–∏ jsPDF –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É -->
  
  
<style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f3f4f6;
      font-size: 14px;
    }
    .wrapper {
      max-width: 1100px;
      margin: 20px auto;
      background: white;
      padding: 10px 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    header {
      padding: 10px 0;
      position: relative;
      background: white;
    }
    .title-small {
      font-size: 12px;
      color: #4b5563;
      margin-bottom: 4px;
    }
    .header-line {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }
    header img { height: 32px; }
    header label { margin-left: 6px; font-size: 13px; }
    input, select {
      font-size: 14px;
      padding: 6px 10px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      background: #fff;
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    input:focus, select:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 2px rgba(37,99,235,0.2);
    }
    header input { width: 110px; }
    button {
      background: #2563eb;
      color: white;
      border: none;
      padding: 6px 14px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
    }
    button:hover { background: #1d4ed8; }
    .section { margin: 20px 0; }
    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      align-items: start;
    }
    .facade-list label {
      display: block;
      margin: 8px 0 4px;
    }
    .hidden { display: none; }
        /* –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ - —Å—É—á–∞—Å–Ω–∏–π –¥–∏–∑–∞–π–Ω */
        .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px);
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-content {
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      padding: 0;
      border-radius: 16px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow: hidden;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
      animation: slideUp 0.3s ease-out;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    @keyframes slideUp {
      from { 
        transform: translateY(30px);
        opacity: 0;
      }
      to { 
        transform: translateY(0);
        opacity: 1;
      }
    }

    .modal-header {
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      color: white;
      padding: 20px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .modal-header h3 {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
      color: white;
    }

    /* –°—Ç–∏–ª—ñ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è (√ó) */
    .remove-btn {
      background: none !important;
      border: none !important;
      color: #000 !important;
      font-size: 16px !important;
      cursor: pointer !important;
      padding: 2px 6px !important;
      margin-left: 8px !important;
      border-radius: 0 !important;
      font-weight: bold !important;
    }
    .remove-btn:hover {
      color: #dc2626 !important;
      background: none !important;
    }
  
    .settings-modal { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; background: rgba(0,0,0,.35); z-index: 9999; }
    .settings-content { position: relative; background:#fff; padding:16px 20px; border-radius:12px; max-width:720px; width:95%; max-height:80vh; overflow:auto; box-shadow:0 10px 30px rgba(0,0,0,.2); }
    .settings-close { position:absolute; top:10px; right:12px; border:none; background:transparent; font-size:20px; line-height:1; cursor:pointer; color:#6b7280; }
    .settings-close:hover { color:#111827; }
  
    .header-bar { display:flex; align-items:center; justify-content:space-between; gap:12px; }
    .points-hud { display:inline-block; padding:8px 14px; border-radius:999px; background:#eef2ff; color:#1d4ed8; font-weight:700; border:1px solid #c7d2fe; font-size:16px; }
    @media (max-width:640px){ .points-hud { font-size:12px; padding:4px 8px; } }
    
    /* –ö–Ω–æ–ø–∫–∞ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è */
    .back-button {
      position: fixed;
      top: 15px;
      left: 15px;
      z-index: 1000;
      background: #1976d2;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      color: white;
      text-decoration: none;
      font-size: 18px;
      font-weight: bold;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(25, 118, 210, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      line-height: 1;
    }

    .back-button:hover {
      background: #1565c0;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(25, 118, 210, 0.4);
      text-decoration: none;
      color: white;
    }

    @media (max-width: 768px) {
      .back-button {
        top: 10px;
        left: 10px;
        width: 35px;
        height: 35px;
        font-size: 16px;
      }
    }
    
   /* –ü—ñ–¥–∫–∞–∑–∫–∏ */
   .tooltip-container {
      position: relative;
      display: inline-block;
      margin-left: 5px;
    }
    .tooltip-icon {
      display: inline-block;
      width: 16px;
      height: 16px;
      background: #6b7280;
      color: white;
      border-radius: 50%;
      text-align: center;
      line-height: 16px;
      font-size: 12px;
      font-weight: bold;
      cursor: help;
      vertical-align: middle;
    }
    .tooltip-icon:hover {
      background: #374151;
    }
    .tooltip-content {
      position: absolute;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      background: #1f2937;
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 12px;
      line-height: 1.4;
      white-space: nowrap;
      max-width: 300px;
      white-space: normal;
      z-index: 1000;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s, visibility 0.3s;
    }
    .tooltip-content::after {
      content: "";
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      border: 5px solid transparent;
      border-top-color: #1f2937;
    }
    .tooltip-container:hover .tooltip-content {
      opacity: 1;
      visibility: visible;
    }
    
       /* –°—Ç–∏–ª—ñ –¥–ª—è –¥—Ä—É–∫—É - –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ –¥–ª—è –ê4 */
    @media print {
      @page {
        size: A4;
        margin: 0.5cm 0.5cm 0.5cm 0.5cm;
      }
      
      .no-print,
      .header-bar,
      .password-field,
      .calc-actions,
      .modal,
      .password-modal,
      .settings-modal {
        display: none !important;
      }
      
      /* –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ—ñ–Ω—Ç–∏ –ø—Ä–∏ –¥—Ä—É–∫—É */
      .points-hud {
        display: inline-block !important;
        background: #f0f0f0 !important;
        border: 1px solid #ccc !important;
        padding: 3px 6px !important;
        margin: 5px 0 !important;
        font-weight: bold !important;
        font-size: 12px !important;
      }
      
      * {
        box-sizing: border-box;
      }
      
      body {
        font-size: 10px !important;
        line-height: 1.2 !important;
        margin: 0 !important;
        padding: 0 !important;
        color: #000 !important;
        background: white !important;
      }
      
      .wrapper {
        margin: 0 !important;
        padding: 0 !important;
        width: 100% !important;
        max-width: none !important;
      }
      
      header {
        margin: 0 0 5px 0 !important;
        padding: 0 !important;
        page-break-after: avoid;
      }
      
      .container {
        margin: 0 !important;
        padding: 0 !important;
        width: 100% !important;
      }
      
      .section {
        margin: 0 0 5px 0 !important;
        padding: 0 !important;
        page-break-inside: avoid;
        break-inside: avoid;
        orphans: 1;
        widows: 1;
      }
      
      h3 {
        font-size: 11px !important;
        margin: 3px 0 2px 0 !important;
        color: #000 !important;
        page-break-after: avoid;
        font-weight: bold !important;
      }
      
      label {
        font-size: 9px !important;
        margin: 0 0 1px 0 !important;
        display: inline-block !important;
        width: auto !important;
      }
      
      input, select {
        font-size: 9px !important;
        padding: 1px 2px !important;
        margin: 0 0 1px 0 !important;
        border: 1px solid #ccc !important;
        width: 60px !important;
        height: 16px !important;
      }
      
      /* –ö–æ–º–ø–∞–∫—Ç–Ω–∏–π –º–∞–∫–µ—Ç –¥–ª—è –ø–æ–ª—ñ–≤ */
      .section > div {
        margin: 0 !important;
        padding: 0 !important;
      }
      
      /* –ì—Ä—É–ø—É–≤–∞–Ω–Ω—è –ø–æ–ª—ñ–≤ –≤ —Ä—è–¥–∫–∏ */
      .section label {
        display: inline-block !important;
        width: 120px !important;
        margin-right: 5px !important;
        vertical-align: top !important;
      }
      
      .section input, .section select {
        display: inline-block !important;
        width: 50px !important;
        margin-right: 15px !important;
        margin-bottom: 2px !important;
      }
      
      /* –°–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è flex-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤ */
      .section div[style*="flex"] {
        display: block !important;
      }
      
      .section div[style*="flex"] > div {
        display: inline-block !important;
        margin-right: 20px !important;
        vertical-align: top !important;
      }
      
      /* –ü—Ä–∏—Ö–æ–≤—É—î–º–æ –∑–∞–π–≤—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ */
      .tooltip-container {
        display: none !important;
      }
      
      /* –ú—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ –≤—ñ–¥—Å—Ç—É–ø–∏ */
      br {
        line-height: 0.5 !important;
      }
      
      /* –£–Ω–∏–∫–∞—î–º–æ —Ä–æ–∑—Ä–∏–≤—ñ–≤ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ */
      .section:nth-child(5),
      .section:nth-child(6),
      .section:nth-child(7),
      .section:nth-child(8),
      .section:nth-child(9),
      .section:nth-child(10) {
        page-break-before: avoid !important;
        page-break-inside: avoid !important;
        break-inside: avoid !important;
      }
    }
    
  </style>
</head>

<body>
<!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è -->
<a href="../index.html" class="back-button">‚Üê</a>

<div class="wrapper">
<header>
  <div class="title-small">
    <span>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ì–∞—Ä–¥–µ—Ä–æ–±–Ω—ñ —Å–∏—Å—Ç–µ–º–∏ v1</span>
  </div>
<div class="header-line">
<img src="–ö–∞—Ä—Ç–∏–Ω–∫–∏/logo2.svg" alt="Logo" class="header-logo">
<label>–ü—Ä–æ—î–∫—Ç ‚Ññ <input id="projectNum" placeholder="–ù–æ–º–µ—Ä" type="text"/></label>
<label>–ù–∞–∑–≤–∞ –≤–∏—Ä–æ–±—É <input id="productName" placeholder="–ù–∞–∑–≤–∞" type="text"/></label>
<label>–ú–µ–Ω–µ–¥–∂–µ—Ä <input id="managerName" placeholder="–ü—Ä—ñ–∑–≤–∏—â–µ" type="text"/></label>
<label>–î–∞—Ç–∞ 
<input id="dateField" placeholder="–î–∞—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ" type="text" readonly style="background-color: #f5f5f5; cursor: not-allowed;" value=""/>

</label>
<button class="no-print" onclick="saveData()">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
<button class="no-print" onclick="loadData()">–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏</button>
<button class="no-print" onclick="downloadPDF()" style="margin-left:8px;background:#2563eb;color:#fff;border:none;border-radius:6px;padding:6px 12px;cursor:pointer;">–ó–±–µ—Ä–µ–≥—Ç–∏ PDF</button>
</div>
</header>
<div class="container">
  <h3>1. –û—Å–Ω–æ–≤–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –≤–∏—Ä–æ–±—É</h3>
  <div style="display: flex; gap: 20px; align-items: flex-start; margin-bottom: 20px;">
    <!-- –í–∏–¥ –≤–∏—Ä–æ–±—É -->
    <div style="flex: 1;">
      <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
        <label>–í–∏–¥ –≤–∏—Ä–æ–±—É:</label>
        <button type="button" id="addProductBtn" onclick="showAddProductModal()" style="background: #2563eb; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 13px;">
          + –î–æ–¥–∞—Ç–∏ –≤–∏—Ä—ñ–±
        </button>
      </div>
      <div id="productsList"></div>
      
      <!-- –í–∞—Ä—ñ–∞–Ω—Ç –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è -->
      <div style="margin-top: 15px;">
        <label for="productShape">–§–æ—Ä–º–∞ –≤–∏—Ä–æ–±—É:</label><br/>
        <select id="productShape" style="width: 60%;">
          <option value="">-- –í–∏–±–µ—Ä—ñ—Ç—å --</option>
          <option value="–ü—Ä—è–º–∞">–ü—Ä—è–º–∞</option>
          <option value="–ö—É—Ç–æ–≤–∞">–ö—É—Ç–æ–≤–∞</option>
          <option value="–ü-–ø–æ–¥—ñ–±–Ω–∞">–ü-–ø–æ–¥—ñ–±–Ω–∞</option>
          <option value="G-–ø–æ –ø–µ—Ä–∏–º–µ—Ç—Ä—É">G-–ø–æ –ø–µ—Ä–∏–º–µ—Ç—Ä—É</option>
        </select>
      </div>
    </div>
       

    
    <!-- –ó–∞–º—ñ—Ä–∏ -->
    <div style="flex: 1;">
      <label for="measure">–ó–∞–º—ñ—Ä–∏:</label><br/>
      <select id="measure" style="width: 40%;">
        <option value="">-- –í–∏–±–µ—Ä—ñ—Ç—å --</option>
        <option value="–ë–µ–∑ –∑–∞–º—ñ—Ä—ñ–≤">–ë–µ–∑ –∑–∞–º—ñ—Ä—ñ–≤</option>
        <option value="–ü–æ –∑–∞–º—ñ—Ä–∞–º 3D">–ü–æ –∑–∞–º—ñ—Ä–∞–º 3D</option>
        <option value="–ü–æ –∑–∞–º—ñ—Ä–∞–º —Ñ–æ—Ç–æ-–µ—Å–∫—ñ–∑">–ü–æ –∑–∞–º—ñ—Ä–∞–º —Ñ–æ—Ç–æ-–µ—Å–∫—ñ–∑</option>
      </select>
    </div>
    
    <!-- –ù–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ –≥–µ–æ–º–µ—Ç—Ä—ñ—è -->
    <div style="margin-left: 30px;">
      <label for="geom">–ù–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ –≥–µ–æ–º–µ—Ç—Ä—ñ—è –ø—Ä–∏–º—ñ—â–µ–Ω–Ω—è:<span class="tooltip-container"><span class="tooltip-icon">?</span><div class="tooltip-content">–ù–∞—è–≤–Ω—ñ—Å—Ç—å –∫–æ–ª–æ–Ω, –≤–µ–Ω—Ç-—à–∞—Ö—Ç, –≤–∏—Å—Ç—É–ø—ñ–≤, –±–∞–ª–æ–∫ —Ç–æ—â–æ</div></span></label><br/>
      <select id="geom">
        <option value="">-- –í–∏–±–µ—Ä—ñ—Ç—å --</option>
        <option value="–¢–∞–∫">–¢–∞–∫</option>
        <option value="–ù—ñ">–ù—ñ</option>
      </select>
    </div>
  </div><!-- –†–æ–∑–¥—ñ–ª 2 -->
  <div class="section">
  <h3>2. –ú–∞—Ç–µ—Ä—ñ–∞–ª–∏</h3>
  <label for="corpus">–ú–∞—Ç–µ—Ä—ñ–∞–ª –∫–æ—Ä–ø—É—Å—É (—à—Ç.):</label>
  <input id="corpus" min="0" onfocus="this.select()" type="number" value="0"/><br/><br/>
  <label for="glassSelect">–°–∫–ª–æ-–¥–∑–µ—Ä–∫–∞–ª–æ:</label>
  <select id="glassSelect" onchange="toggleGlassCount()">
  <option value="">-- –í–∏–±–µ—Ä—ñ—Ç—å --</option>
  <option value="–¢–∞–∫">–¢–∞–∫</option>
  <option value="–ù—ñ">–ù—ñ</option>
  </select>
  <div class="hidden" id="glassCountWrapper">
  <br/>
  <label for="glassCount">–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Å–∫–ª–æ-–¥–∑–µ—Ä–∫–∞–ª (—à—Ç.):</label>
  <input id="glassCount" min="0" onfocus="this.select()" type="number" value="0"/>
  </div><br/><br/>
  <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
    <label for="hasFacadeMaterials">–§–∞—Å–∞–¥–Ω—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏:</label>
    <select id="hasFacadeMaterials" onchange="toggleFacadeMaterialsFields()">
      <option value="">-- –í–∏–±–µ—Ä—ñ—Ç—å --</option>
      <option value="yes">–¢–∞–∫</option>
      <option value="no">–ù—ñ</option>
    </select>
    <button type="button" id="addFacadeMaterialBtn" onclick="showAddFacadeMaterialModal()" class="hidden" style="background: #2563eb; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
      + –î–æ–¥–∞—Ç–∏ –º–∞—Ç–µ—Ä—ñ–∞–ª
    </button>
  </div>
  <div class="hidden" id="facadeMaterialsFields">
  <div id="facadeMaterialsList"></div>
  </div>
  </div>
  <!-- –†–æ–∑–¥—ñ–ª 3 -->
  <div class="section">
 
  <!-- –†–æ–∑–¥—ñ–ª 3 -->
  <div class="section">
  <h3>3. –î–æ–¥–∞—Ç–∫–æ–≤—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ ‚Äì –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó</h3>
  <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
    <label>–Ñ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –µ–ª–µ–º–µ–Ω—Ç–∏:</label>
    <select id="hasAdditionalElements" onchange="toggleAdditionalElementsFields()" style="width: 150px;">
      <option value="">-- –í–∏–±–µ—Ä—ñ—Ç—å --</option>
      <option value="yes">–¢–∞–∫</option>
      <option value="no">–ù—ñ</option>
    </select>
    <button type="button" id="addAdditionalElementBtn" onclick="showAddAdditionalElementModal()" style="background: #2563eb; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 13px; display: none;">
      + –î–æ–¥–∞—Ç–∏ –µ–ª–µ–º–µ–Ω—Ç
    </button>
  </div>
  <div id="additionalElementsList"></div>
  </div>
  <!-- –†–æ–∑–¥—ñ–ª 4 -->
  <div class="section">
    <h3>4. –°–∫–ª–∞–¥–æ–≤—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –≥–∞—Ä–¥–µ—Ä–æ–±–Ω–æ—ó</h3>
    <label for="furnTumba90">–¢—É–º–±–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è 90*:</label>
    <input id="furnTumba90" min="0" onfocus="this.select()" placeholder="–í–∫–∞–∂—ñ—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∞–±–æ 0" type="number"/><br/><br/>
    <label for="furnTumba45">–¢—É–º–±–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è 45*:</label>
    <input id="furnTumba45" min="0" onfocus="this.select()" placeholder="–í–∫–∞–∂—ñ—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∞–±–æ 0" type="number"/><br/><br/>
    <label for="furnShelfStraight">–ü–æ–ª–∏—Ü—è –ø—Ä—è–º–∞:</label>
    <input id="furnShelfStraight" min="0" onfocus="this.select()" placeholder="–í–∫–∞–∂—ñ—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∞–±–æ 0" type="number"/><br/><br/>
    <label for="furnShelfMulti">–ü–æ–ª–∏—Ü—è –∑–±—ñ—Ä–Ω–∞ (–±–∞–≥–∞—Ç–æ–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∞):</label>
    <input id="furnShelfMulti" min="0" onfocus="this.select()" placeholder="–í–∫–∞–∂—ñ—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∞–±–æ 0" type="number"/><br/><br/>
    <label for="furnPodium">–ü–æ–¥—ñ—É–º:</label>
    <input id="furnPodium" min="0" onfocus="this.select()" placeholder="–í–∫–∞–∂—ñ—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∞–±–æ 0" type="number"/><br/><br/>
    <label for="furnDrawers">–Ø—â–∏–∫–∏:</label>
    <input id="furnDrawers" min="0" onfocus="this.select()" placeholder="–í–∫–∞–∂—ñ—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∞–±–æ 0" type="number"/><br/><br/>
    <label for="furnBarMechanisms">–ë–∞—Ä–Ω—ñ –º–µ—Ö–∞–Ω—ñ–∑–º–∏:</label>
    <input id="furnBarMechanisms" min="0" onfocus="this.select()" placeholder="–í–∫–∞–∂—ñ—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∞–±–æ 0" type="number"/><br/><br/>
    <label for="furnWardrobeAccessories">–ê–∫—Å–µ—Å—É–∞—Ä–∏: –∫–æ—à–∏–∫–∏, –ø–æ–ª–∏—Ü—ñ –¥–ª—è –≤–∑—É—Ç—Ç—è —Ç–æ—â–æ:</label>
    <input id="furnWardrobeAccessories" min="0" onfocus="this.select()" placeholder="–í–∫–∞–∂—ñ—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∞–±–æ 0" type="number"/><br/><br/>
    <label for="furnClothingRods">–ö-—Å—Ç—å —à—Ç–∞–Ω–≥ –¥–ª—è –æ–¥—è–≥—É:</label>
    <input id="furnClothingRods" min="0" onfocus="this.select()" placeholder="–í–∫–∞–∂—ñ—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∞–±–æ 0" type="number"/><br/><br/>
    <label for="furnLifts">–ü—ñ–¥–π–æ–º–Ω—ñ –º–µ—Ö–∞–Ω—ñ–∑–º–∏:</label>
    <input id="furnLifts" min="0" onfocus="this.select()" placeholder="–í–∫–∞–∂—ñ—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∞–±–æ 0" type="number"/>
    </div>
  <!-- –†–æ–∑–¥—ñ–ª 5 -->
  <div class="section">
  <h3>5. –Ü–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏
    <span class="tooltip-container" style="margin-left: 8px;">
      <span class="tooltip-icon">?</span>
      <div class="tooltip-content">–õ—é–∫ —Ç–µ—Ö–Ω—ñ—á–Ω–∏–π, –¢–µ—Ö–Ω—ñ–∫–∞</div>
    </span>
  </h3>
  <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
    <label for="hasIntegratedElements">–Ü–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏:</label>
    <select id="hasIntegratedElements" onchange="toggleIntegratedElementsFields()">
      <option value="">-- –í–∏–±–µ—Ä—ñ—Ç—å --</option>
      <option value="yes">–¢–∞–∫</option>
      <option value="no">–ù—ñ</option>
    </select>
    <button type="button" id="addIntegratedElementBtn" onclick="showAddIntegratedElementModal()" class="hidden" style="background: #2563eb; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
      + –î–æ–¥–∞—Ç–∏ –µ–ª–µ–º–µ–Ω—Ç
    </button>
  </div>
  <div class="hidden" id="integratedElementsFields">
  <div id="integratedElementsList"></div>
  </div>
  </div>
  <!-- –†–æ–∑–¥—ñ–ª 6 -->
  <div class="section">
  <h3>6. –†—É—á–∫–∏</h3>
  <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
    <label for="hasHandles">–†—É—á–∫–∏:</label>
    <select id="hasHandles" onchange="toggleHandlesFields()">
      <option value="">-- –í–∏–±–µ—Ä—ñ—Ç—å --</option>
      <option value="yes">–¢–∞–∫</option>
      <option value="no">–ù—ñ</option>
    </select>
    <button type="button" id="addHandleBtn" onclick="showAddHandleModal()" class="hidden" style="background: #2563eb; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
      + –î–æ–¥–∞—Ç–∏ —Ä—É—á–∫—É
    </button>
  </div>
  <div class="hidden" id="handlesFields">
  <div id="handlesList"></div>
  </div>
  </div>
  
  <!-- –†–æ–∑–¥—ñ–ª 7 -->
  <div class="section">
  <h3>7. –ü—ñ–¥—Å–≤—ñ—Ç–∫–∞</h3>
  <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
    <label for="hasLighting">–ü—ñ–¥—Å–≤—ñ—Ç–∫–∞:</label>
    <select id="hasLighting" onchange="toggleLightingFields()">
      <option value="">-- –í–∏–±–µ—Ä—ñ—Ç—å --</option>
      <option value="yes">–¢–∞–∫</option>
      <option value="no">–ù—ñ</option>
    </select>
    <button type="button" id="addLightingBtn" onclick="showAddLightingModal()" class="hidden" style="background: #2563eb; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
      + –î–æ–¥–∞—Ç–∏ –ø—ñ–¥—Å–≤—ñ—Ç–∫—É
    </button>
  </div>
  <div class="hidden" id="lightingFields">
  <div id="lightingList"></div>
  </div>
  </div>
  <div style="display: flex; align-items: center; gap: 15px;">
    <button class="no-print" onclick="calculate()">–†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
    <div class="points-hud" id="pointsHUD" style="display: none;">–ü–æ—ñ–Ω—Ç–∏: 0</div>
  </div>
  </div>
  </div>

<!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è –ø–∞—Ä–æ–ª—è -->
<div id="passwordModal" class="modal" style="display: none;">
  <div class="modal-content" style="max-width: 400px;">
    <div class="modal-header">
      <h3>–í–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å</h3>
      <button class="close" onclick="closePasswordModal()">&times;</button>
    </div>
    <div>
      <label for="passwordInput">–ü–∞—Ä–æ–ª—å:</label><br/>
      <input type="password" id="passwordInput" onkeypress="handlePasswordKeypress(event)" style="width: 100%; margin-bottom: 15px; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å">
    </div>
    <div class="modal-actions">
      <button onclick="closePasswordModal()" style="background: #6b7280;">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
      <button onclick="checkPassword()" style="background: #2563eb;">–í—ñ–¥–∫—Ä–∏—Ç–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</button>
    </div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –≤–∏—Ä–æ–±—É -->
<div id="productModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>–î–æ–¥–∞—Ç–∏ –≤–∏—Ä—ñ–±</h3>
      <button class="close" onclick="closeProductModal()">&times;</button>
    </div>
    <div>
      <label for="productType">–¢–∏–ø –≤–∏—Ä–æ–±—É:</label><br/>
      <select id="productType" onchange="toggleProductTypeFields()" style="width: 100%; margin-bottom: 15px;">
        <option value="">-- –í–∏–±–µ—Ä—ñ—Ç—å —Ç–∏–ø --</option>
        <option value="–°—Ç–µ–ª–∞–∂–Ω–∞ —Å-–º–∞ ( –∫-—Å—Ç—å –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∏—Ö —Å–µ–∫—Ü—ñ–π/–º–æ–¥—É–ª—ñ–≤)">–°—Ç–µ–ª–∞–∂–Ω–∞ —Å-–º–∞ ( –∫-—Å—Ç—å –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∏—Ö —Å–µ–∫—Ü—ñ–π/–º–æ–¥—É–ª—ñ–≤)</option>
        <option value="–ü—Ä–∏—Å—Ç—ñ–Ω–Ω–∞ —Å-–º–∞  ( –∫-—Å—Ç—å –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∏—Ö —Å–µ–∫—Ü—ñ–π/–º–æ–¥—É–ª—ñ–≤)">–ü—Ä–∏—Å—Ç—ñ–Ω–Ω–∞ —Å-–º–∞  ( –∫-—Å—Ç—å –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∏—Ö —Å–µ–∫—Ü—ñ–π/–º–æ–¥—É–ª—ñ–≤)</option>
      </select>
            <!-- –ü–æ–ª—è –¥–ª—è —Ç–∏–ø—É –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó (–ø—Ä–∏—Ö–æ–≤–∞–Ω—ñ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º) -->
     <div id="productConstructionFields" style="display: none;">
      <label for="productConstructionType">–¢–∏–ø –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó:</label><br/>
      <select id="productConstructionType" style="width: 100%; margin-bottom: 15px;">
        <option value="">-- –í–∏–±–µ—Ä—ñ—Ç—å —Ç–∏–ø –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó --</option>
        <option value="floor_wall">–ö–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –ø—ñ–¥–ª–æ–≥–∞-—Å—Ç—ñ–Ω–∞</option>
        <option value="floor_ceiling">–ö–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –ø—ñ–¥–ª–æ–≥–∞-—Å—Ç–µ–ª—è</option>
      </select>
    </div>
      <label for="productQuantity">–ö—ñ–ª—å–∫—ñ—Å—Ç—å:</label><br/>
      <input type="number" id="productQuantity" min="1" value="1" style="width: 100%; margin-bottom: 15px;">
    </div>
    <div class="modal-actions">
      <button onclick="closeProductModal()" style="background: #6b7280;">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
      <button onclick="addProduct()" style="background: #2563eb;">–î–æ–¥–∞—Ç–∏</button>
    </div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ñ–∞—Å–∞–¥–Ω–æ–≥–æ –º–∞—Ç–µ—Ä—ñ–∞–ª—É -->
<div id="addFacadeMaterialModal" class="modal" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3>–î–æ–¥–∞—Ç–∏ —Ñ–∞—Å–∞–¥–Ω–∏–π –º–∞—Ç–µ—Ä—ñ–∞–ª</h3>
      <span class="close" onclick="closeAddFacadeMaterialModal()">&times;</span>
    </div>
    <label for="newFacadeMaterialType">–¢–∏–ø –º–∞—Ç–µ—Ä—ñ–∞–ª—É:</label>
    <select id="newFacadeMaterialType" onchange="addFacadeMaterialOnSelect()">
      <option value="">-- –í–∏–±–µ—Ä—ñ—Ç—å --</option>
      <option value="dsp_mat_corpus">–î–°–ü –º–∞—Ç. –∫–æ—Ä–ø—É—Å—É</option>
      <option value="dsp">–î–°–ü</option>
      <option value="mdf_boards">–ú–î–§ –ø–ª–∏—Ç–∏</option>
      <option value="paint_film_straight">–§–∞—Ä–±–∞/–ø–ª—ñ–≤–∫–∞ "–ø—Ä—è–º—ñ"</option>
      <option value="paint_film_milled">–§–∞—Ä–±–∞/–ø–ª—ñ–≤–∫–∞ "—Ñ—Ä–µ–∑–µ—Ä–æ–≤–∞–Ω—ñ"</option>
      <option value="veneered_straight">–®–ø–æ–Ω–æ–≤–∞–Ω—ñ "–ø—Ä—è–º—ñ"</option>
      <option value="veneered_milled">–®–ø–æ–Ω–æ–≤–∞–Ω—ñ "—Ñ—Ä–µ–∑–µ—Ä–æ–≤–∞–Ω—ñ"</option>
      <option value="aluminum_frame">–ê–ª—é–º. —Ä–∞–º–∫–æ–≤—ñ</option>
      <option value="arpa_fenix">ARPA/Fenix</option>
      <option value="fiushin">Fiushin</option>
      <option value="hpl">HPL</option>
      <option value="rd_facades_individual">R&D —Ñ–∞—Å–∞–¥–∏ —ñ–Ω–¥–∏–≤—ñ–¥.</option>
      <option value="mdf_facades_individual_milling">–ú–î–§ —Ñ–∞—Å–∞–¥–∏ –∑ —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–∏–º —Ñ—Ä–µ–∑–µ—Ä—É–≤–∞–Ω–Ω—è–º</option>
    </select>
    <div class="modal-actions">
      <button onclick="closeAddFacadeMaterialModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
    </div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞ -->
<div id="addAdditionalElementModal" class="modal" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3>–î–æ–¥–∞—Ç–∏ –µ–ª–µ–º–µ–Ω—Ç</h3>
      <span class="close" onclick="closeAddAdditionalElementModal()">&times;</span>
    </div>
    <div>
      <label for="newAdditionalElementType">–¢–∏–ø –µ–ª–µ–º–µ–Ω—Ç–∞:</label><br/>
      <select id="newAdditionalElementType" style="width: 100%; margin-bottom: 15px;">
        <option value="">-- –í–∏–±–µ—Ä—ñ—Ç—å —Ç–∏–ø --</option>
        <option value="metal_frame">–ú–µ—Ç–∞–ª–æ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è —Ä–∞–º–∫–æ–≤–∞</option>
        <option value="metal_volume">–ú–µ—Ç–∞–ª–æ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –æ–±'—î–º–Ω–∞</option>
        <option value="rd_detail">–î–µ—Ç–∞–ª—å R&D, –≥–Ω—É—Ç–∏–π –µ–ª–µ–º–µ–Ω—Ç —Ç–æ—â–æ</option>
      </select>
      
      <label for="newAdditionalElementQuantity">–ö—ñ–ª—å–∫—ñ—Å—Ç—å:</label><br/>
      <input type="number" id="newAdditionalElementQuantity" min="1" value="1" style="width: 100%; margin-bottom: 15px;">
    </div>
    <div class="modal-actions">
      <button onclick="closeAddAdditionalElementModal()" style="background: #6b7280;">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
      <button onclick="addAdditionalElement()" style="background: #2563eb;">–î–æ–¥–∞—Ç–∏</button>
    </div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ä—É—á–∫–∏ -->
<div id="addHandleModal" class="modal" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3>–î–æ–¥–∞—Ç–∏ —Ä—É—á–∫—É</h3>
      <span class="close" onclick="closeAddHandleModal()">&times;</span>
    </div>
    <label for="newHandleType">–¢–∏–ø —Ä—É—á–∫–∏:</label>
    <select id="newHandleType" onchange="selectedHandleType = this.value;" style="width: 100%; margin-bottom: 15px;">
      <option value="">-- –í–∏–±–µ—Ä—ñ—Ç—å --</option>
      <option value="handles_gola">GOLA</option>
      <option value="handles_end">–¢–æ—Ä—Ü–µ–≤—ñ</option>
      <option value="handles_milled">–§—Ä–µ–∑–µ—Ä–æ–≤–∞–Ω—ñ</option>
      <option value="handles_other">–Ü–Ω—à—ñ</option>
    </select>
    
    <div class="modal-actions">
      <button onclick="closeAddHandleModal()" style="background: #6b7280;">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
      <button onclick="addHandle()" style="background: #2563eb;">–î–æ–¥–∞—Ç–∏</button>
    </div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞ -->
<div id="addIntegratedElementModal" class="modal" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3>–î–æ–¥–∞—Ç–∏ —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–∏–π –µ–ª–µ–º–µ–Ω—Ç</h3>
      <span class="close" onclick="closeAddIntegratedElementModal()">&times;</span>
    </div>
    <label for="newIntegratedElementType">–¢–∏–ø –µ–ª–µ–º–µ–Ω—Ç–∞:</label>
    <select id="newIntegratedElementType" style="width: 100%; margin-bottom: 15px;">
      <option value="">-- –í–∏–±–µ—Ä—ñ—Ç—å --</option>
      <option value="technical_hatch">–õ—é–∫ —Ç–µ—Ö–Ω—ñ—á–Ω–∏–π (—Ä–µ–≤—ñ–∑—ñ–π–Ω–∏–π, –µ–ª–µ–∫—Ç—Ä–æ - —Ç–æ—â–æ)</option>
      <option value="appliances">–¢–µ—Ö–Ω—ñ–∫–∞ (–ø—Ä–∞–ª–∫–∞, —Å—É—à–∫–∞, —Å–µ–π—Ñ, –≤–∏–Ω–∏–Ω–∞ —à–∞—Ñ–∞ —Ç–æ—â–æ)</option>
    </select>
    
    <label for="newIntegratedElementQuantity">–ö—ñ–ª—å–∫—ñ—Å—Ç—å:</label>
    <input type="number" id="newIntegratedElementQuantity" min="1" value="1" style="width: 100%; margin-bottom: 15px;">
    
    <div class="modal-actions">
      <button onclick="closeAddIntegratedElementModal()" style="background: #6b7280;">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
      <button onclick="addIntegratedElement()" style="background: #2563eb;">–î–æ–¥–∞—Ç–∏</button>
    </div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –ø—ñ–¥—Å–≤—ñ—Ç–∫–∏ -->
<div id="addLightingModal" class="modal" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3>–î–æ–¥–∞—Ç–∏ –ø—ñ–¥—Å–≤—ñ—Ç–∫—É</h3>
      <span class="close" onclick="closeAddLightingModal()">&times;</span>
    </div>
    <label for="newLightingType">–¢–∏–ø –ø—ñ–¥—Å–≤—ñ—Ç–∫–∏:</label>
    <select id="newLightingType" style="width: 100%; margin-bottom: 15px;">
      <option value="">-- –í–∏–±–µ—Ä—ñ—Ç—å --</option>
      <option value="light_elements">–ï–ª–µ–º–µ–Ω—Ç—ñ–≤ (–¥–µ—Ç–∞–ª–µ–π) –∑ –ø—ñ–¥—Å–≤—ñ—Ç–∫–æ—é</option>
      <option value="light_control">–ü—Ä–∏—Å—Ç—Ä–æ—ó–≤ –∫–µ—Ä—É–≤–∞–Ω–Ω—è —ñ –≤–∏–º—ñ—Ä—é—é—Ç—å—Å—è –≤ –∫—ñ–ª—å–∫–æ—Å—Ç—è—Ö</option>
    </select>
    
    <label for="newLightingQuantity">–ö—ñ–ª—å–∫—ñ—Å—Ç—å:</label>
    <input type="number" id="newLightingQuantity" min="1" value="1" style="width: 100%; margin-bottom: 15px;">
    
    <div class="modal-actions">
      <button onclick="closeAddLightingModal()" style="background: #6b7280;">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
      <button onclick="addLighting()" style="background: #2563eb;">–î–æ–¥–∞—Ç–∏</button>
    </div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è -->
<div class="modal" id="warningModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5);">
  <div class="modal-content">
    <h3>‚ö† –ü–æ–º–∏–ª–∫–∞</h3>
    <p id="warningText"></p>
    <button onclick="closeModal()">OK</button>
  </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
(function() {
  const dateField = document.getElementById("dateField");
  if (dateField) {
    const today = new Date();
    const day = String(today.getDate()).padStart(2, '0');
    const month = String(today.getMonth() + 1).padStart(2, '0');
    const year = today.getFullYear();
    dateField.value = `${day}-${month}-${year}`;
  }
})();
</script>
<script>
        </script>
    <script src="–Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è/calculator-settings.js" onerror="console.error('‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è calculator-settings.js:', event)"></script>
    <script>
      // –ó–∞—Ç—Ä–∏–º–∫–∞ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å
      setTimeout(() => {
        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏–≤—Å—è —Ñ–∞–π–ª –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å
        console.log('üîç –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ calculatorSettings:', typeof calculatorSettings);
        if (calculatorSettings) {
          console.log('‚úÖ calculatorSettings –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ');
          console.log('üîç –†–æ–∑–¥—ñ–ª wardrobeSystems:', calculatorSettings.wardrobeSystems);
          console.log('üîç –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ç–∞—Ä–∏—Ñ—ñ–≤ –≤ wardrobeSystems:', Object.keys(calculatorSettings.wardrobeSystems || {}).length);
          
          // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ —Ç–∞—Ä–∏—Ñ–∏
          const testIds = [
            'p_wardrobe_systems_product_—Å—Ç–µ–ª–∞–∂–Ω–∞_–ø—ñ–¥–ª–æ–≥–∞_—Å—Ç—ñ–Ω–∞',
            'p_wardrobe_systems_shape_straight',
            'p_wardrobe_systems_measure_no',
            'p_wardrobe_systems_geometry',
            'p_wardrobe_systems_corpus'
          ];
          
          testIds.forEach(id => {
            if (calculatorSettings.wardrobeSystems && calculatorSettings.wardrobeSystems[id]) {
              console.log('‚úÖ –ó–Ω–∞–π–¥–µ–Ω–æ —Ç–∞—Ä–∏—Ñ:', id, '=', calculatorSettings.wardrobeSystems[id].value);
            } else {
              console.error('‚ùå –ù–ï –∑–Ω–∞–π–¥–µ–Ω–æ —Ç–∞—Ä–∏—Ñ:', id);
            }
          });
        } else {
          console.error('‚ùå calculatorSettings –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ!');
        }
      }, 100);
    </script>
    <script>
// ===== –ü–û–Ü–ù–¢–ò –ó–ê–í–ê–ù–¢–ê–ñ–£–Æ–¢–¨–°–Ø –ó –ë–Ü–ë–õ–Ü–û–¢–ï–ö–ò –ù–ê–õ–ê–®–¢–£–í–ê–ù–¨ =====
// –í—Å—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ—ñ–Ω—Ç—ñ–≤ —Ç–µ–ø–µ—Ä –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ calculator-settings.js

// –ú–∞—Å–∏–≤ –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –¥–æ–¥–∞–Ω–∏—Ö –≤–∏—Ä–æ–±—ñ–≤
let addedProducts = [];

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –≤–∏—Ä–æ–±—É
function showAddProductModal() {
  document.getElementById('productModal').style.display = 'flex';
  document.getElementById('productType').value = '';
  document.getElementById('productQuantity').value = '1';
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞
function closeProductModal() {
  document.getElementById('productModal').style.display = 'none';
}
// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–Ω—è –ø–æ–ª—ñ–≤ —Ç–∏–ø—É –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó
function toggleProductTypeFields() {
  const productType = document.getElementById('productType').value;
  const constructionFields = document.getElementById('productConstructionFields');
  
  if (productType === '–°—Ç–µ–ª–∞–∂–Ω–∞ —Å-–º–∞ ( –∫-—Å—Ç—å –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∏—Ö —Å–µ–∫—Ü—ñ–π/–º–æ–¥—É–ª—ñ–≤)' || 
      productType === '–ü—Ä–∏—Å—Ç—ñ–Ω–Ω–∞ —Å-–º–∞  ( –∫-—Å—Ç—å –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∏—Ö —Å–µ–∫—Ü—ñ–π/–º–æ–¥—É–ª—ñ–≤)') {
    constructionFields.style.display = 'block';
  } else {
    constructionFields.style.display = 'none';
  }
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –≤–∏—Ä–æ–±—É
function addProduct() {
  const type = document.getElementById('productType').value;
  const quantity = parseInt(document.getElementById('productQuantity').value);
  const constructionType = document.getElementById('productConstructionType').value;
  
  if (!type || quantity < 1) {
    alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–±–µ—Ä—ñ—Ç—å —Ç–∏–ø –≤–∏—Ä–æ–±—É —Ç–∞ –≤–∫–∞–∂—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å');
    return;
  }
  
  // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–±—Ä–∞—Ç–∏ —Ç–∏–ø –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó
  if ((type === '–°—Ç–µ–ª–∞–∂–Ω–∞ —Å-–º–∞ ( –∫-—Å—Ç—å –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∏—Ö —Å–µ–∫—Ü—ñ–π/–º–æ–¥—É–ª—ñ–≤)' || 
       type === '–ü—Ä–∏—Å—Ç—ñ–Ω–Ω–∞ —Å-–º–∞  ( –∫-—Å—Ç—å –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∏—Ö —Å–µ–∫—Ü—ñ–π/–º–æ–¥—É–ª—ñ–≤)') && !constructionType) {
    alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–±–µ—Ä—ñ—Ç—å —Ç–∏–ø –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó');
    return;
  }
  
  // –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–∞–∑–≤—É –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º —Ç–∏–ø—É –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó
  let displayType = type;
  if (constructionType) {
    const constructionNames = {
      'floor_wall': '–ö–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –ø—ñ–¥–ª–æ–≥–∞-—Å—Ç—ñ–Ω–∞',
      'floor_ceiling': '–ö–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –ø—ñ–¥–ª–æ–≥–∞-—Å—Ç–µ–ª—è'
    };
    displayType = `${type} (${constructionNames[constructionType]})`;
  }
  
  // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –≤–∂–µ —ñ—Å–Ω—É—î —Ç–∞–∫–∏–π —Ç–∏–ø –≤–∏—Ä–æ–±—É
  const existingProduct = addedProducts.find(p => p.type === displayType);
  
  if (existingProduct) {
    existingProduct.quantity += quantity;
  } else {
    addedProducts.push({
      type: displayType,
      quantity: quantity,
      id: Date.now()
    });
  }
  
  renderProductsList();
  closeProductModal();
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É –≤–∏—Ä–æ–±—ñ–≤
function renderProductsList() {
  const productsList = document.getElementById('productsList');
  
  if (addedProducts.length === 0) {
    productsList.innerHTML = '<div style="color: #6b7280; font-style: italic;">–í–∏—Ä–æ–±—ñ–≤ –Ω–µ –¥–æ–¥–∞–Ω–æ</div>';
    return;
  }
  
  // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —Å–∫–æ—Ä–æ—á–µ–Ω–Ω—è –¥–æ–≤–≥–∏—Ö –Ω–∞–∑–≤
  function getShortName(type) {
    const shortNames = {
      '–°—Ç–µ–ª–∞–∂–Ω–∞ —Å-–º–∞ ( –∫-—Å—Ç—å –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∏—Ö —Å–µ–∫—Ü—ñ–π/–º–æ–¥—É–ª—ñ–≤)': '–°—Ç–µ–ª–∞–∂–Ω–∞ —Å-–º–∞',
      '–ü—Ä–∏—Å—Ç—ñ–Ω–Ω–∞ —Å-–º–∞  ( –∫-—Å—Ç—å –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∏—Ö —Å–µ–∫—Ü—ñ–π/–º–æ–¥—É–ª—ñ–≤)': '–ü—Ä–∏—Å—Ç—ñ–Ω–Ω–∞ —Å-–º–∞'
    };
    
    return shortNames[type] || type;
  }
  
  let html = '';
  addedProducts.forEach((product, index) => {
    const shortName = getShortName(product.type);
    html += `
      <div style="display: flex; justify-content: space-between; align-items: center; padding: 4px 0; margin-bottom: 3px;">
        <div style="display: flex; align-items: center; gap: 8px; flex: 1;">
          <span style="font-size: 14px;" title="${product.type}">${index + 1}. ${shortName}</span>
          <input type="number" 
                 id="quantity_${product.id}" 
                 value="${product.quantity}" 
                 min="1" 
                 style="width: 60px; padding: 2px 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 12px;"
                 onchange="updateProductQuantity(${product.id}, this.value)"
                 onblur="updateProductQuantity(${product.id}, this.value)">
          <span style="font-size: 12px; color: #666;">—à—Ç.</span>
        </div>
        <button onclick="removeProduct(${product.id})" class="remove-btn" title="–í–∏–¥–∞–ª–∏—Ç–∏" style="background: #ef4444; color: white; border: none; padding: 2px 6px; border-radius: 3px; cursor: pointer; font-size: 12px;">√ó</button>
      </div>
    `;
  });
  
  productsList.innerHTML = html;
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –≤–∏—Ä–æ–±—É
function updateProductQuantity(id, newQuantity) {
  const quantity = parseInt(newQuantity);
  
  if (quantity < 1) {
    alert('–ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ –Ω–µ –º–µ–Ω—à–µ 1');
    // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—î –∑–Ω–∞—á–µ–Ω–Ω—è
    const product = addedProducts.find(p => p.id === id);
    if (product) {
      document.getElementById(`quantity_${id}`).value = product.quantity;
    }
    return;
  }
  
  const product = addedProducts.find(p => p.id === id);
  if (product) {
    product.quantity = quantity;
    // –ù–µ –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä—é—î–º–æ –≤–µ—Å—å —Å–ø–∏—Å–æ–∫, —â–æ–± –Ω–µ –≤—Ç—Ä–∞—Ç–∏—Ç–∏ —Ñ–æ–∫—É—Å
    console.log(`–û–Ω–æ–≤–ª–µ–Ω–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –¥–ª—è ${product.type}: ${quantity}`);
  }
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è –≤–∏—Ä–æ–±—É
function removeProduct(id) {
  addedProducts = addedProducts.filter(p => p.id !== id);
  renderProductsList();
}

// –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Å–ø–∏—Å–∫—É –≤–∏—Ä–æ–±—ñ–≤ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
document.addEventListener('DOMContentLoaded', function() {
  renderProductsList();
});

// –ó–∞–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ –ø—Ä–∏ –∫–ª—ñ–∫—É –Ω–∞ —Ñ–æ–Ω
document.addEventListener('click', function(event) {
  const modal = document.getElementById('productModal');
  if (event.target === modal) {
    closeProductModal();
  }
});

// ===== –§–£–ù–ö–¶–Ü–á –î–õ–Ø –§–ê–°–ê–î–ù–ò–• –ú–ê–¢–ï–†–Ü–ê–õ–Ü–í =====

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–Ω—è –ø–æ–ª—ñ–≤ —Ñ–∞—Å–∞–¥–Ω–∏—Ö –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤
function toggleFacadeMaterialsFields() {
  const hasFacadeMaterials = document.getElementById("hasFacadeMaterials").value;
  const fields = document.getElementById("facadeMaterialsFields");
  const addButton = document.getElementById("addFacadeMaterialBtn");
  
  if (hasFacadeMaterials === "yes") {
    fields.classList.remove("hidden");
    addButton.classList.remove("hidden");
  } else {
    fields.classList.add("hidden");
    addButton.classList.add("hidden");
    // –û—á–∏—â–∞—î–º–æ —Å–ø–∏—Å–æ–∫ –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤
    document.getElementById("facadeMaterialsList").innerHTML = "";
  }
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ñ–∞—Å–∞–¥–Ω–æ–≥–æ –º–∞—Ç–µ—Ä—ñ–∞–ª—É
function showAddFacadeMaterialModal() {
  document.getElementById('addFacadeMaterialModal').style.display = 'flex';
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ —Ñ–∞—Å–∞–¥–Ω–∏—Ö –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤
function closeAddFacadeMaterialModal() {
  document.getElementById('addFacadeMaterialModal').style.display = 'none';
  // –°–∫–∏–¥–∞—î–º–æ –ø–æ–ª—è
  document.getElementById('newFacadeMaterialType').value = '';
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ñ–∞—Å–∞–¥–Ω–æ–≥–æ –º–∞—Ç–µ—Ä—ñ–∞–ª—É –ø—Ä–∏ –≤–∏–±–æ—Ä—ñ
function addFacadeMaterialOnSelect() {
  const select = document.getElementById("newFacadeMaterialType");
  const materialType = select.value;
  
  if (!materialType) return;

  // –û—Ç—Ä–∏–º—É—î–º–æ –Ω–∞–∑–≤—É –∑ option —Ç–µ–∫—Å—Ç—É
  const selectedOption = select.options[select.selectedIndex];
  const displayName = selectedOption.text;
  
  const materialsList = document.getElementById("facadeMaterialsList");
  
  // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –≤–∂–µ —ñ—Å–Ω—É—î —Ç–∞–∫–∏–π –º–∞—Ç–µ—Ä—ñ–∞–ª
  const existingMaterial = document.getElementById(`facadeMaterial_${materialType}`);
  if (existingMaterial) {
    alert('–¶–µ–π –º–∞—Ç–µ—Ä—ñ–∞–ª –≤–∂–µ –¥–æ–¥–∞–Ω–æ!');
    closeAddFacadeMaterialModal();
    return;
  }
  
  // –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π –µ–ª–µ–º–µ–Ω—Ç
  const materialDiv = document.createElement("div");
  materialDiv.id = `facadeMaterial_${materialType}`;
  materialDiv.setAttribute('data-material-type', materialType);
  materialDiv.style.cssText = "padding: 4px 0; margin-bottom: 3px;";
  
  materialDiv.innerHTML = `
    <span style="font-size: 14px;">
      <span class="material-number"></span>. ${displayName} 
      <button onclick="removeFacadeMaterial('facadeMaterial_${materialType}')" class="remove-btn" title="–í–∏–¥–∞–ª–∏—Ç–∏" style="margin-left: 8px;">√ó</button>
    </span>
  `;
  
  materialsList.appendChild(materialDiv);
  
  // –û–Ω–æ–≤–ª—é—î–º–æ –Ω—É–º–µ—Ä–∞—Ü—ñ—é
  updateFacadeMaterialNumbers();
  
  // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ
  closeAddFacadeMaterialModal();
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω—É–º–µ—Ä–∞—Ü—ñ—ó —Ñ–∞—Å–∞–¥–Ω–∏—Ö –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤
function updateFacadeMaterialNumbers() {
  const materialsList = document.getElementById("facadeMaterialsList");
  const materials = materialsList.querySelectorAll('[id^="facadeMaterial_"]');
  
  materials.forEach((material, index) => {
    const numberSpan = material.querySelector('.material-number');
    if (numberSpan) {
      numberSpan.textContent = index + 1;
    }
  });
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Ñ–∞—Å–∞–¥–Ω–æ–≥–æ –º–∞—Ç–µ—Ä—ñ–∞–ª—É
function removeFacadeMaterial(elementId) {
  const element = document.getElementById(elementId);
  if (element) {
    element.remove();
    // –ü–µ—Ä–µ–Ω—É–º–µ—Ä–æ–≤—É—î–º–æ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –ø—ñ—Å–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è
    updateFacadeMaterialNumbers();
  }
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–Ω—è –ø–æ–ª—ñ–≤ —Å–∫–ª–æ-–¥–∑–µ—Ä–∫–∞–ª–∞
function toggleGlassCount() {
  const glassSelect = document.getElementById("glassSelect").value;
  const glassCountWrapper = document.getElementById("glassCountWrapper");
  
  if (glassSelect === "–¢–∞–∫") {
    glassCountWrapper.classList.remove("hidden");
  } else {
    glassCountWrapper.classList.add("hidden");
    document.getElementById("glassCount").value = "0";
  }
}

// –§—É–Ω–∫—Ü—ñ—ó –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ —Ç–∏–ø–∞–º–∏ —Ñ–∞—Å–∞–¥—ñ–≤
function showAddFacadeTypeModal() {
  document.getElementById('addFacadeTypeModal').style.display = 'flex';
  // –°–∫–∏–¥–∞—î–º–æ –ø–æ–ª—è
  document.getElementById('newFacadeType').value = '';
  document.getElementById('newFacadeQuantity').value = '1';
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ —Ç–∏–ø—ñ–≤ —Ñ–∞—Å–∞–¥—ñ–≤
function closeAddFacadeTypeModal() {
  document.getElementById('addFacadeTypeModal').style.display = 'none';
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ç–∏–ø—É —Ñ–∞—Å–∞–¥—É
function addFacadeType() {
  const type = document.getElementById("newFacadeType").value;
  const quantity = parseInt(document.getElementById("newFacadeQuantity").value) || 1;
  
  if (!type) {
    alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–±–µ—Ä—ñ—Ç—å —Ç–∏–ø —Ñ–∞—Å–∞–¥—É');
    return;
  }

  const typeNames = {
    "swing_doors": "–§–∞—Å–∞–¥–∏ —Ä–æ–∑–ø–∞—à–Ω—ñ",
    "sliding_doors": "–§–∞—Å–∞–¥–∏ —Ä–æ–∑—Å—É–≤–Ω—ñ"
  };

  const typeName = typeNames[type] || type;
  
  const facadeTypesList = document.getElementById("facadeTypesList");
  const facadeTypeId = `facadeType_${Date.now()}`;
  
  // –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π –µ–ª–µ–º–µ–Ω—Ç
  const facadeTypeDiv = document.createElement("div");
  facadeTypeDiv.id = facadeTypeId;
  facadeTypeDiv.style.cssText = "padding: 4px 0; margin-bottom: 3px;";
  facadeTypeDiv.setAttribute('data-type', type);
  facadeTypeDiv.setAttribute('data-quantity', quantity);
  
  facadeTypeDiv.innerHTML = `
    <div style="display: flex; align-items: center; gap: 10px; font-size: 14px;">
      <span class="facade-type-number"></span>. ${typeName}
      <input type="number" id="quantity_${facadeTypeId}" value="${quantity}" min="1" onchange="updateFacadeTypeQuantity('${facadeTypeId}')" style="width: 100px; padding: 5px; border: 1px solid #ccc; border-radius: 4px;">
      <button onclick="removeFacadeType('${facadeTypeId}')" class="remove-btn" title="–í–∏–¥–∞–ª–∏—Ç–∏" style="background: #ef4444; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer;">√ó</button>
    </div>
  `;
  
  facadeTypesList.appendChild(facadeTypeDiv);
  
  // –û–Ω–æ–≤–ª—é—î–º–æ –Ω—É–º–µ—Ä–∞—Ü—ñ—é
  updateFacadeTypeNumbers();
  
  // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ
  closeAddFacadeTypeModal();
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω—É–º–µ—Ä–∞—Ü—ñ—ó —Ç–∏–ø—ñ–≤ —Ñ–∞—Å–∞–¥—ñ–≤
function updateFacadeTypeNumbers() {
  const facadeTypesList = document.getElementById("facadeTypesList");
  const facadeTypes = facadeTypesList.querySelectorAll('[id^="facadeType_"]');
  
  facadeTypes.forEach((facadeType, index) => {
    const numberSpan = facadeType.querySelector('.facade-type-number');
    if (numberSpan) {
      numberSpan.textContent = index + 1;
    }
  });
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Ç–∏–ø—É —Ñ–∞—Å–∞–¥—É
function removeFacadeType(elementId) {
  const element = document.getElementById(elementId);
  if (element) {
    element.remove();
    // –ü–µ—Ä–µ–Ω—É–º–µ—Ä–æ–≤—É—î–º–æ —Ç–∏–ø–∏ —Ñ–∞—Å–∞–¥—ñ–≤ –ø—ñ—Å–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è
    updateFacadeTypeNumbers();
  }
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —Ç–∏–ø—É —Ñ–∞—Å–∞–¥—É
function updateFacadeTypeQuantity(elementId) {
  const element = document.getElementById(elementId);
  if (!element) return;
  
  const input = element.querySelector('input[type="number"]');
  const newQuantity = parseInt(input.value) || 1;
  
  if (newQuantity < 1) {
    input.value = 1;
    element.setAttribute('data-quantity', 1);
  } else {
    element.setAttribute('data-quantity', newQuantity);
  }
}

// –§—É–Ω–∫—Ü—ñ—ó –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –¥–æ–¥–∞—Ç–∫–æ–≤–∏–º–∏ –µ–ª–µ–º–µ–Ω—Ç–∞–º–∏
function toggleAdditionalElementsFields() {
  const hasAdditionalElements = document.getElementById("hasAdditionalElements").value;
  const addAdditionalElementBtn = document.getElementById("addAdditionalElementBtn");
  const additionalElementsList = document.getElementById("additionalElementsList");
  
  if (hasAdditionalElements === "yes") {
    addAdditionalElementBtn.style.display = "inline-block";
    additionalElementsList.style.display = "block";
  } else {
    addAdditionalElementBtn.style.display = "none";
    additionalElementsList.style.display = "none";
    // –û—á–∏—â–∞—î–º–æ —Å–ø–∏—Å–æ–∫ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
    additionalElementsList.innerHTML = "";
  }
  
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞
function showAddAdditionalElementModal() {
  document.getElementById('addAdditionalElementModal').style.display = 'flex';
  // –°–∫–∏–¥–∞—î–º–æ –ø–æ–ª—è
  document.getElementById('newAdditionalElementType').value = '';
  document.getElementById('newAdditionalElementQuantity').value = '1';
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
function closeAddAdditionalElementModal() {
  document.getElementById('addAdditionalElementModal').style.display = 'none';
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞
function addAdditionalElement() {
  const type = document.getElementById("newAdditionalElementType").value;
  const quantity = parseInt(document.getElementById("newAdditionalElementQuantity").value) || 1;
  
  if (!type) {
    alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–±–µ—Ä—ñ—Ç—å —Ç–∏–ø –µ–ª–µ–º–µ–Ω—Ç–∞');
    return;
  }

  const typeNames = {
    "metal_frame": "–ú–µ—Ç–∞–ª–æ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è —Ä–∞–º–∫–æ–≤–∞",
    "metal_volume": "–ú–µ—Ç–∞–ª–æ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –æ–±'—î–º–Ω–∞",
    "rd_detail": "–î–µ—Ç–∞–ª—å R&D, –≥–Ω—É—Ç–∏–π –µ–ª–µ–º–µ–Ω—Ç —Ç–æ—â–æ",
    "false_horizontal": "–§–∞–ª—å—à –ø–∞–Ω–µ–ª—ñ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ñ",
    "false_vertical": "–§–∞–ª—å—à –ø–∞–Ω–µ–ª—ñ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ñ"
  };

  const typeName = typeNames[type] || type;
  
  const additionalElementsList = document.getElementById("additionalElementsList");
  const elementId = `additionalElement_${Date.now()}`;
  
  // –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π –µ–ª–µ–º–µ–Ω—Ç
  const elementDiv = document.createElement("div");
  elementDiv.id = elementId;
  elementDiv.style.cssText = "padding: 4px 0; margin-bottom: 3px;";
  elementDiv.setAttribute('data-element-type', type);
  elementDiv.setAttribute('data-quantity', quantity);
  
  elementDiv.innerHTML = `
    <div style="display: flex; align-items: center; gap: 10px; font-size: 14px;">
      <span class="additional-element-number"></span>. ${typeName}
      <input type="number" id="quantity_${elementId}" value="${quantity}" min="1" onchange="updateAdditionalElementQuantity('${elementId}')" style="width: 100px; padding: 5px; border: 1px solid #ccc; border-radius: 4px;">
      <button onclick="removeAdditionalElement('${elementId}')" class="remove-btn" title="–í–∏–¥–∞–ª–∏—Ç–∏" style="background: #ef4444; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer;">√ó</button>
    </div>
  `;
  
  additionalElementsList.appendChild(elementDiv);
  
  // –û–Ω–æ–≤–ª—é—î–º–æ –Ω—É–º–µ—Ä–∞—Ü—ñ—é
  updateAdditionalElementNumbers();
  
  // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ
  closeAddAdditionalElementModal();
  
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω—É–º–µ—Ä–∞—Ü—ñ—ó –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
function updateAdditionalElementNumbers() {
  const additionalElementsList = document.getElementById("additionalElementsList");
  const elements = additionalElementsList.querySelectorAll('[id^="additionalElement_"]');
  
  elements.forEach((element, index) => {
    const numberSpan = element.querySelector('.additional-element-number');
    if (numberSpan) {
      numberSpan.textContent = index + 1;
    }
  });
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞
function removeAdditionalElement(elementId) {
  const element = document.getElementById(elementId);
  if (element) {
    element.remove();
    // –ü–µ—Ä–µ–Ω—É–º–µ—Ä–æ–≤—É—î–º–æ –µ–ª–µ–º–µ–Ω—Ç–∏ –ø—ñ—Å–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è
    updateAdditionalElementNumbers();
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
    saveSettings();
  }
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –¥–æ–¥–∞—Ç–∫–æ–≤–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞
function updateAdditionalElementQuantity(elementId) {
  const element = document.getElementById(elementId);
  if (!element) return;
  
  const input = element.querySelector('input[type="number"]');
  const newQuantity = parseInt(input.value) || 1;
  
  if (newQuantity < 1) {
    input.value = 1;
    element.setAttribute('data-quantity', 1);
  } else {
    element.setAttribute('data-quantity', newQuantity);
  }
}

// –ì–ª–æ–±–∞–ª—å–Ω–∞ –∑–º—ñ–Ω–Ω–∞ –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤–∏–±—Ä–∞–Ω–æ–≥–æ —Ç–∏–ø—É —Ä—É—á–∫–∏
let selectedHandleType = '';

// –§—É–Ω–∫—Ü—ñ—ó –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ —Ä—É—á–∫–∞–º–∏
function toggleHandlesFields() {
  const hasHandles = document.getElementById("hasHandles").value;
  const addHandleBtn = document.getElementById("addHandleBtn");
  const handlesFields = document.getElementById("handlesFields");
  
  if (hasHandles === "yes") {
    addHandleBtn.classList.remove("hidden");
    handlesFields.classList.remove("hidden");
  } else {
    addHandleBtn.classList.add("hidden");
    handlesFields.classList.add("hidden");
    // –û—á–∏—â–∞—î–º–æ —Å–ø–∏—Å–æ–∫ —Ä—É—á–æ–∫
    document.getElementById("handlesList").innerHTML = "";
  }
  
}

function showAddHandleModal() {
  document.getElementById('addHandleModal').style.display = 'flex';
  // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω–∏–π —Ç–∏–ø —Ä—É—á–∫–∏, —è–∫—â–æ —î
  if (selectedHandleType) {
    document.getElementById('newHandleType').value = selectedHandleType;
  }
  // –ù–µ –æ—á–∏—â–∞—î–º–æ –ø–æ–ª–µ - –∑–∞–ª–∏—à–∞—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—î –∑–Ω–∞—á–µ–Ω–Ω—è
}

function closeAddHandleModal() {
  // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤–∏–±—Ä–∞–Ω–∏–π —Ç–∏–ø —Ä—É—á–∫–∏ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä–∏—Ç—Ç—è–º
  const newHandleType = document.getElementById('newHandleType');
  console.log('closeAddHandleModal - newHandleType element:', newHandleType);
  console.log('closeAddHandleModal - newHandleType value:', newHandleType ? newHandleType.value : '–Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ');
  
  if (newHandleType && newHandleType.value) {
    selectedHandleType = newHandleType.value;
    console.log('closeAddHandleModal - –∑–±–µ—Ä–µ–∂–µ–Ω–æ selectedHandleType:', selectedHandleType);
  } else {
    console.log('closeAddHandleModal - newHandleType –ø–æ—Ä–æ–∂–Ω—ñ–π –∞–±–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ');
  }
  document.getElementById('addHandleModal').style.display = 'none';
}

function addHandle() {
  const handleType = document.getElementById("newHandleType").value;
  
  if (!handleType) {
    alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–±–µ—Ä—ñ—Ç—å —Ç–∏–ø —Ä—É—á–∫–∏');
    return;
  }

  const handleNames = {
    "handles_gola_low": "GOLA –Ω–∏–∑",
    "handles_gola_up": "GOLA –≤–µ—Ä—Ö",
    "handles_gola_vert": "GOLA –≤–µ—Ä—Ç–∏–∫–∞–ª.",
    "handles_end": "–¢–æ—Ä—Ü–µ–≤—ñ",
    "handles_milled": "–§—Ä–µ–∑–µ—Ä–æ–≤–∞–Ω—ñ",
    "handles_other": "–Ü–Ω—à—ñ"
  };

  const displayName = handleNames[handleType] || handleType;
  const handlesList = document.getElementById("handlesList");
  
  // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –≤–∂–µ —ñ—Å–Ω—É—î —Ç–∞–∫–∏–π —Ç–∏–ø —Ä—É—á–∫–∏
  const existingHandle = document.getElementById(`handle_${handleType}`);
  if (existingHandle) {
    // –Ø–∫—â–æ —ñ—Å–Ω—É—î, –Ω–µ –¥–æ–¥–∞—î–º–æ –¥—É–±–ª—ñ–∫–∞—Ç
    return;
  } else {
    // –Ø–∫—â–æ –Ω–µ —ñ—Å–Ω—É—î, —Å—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π
    const handleDiv = document.createElement("div");
    handleDiv.id = `handle_${handleType}`;
    handleDiv.style.cssText = "padding: 4px 0; margin-bottom: 3px;";
    handleDiv.setAttribute('data-type', handleType);
    
    handleDiv.innerHTML = `
      <div style="display: flex; align-items: center; gap: 10px; font-size: 14px;">
        <span class="handle-number"></span>. ${displayName}
        <button onclick="removeHandle('handle_${handleType}')" class="remove-btn" title="–í–∏–¥–∞–ª–∏—Ç–∏" style="background: #ef4444; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer;">√ó</button>
      </div>
    `;
    
    handlesList.appendChild(handleDiv);
  }
  
  // –û–Ω–æ–≤–ª—é—î–º–æ –Ω—É–º–µ—Ä–∞—Ü—ñ—é
  updateHandleNumbers();
  
  // –û—á–∏—â–∞—î–º–æ –ø–æ–ª–µ —Ç–∏–ø—É —Ä—É—á–∫–∏
  document.getElementById('newHandleType').value = '';
  
  // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ
  closeAddHandleModal();
  
}

function updateHandleNumbers() {
  const handlesList = document.getElementById("handlesList");
  const handles = handlesList.querySelectorAll('[id^="handle_"]');
  
  handles.forEach((handle, index) => {
    const numberSpan = handle.querySelector('.handle-number');
    if (numberSpan) {
      numberSpan.textContent = index + 1;
    }
  });
}

function removeHandle(elementId) {
  const element = document.getElementById(elementId);
  if (element) {
    element.remove();
    // –ü–µ—Ä–µ–Ω—É–º–µ—Ä–æ–≤—É—î–º–æ —Ä—É—á–∫–∏ –ø—ñ—Å–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è
    updateHandleNumbers();
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
    saveSettings();
  }
}

// –§—É–Ω–∫—Ü—ñ—ó –¥–ª—è —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
function toggleIntegratedElementsFields() {
  const hasIntegratedElements = document.getElementById('hasIntegratedElements').value;
  const integratedElementsFields = document.getElementById('integratedElementsFields');
  const addIntegratedElementBtn = document.getElementById('addIntegratedElementBtn');
  
  if (hasIntegratedElements === 'yes') {
    integratedElementsFields.classList.remove('hidden');
    addIntegratedElementBtn.classList.remove('hidden');
  } else {
    integratedElementsFields.classList.add('hidden');
    addIntegratedElementBtn.classList.add('hidden');
    // –û—á–∏—â–∞—î–º–æ —Å–ø–∏—Å–æ–∫ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
    document.getElementById('integratedElementsList').innerHTML = '';
  }
}

function showAddIntegratedElementModal() {
  document.getElementById('addIntegratedElementModal').style.display = 'flex';
  // –°–∫–∏–¥–∞—î–º–æ –ø–æ–ª—è
  document.getElementById('newIntegratedElementType').value = '';
  document.getElementById('newIntegratedElementQuantity').value = '1';
}

function closeAddIntegratedElementModal() {
  document.getElementById('addIntegratedElementModal').style.display = 'none';
}

function addIntegratedElement() {
  const type = document.getElementById("newIntegratedElementType").value;
  const quantity = parseInt(document.getElementById("newIntegratedElementQuantity").value) || 1;
  
  if (!type) {
    alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–±–µ—Ä—ñ—Ç—å —Ç–∏–ø –µ–ª–µ–º–µ–Ω—Ç–∞');
    return;
  }

  const typeNames = {
    "technical_hatch": "–õ—é–∫ —Ç–µ—Ö–Ω—ñ—á–Ω–∏–π (—Ä–µ–≤—ñ–∑—ñ–π–Ω–∏–π, –µ–ª–µ–∫—Ç—Ä–æ - —Ç–æ—â–æ)",
    "appliances": "–¢–µ—Ö–Ω—ñ–∫–∞ (–ø—Ä–∞–ª–∫–∞, —Å—É—à–∫–∞, —Å–µ–π—Ñ, –≤–∏–Ω–∏–Ω–∞ —à–∞—Ñ–∞ —Ç–æ—â–æ)"
  };

  const typeName = typeNames[type] || type;
  
  const integratedElementsList = document.getElementById("integratedElementsList");
  const elementId = `integratedElement_${Date.now()}`;
  
  // –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π –µ–ª–µ–º–µ–Ω—Ç
  const elementDiv = document.createElement("div");
  elementDiv.id = elementId;
  elementDiv.style.cssText = "padding: 4px 0; margin-bottom: 3px;";
  elementDiv.setAttribute('data-type', type);
  elementDiv.setAttribute('data-quantity', quantity);
  
  elementDiv.innerHTML = `
    <div style="display: flex; align-items: center; gap: 10px; font-size: 14px;">
      <span class="integrated-element-number"></span>. ${typeName}
      <input type="number" id="quantity_${elementId}" value="${quantity}" min="1" onchange="updateIntegratedElementQuantity('${elementId}')" style="width: 100px; padding: 5px; border: 1px solid #ccc; border-radius: 4px;">
      <button onclick="removeIntegratedElement('${elementId}')" class="remove-btn" title="–í–∏–¥–∞–ª–∏—Ç–∏" style="background: #ef4444; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer;">√ó</button>
    </div>
  `;
  
  integratedElementsList.appendChild(elementDiv);
  
  // –û–Ω–æ–≤–ª—é—î–º–æ –Ω—É–º–µ—Ä–∞—Ü—ñ—é
  updateIntegratedElementNumbers();
  
  // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ
  closeAddIntegratedElementModal();
}

function updateIntegratedElementNumbers() {
  const integratedElementsList = document.getElementById("integratedElementsList");
  const elements = integratedElementsList.querySelectorAll('[id^="integratedElement_"]');
  
  elements.forEach((element, index) => {
    const numberSpan = element.querySelector('.integrated-element-number');
    if (numberSpan) {
      numberSpan.textContent = index + 1;
    }
  });
}

function updateIntegratedElementQuantity(elementId) {
  const element = document.getElementById(elementId);
  const quantityInput = element.querySelector('input[type="number"]');
  const newQuantity = parseInt(quantityInput.value) || 1;
  element.setAttribute('data-quantity', newQuantity);
}

function removeIntegratedElement(elementId) {
  const element = document.getElementById(elementId);
  if (element) {
    element.remove();
    updateIntegratedElementNumbers();
  }
}

// –§—É–Ω–∫—Ü—ñ—ó –¥–ª—è –ø—ñ–¥—Å–≤—ñ—Ç–∫–∏
function showAddLightingModal() {
  document.getElementById('addLightingModal').style.display = 'flex';
}

function closeAddLightingModal() {
  document.getElementById('addLightingModal').style.display = 'none';
  document.getElementById('newLightingType').value = '';
  document.getElementById('newLightingQuantity').value = '1';
}

function addLighting() {
  const lightingType = document.getElementById("newLightingType").value;
  const quantity = parseInt(document.getElementById("newLightingQuantity").value) || 1;
  
  if (!lightingType) {
    alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–±–µ—Ä—ñ—Ç—å —Ç–∏–ø –ø—ñ–¥—Å–≤—ñ—Ç–∫–∏');
    return;
  }

  const lightingNames = {
    "light_elements": "–ï–ª–µ–º–µ–Ω—Ç—ñ–≤ (–¥–µ—Ç–∞–ª–µ–π) –∑ –ø—ñ–¥—Å–≤—ñ—Ç–∫–æ—é",
    "light_control": "–ü—Ä–∏—Å—Ç—Ä–æ—ó–≤ –∫–µ—Ä—É–≤–∞–Ω–Ω—è —ñ –≤–∏–º—ñ—Ä—é—é—Ç—å—Å—è –≤ –∫—ñ–ª—å–∫–æ—Å—Ç—è—Ö"
  };

  const displayName = lightingNames[lightingType] || lightingType;
  const lightingList = document.getElementById("lightingList");
  
  // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –≤–∂–µ —ñ—Å–Ω—É—î —Ç–∞–∫–∏–π —Ç–∏–ø –ø—ñ–¥—Å–≤—ñ—Ç–∫–∏
  const existingLighting = document.getElementById(`lighting_${lightingType}`);
  if (existingLighting) {
    // –Ø–∫—â–æ —ñ—Å–Ω—É—î, –æ–Ω–æ–≤–ª—é—î–º–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å
    existingLighting.setAttribute('data-quantity', quantity);
    const quantityInput = existingLighting.querySelector('input[type="number"]');
    if (quantityInput) {
      quantityInput.value = quantity;
    }
  } else {
    // –Ø–∫—â–æ –Ω–µ —ñ—Å–Ω—É—î, —Å—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π
    const lightingDiv = document.createElement("div");
    lightingDiv.id = `lighting_${lightingType}`;
    lightingDiv.style.cssText = "padding: 4px 0; margin-bottom: 3px;";
    lightingDiv.setAttribute('data-type', lightingType);
    lightingDiv.setAttribute('data-quantity', quantity);
    
    lightingDiv.innerHTML = `
      <div style="display: flex; align-items: center; gap: 10px; font-size: 14px;">
        <span class="lighting-number"></span>. ${displayName}
        <input type="number" id="quantity_${lightingDiv.id}" value="${quantity}" min="1" onchange="updateLightingQuantity('${lightingDiv.id}')" style="width: 100px; padding: 5px; border: 1px solid #ccc; border-radius: 4px;">
        <button onclick="removeLighting('lighting_${lightingType}')" class="remove-btn" title="–í–∏–¥–∞–ª–∏—Ç–∏" style="background: #ef4444; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer;">√ó</button>
      </div>
    `;
    
    lightingList.appendChild(lightingDiv);
  }
  
  // –û–Ω–æ–≤–ª—é—î–º–æ –Ω—É–º–µ—Ä–∞—Ü—ñ—é
  updateLightingNumbers();
  
  // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ
  closeAddLightingModal();
  
}

function updateLightingNumbers() {
  const lightingList = document.getElementById("lightingList");
  const lightings = lightingList.querySelectorAll('[id^="lighting_"]');
  
  lightings.forEach((lighting, index) => {
    const numberSpan = lighting.querySelector('.lighting-number');
    if (numberSpan) {
      numberSpan.textContent = `${index + 1}`;
    }
  });
}

function updateLightingQuantity(elementId) {
  const element = document.getElementById(elementId);
  if (element) {
    const quantity = parseInt(element.querySelector('input[type="number"]').value) || 1;
    element.setAttribute('data-quantity', quantity);
  }
}

function removeLighting(elementId) {
  const element = document.getElementById(elementId);
  if (element) {
    element.remove();
    updateLightingNumbers();
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
    saveSettings();
  }
}

function toggleLightingFields() {
  const hasLighting = document.getElementById("hasLighting").value;
  const fields = document.getElementById("lightingFields");
  const addButton = document.getElementById("addLightingBtn");
  
  if (hasLighting === "yes") {
    fields.classList.remove("hidden");
    addButton.classList.remove("hidden");
  } else {
    fields.classList.add("hidden");
    addButton.classList.add("hidden");
    // –û—á–∏—â–∞—î–º–æ —Å–ø–∏—Å–æ–∫ –ø—ñ–¥—Å–≤—ñ—Ç–∫–∏
    document.getElementById("lightingList").innerHTML = "";
  }
  
}

function getSettingValue(id) {
  // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å
  if (typeof calculatorSettings !== 'undefined') {
    // –®—É–∫–∞—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è –≤ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è—Ö
    for (const calcType in calculatorSettings) {
      if (calculatorSettings[calcType][id]) {
        console.log('‚úÖ –ó–Ω–∞–π–¥–µ–Ω–æ –∑–Ω–∞—á–µ–Ω–Ω—è –¥–ª—è', id, ':', calculatorSettings[calcType][id].value);
        return calculatorSettings[calcType][id].value;
      }
    }
  }
  
  // Fallback - –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è
  console.warn('‚ö†Ô∏è –ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ –∑–Ω–∞—á–µ–Ω–Ω—è –¥–ª—è', id, ', –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è: 1');
  return 1;
}

function valInt(id) {
  const el = document.getElementById(id);
  if (!el) return 0;
  const v = parseInt(el.value);
  return (Number.isFinite(v) && v > 0) ? v : 0;
}

function valYes(id) {
  const el = document.getElementById(id);
  if (!el) return false;
  if (el.type === "checkbox") return !!el.checked;
  const v = (el.value || "").toString().trim().toLowerCase();
  return v === "—Ç–∞–∫" || v === "yes" || v === "1" || v === "true";
}

let points = 0; // –ì–ª–æ–±–∞–ª—å–Ω–∞ –∑–º—ñ–Ω–Ω–∞ –¥–ª—è –Ω–∞–∫–æ–ø–∏—á–µ–Ω–Ω—è –±–∞–ª—ñ–≤

function addDetail(label, count, tariffId) {
  if (!count || count <= 0) return;
  const t = getSettingValue(tariffId);
  if (!t || t <= 0) return;
  const addedPoints = count * t;
  points += addedPoints;
  console.log(`${label}: ${count} √ó ${t} = ${addedPoints} (–∑–∞–≥–∞–ª–æ–º: ${points})`);
}

function checkRequiredFields() {
  const missing = [];
  
  console.log("=== –ü–æ—á–∞—Ç–æ–∫ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø–æ–ª—ñ–≤ ===");
  
  // 1. –û—Å–Ω–æ–≤–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
  if (addedProducts.length === 0) {
    missing.push("1. –í–∏–¥ –≤–∏—Ä–æ–±—É");
  }
  if (!document.getElementById("productShape")?.value) {
    missing.push("1. –§–æ—Ä–º–∞ –≤–∏—Ä–æ–±—É");
  }
  // –ü–æ–ª–µ "measure" –Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–µ, –æ—Å–∫—ñ–ª—å–∫–∏ —î –æ–ø—Ü—ñ—è "–ë–µ–∑ –∑–∞–º—ñ—Ä—ñ–≤"
  if (!document.getElementById("geom")?.value) {
    missing.push("1. –ù–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ –≥–µ–æ–º–µ—Ç—Ä—ñ—è –ø—Ä–∏–º—ñ—â–µ–Ω–Ω—è");
  }
  
  // 2. –ú–∞—Ç–µ—Ä—ñ–∞–ª–∏
  console.log("–ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Ä–æ–∑–¥—ñ–ª 2 - –ú–∞—Ç–µ—Ä—ñ–∞–ª–∏");
  const corpus = document.getElementById("corpus")?.value;
  console.log("corpus value:", corpus);
  if (!corpus || parseInt(corpus) <= 0) {
    missing.push("2. –ú–∞—Ç–µ—Ä—ñ–∞–ª –∫–æ—Ä–ø—É—Å–∞ (–∫—ñ–ª—å–∫—ñ—Å—Ç—å)");
  }
  
  const hasMaterials = document.getElementById("hasFacadeMaterials");
  console.log("hasMaterials element:", hasMaterials);
  console.log("hasMaterials value:", hasMaterials?.value);
  if (!hasMaterials || !hasMaterials.value) {
    missing.push("2. –ú–∞—Ç–µ—Ä—ñ–∞–ª–∏ (–≤–∏–±—ñ—Ä)");
  } else if (hasMaterials.value === "yes") {
    const materials = document.querySelectorAll('[id^="facadeMaterial_"]');
    console.log("materials count:", materials.length);
    if (materials.length === 0) {
      missing.push("2. –ú–∞—Ç–µ—Ä—ñ–∞–ª–∏ (–Ω–µ –¥–æ–¥–∞–Ω–æ –∂–æ–¥–Ω–æ–≥–æ)");
    }
  }
    
  // 3. –î–æ–¥–∞—Ç–∫–æ–≤—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ - –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –¥–∏–Ω–∞–º—ñ—á–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏
  const hasElements = document.getElementById("hasAdditionalElements");
  if (!hasElements || !hasElements.value) {
    missing.push("3. –î–æ–¥–∞—Ç–∫–æ–≤—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ (–≤–∏–±—ñ—Ä)");
  } else if (hasElements.value === "yes") {
    const elements = document.querySelectorAll('[id^="additionalElement_"]');
    if (elements.length === 0) {
      missing.push("3. –î–æ–¥–∞—Ç–∫–æ–≤—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ (–Ω–µ –¥–æ–¥–∞–Ω–æ –∂–æ–¥–Ω–æ–≥–æ)");
    }
  }
  
  // 4. –°–∫–ª–∞–¥–æ–≤—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –≥–∞—Ä–¥–µ—Ä–æ–±–Ω–æ—ó - –≤—Å—ñ –ø–æ–ª—è –Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤—ñ (–º–æ–∂—É—Ç—å –±—É—Ç–∏ 0)
  // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Ç—ñ–ª—å–∫–∏ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –ø–æ–ª—ñ–≤, –∞–ª–µ –Ω–µ –≤–∏–º–∞–≥–∞—î–º–æ —ó—Ö –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è
  
  // 5. –Ü–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏
  const hasIntegratedElements = document.getElementById("hasIntegratedElements");
  if (!hasIntegratedElements || !hasIntegratedElements.value) {
    missing.push("5. –Ü–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ (–≤–∏–±—ñ—Ä)");
  } else if (hasIntegratedElements.value === "yes") {
    const integratedElements = document.querySelectorAll('[id^="integratedElement_"]');
    if (integratedElements.length === 0) {
      missing.push("5. –Ü–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ (–Ω–µ –¥–æ–¥–∞–Ω–æ –∂–æ–¥–Ω–æ–≥–æ)");
    }
  }
  
  // 6. –†—É—á–∫–∏ - –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –¥–∏–Ω–∞–º—ñ—á–Ω—ñ —Ä—É—á–∫–∏
  const hasHandles = document.getElementById("hasHandles");
  if (!hasHandles || !hasHandles.value) {
    missing.push("6. –†—É—á–∫–∏ (–≤–∏–±—ñ—Ä)");
  } else if (hasHandles.value === "yes") {
    const handles = document.querySelectorAll('[id^="handle_"]');
    if (handles.length === 0) {
      missing.push("6. –†—É—á–∫–∏ (–Ω–µ –¥–æ–¥–∞–Ω–æ –∂–æ–¥–Ω–æ—ó)");
    }
  }
  
  // 7. –ü—ñ–¥—Å–≤—ñ—Ç–∫–∞ - –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –¥–∏–Ω–∞–º—ñ—á–Ω—É –ø—ñ–¥—Å–≤—ñ—Ç–∫—É
  const hasLighting = document.getElementById("hasLighting");
  if (!hasLighting || !hasLighting.value) {
    missing.push("7. –ü—ñ–¥—Å–≤—ñ—Ç–∫–∞ (–≤–∏–±—ñ—Ä)");
  } else if (hasLighting.value === "yes") {
    const lights = document.querySelectorAll('[id^="lighting_"]');
    if (lights.length === 0) {
      missing.push("7. –ü—ñ–¥—Å–≤—ñ—Ç–∫–∞ (–Ω–µ –¥–æ–¥–∞–Ω–æ –∂–æ–¥–Ω–æ–≥–æ —Ç–∏–ø—É)");
    }
  }
  
  console.log("=== –ö—ñ–Ω–µ—Ü—å –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø–æ–ª—ñ–≤ ===");
  console.log("–í—Å—å–æ–≥–æ –≤—ñ–¥—Å—É—Ç–Ω—ñ—Ö –ø–æ–ª—ñ–≤:", missing.length);
  console.log("–°–ø–∏—Å–æ–∫ –≤—ñ–¥—Å—É—Ç–Ω—ñ—Ö –ø–æ–ª—ñ–≤:", missing);
  
  return missing;
}

function showMissingFieldsWarning(missingFields) {
  let warningText = "–ù–µ –∑–∞–ø–æ–≤–Ω–µ–Ω—ñ –Ω–∞—Å—Ç—É–ø–Ω—ñ –ø–æ–ª—è:\n\n";
  missingFields.forEach((field) => {
    warningText += `${field}\n`;
  });
  
  document.getElementById("warningText").innerText = warningText;
  document.getElementById("warningModal").style.display = "flex";
}

function closeModal() {
  document.getElementById("warningModal").style.display = "none";
}

function saveData() {
  try {
    // –ó–±–∏—Ä–∞—î–º–æ –≤—Å—ñ –¥–∞–Ω—ñ —Ñ–æ—Ä–º–∏
    const formData = {};
    document.querySelectorAll('input, select, textarea').forEach(el => {
      if (el.id && !el.closest('#settingsModal')) {
        const value = el.type === 'checkbox' || el.type === 'radio' ? el.checked : el.value;
        formData[el.id] = value;
      }
    });
    
    // –î–æ–¥–∞—î–º–æ –¥–∏–Ω–∞–º—ñ—á–Ω—ñ —Å–ø–∏—Å–∫–∏
    const dynamicData = {};
    
    // –ú–∞—Ç–µ—Ä—ñ–∞–ª–∏
    const materials = document.querySelectorAll('[id^="facadeMaterial_"]');
    materials.forEach(material => {
      const materialType = material.getAttribute('data-material-type');
      if (materialType) {
        dynamicData[`material_${materialType}`] = {
          type: materialType,
          quantity: material.getAttribute('data-quantity') || 1
        };
      }
    });
        
    // –î–æ–¥–∞—Ç–∫–æ–≤—ñ –µ–ª–µ–º–µ–Ω—Ç–∏
    const elements = document.querySelectorAll('[id^="additionalElement_"]');
    elements.forEach(element => {
      const elementType = element.getAttribute('data-element-type');
      const quantity = element.getAttribute('data-quantity') || 1;
      if (elementType) {
        dynamicData[`element_${elementType}`] = {
          type: elementType,
          quantity
        };
      }
    });
    
    // –†—É—á–∫–∏
    const handles = document.querySelectorAll('[id^="handle_"]');
    handles.forEach(handle => {
      const handleType = handle.getAttribute('data-handle-type');
      if (handleType) {
        dynamicData[`handle_${handleType}`] = {
          type: handleType
        };
      }
    });
    
    // –ü—Ä–æ—Å—Ç–æ –¥–æ–¥–∞—î–º–æ newHandleType –≤ dynamic, —è–∫—â–æ hasHandles = "yes"
    if (formData.hasHandles === "yes" && formData.newHandleType) {
      console.log('–î–æ–¥–∞—î–º–æ —Ä—É—á–∫—É –≤ dynamic:', formData.newHandleType);
      dynamicData[`handle_${formData.newHandleType}`] = {
        type: formData.newHandleType
      };
    }
    
    // –ü—ñ–¥—Å–≤—ñ—Ç–∫–∞
    const lightings = document.querySelectorAll('[id^="lighting_"]');
    lightings.forEach(lighting => {
      const lightingType = lighting.getAttribute('data-type');
      const quantity = lighting.getAttribute('data-quantity') || 1;
      if (lightingType) {
        dynamicData[`lighting_${lightingType}`] = {
          type: lightingType,
          quantity
        };
      }
    });
    
    // –î–æ–¥–∞—î–º–æ –º–µ—Ç–∞–¥–∞–Ω—ñ
    const data = {
      meta: {
        kind: 'viyar-other-furniture-calc',
        version: '1.6',
        timestamp: new Date().toISOString(),
        title: document.getElementById('productName')?.value || '–Ü–Ω—à—ñ –º–µ–±–ª—ñ'
      },
      values: formData,
      dynamic: dynamicData
    };
    
    // –°—Ç–≤–æ—Ä—é—î–º–æ —Ç–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ñ–∞–π–ª
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    
    // –ì–µ–Ω–µ—Ä—É—î–º–æ –Ω–∞–∑–≤—É —Ñ–∞–π–ª—É –∑ —É—Å—ñ–º–∞ –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏–º–∏ –ø–æ–ª—è–º–∏
    const projectNum = document.getElementById('projectNum')?.value || '–ë–µ–∑_–Ω–æ–º–µ—Ä–∞';
    const productName = document.getElementById('productName')?.value || '–ë–µ–∑_–Ω–∞–∑–≤–∏';
    const manager = document.getElementById('manager')?.value || '–ë–µ–∑_–º–µ–Ω–µ–¥–∂–µ—Ä–∞';
    const date = document.getElementById('dateField')?.value || new Date().toLocaleDateString('uk-UA');
    
    // –û—á–∏—â–∞—î–º–æ –Ω–∞–∑–≤–∏ –≤—ñ–¥ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏—Ö —Å–∏–º–≤–æ–ª—ñ–≤
    const cleanProjectNum = projectNum.replace(/[^a-zA-Z0-9–∞-—è–ê-–Ø]/gi, '_');
    const cleanProductName = productName.replace(/[^a-zA-Z0-9–∞-—è–ê-–Ø]/gi, '_');
    const cleanManager = manager.replace(/[^a-zA-Z0-9–∞-—è–ê-–Ø]/gi, '_');
    const cleanDate = date.replace(/[^a-zA-Z0-9–∞-—è–ê-–Ø]/gi, '_');
    
    a.download = `–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä_${cleanProjectNum}_${cleanProductName}_${cleanManager}_${cleanDate}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    alert('–î–∞–Ω—ñ –∑–±–µ—Ä–µ–∂–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ!');
  } catch (error) {
    console.error('–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è:', error);
    alert('–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö');
  }
}

function loadData() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.json,.vcalc.json';
  
  input.onchange = function(e) {
    const file = e.target.files && e.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = function(ev) {
      try {
        const data = JSON.parse(ev.target.result);
        if (data && data.values) {
          // –ó–∞—Å—Ç–æ—Å–æ–≤—É—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –¥–∞–Ω—ñ
          Object.keys(data.values).forEach(key => {
            const element = document.getElementById(key);
            if (element) {
              if (element.type === 'checkbox' || element.type === 'radio') {
                element.checked = data.values[key];
              } else {
                element.value = data.values[key];
              }
            }
          });
          
          // –í–∏–∫–ª–∏–∫–∞—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–∏–Ω–∞–º—ñ—á–Ω–∏—Ö –ø–æ–ª—ñ–≤
          if (data.values.hasHandles) {
            toggleHandlesFields();
          }
          
          // --- –î–æ–¥–∞—Ç–∫–æ–≤–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä—É—á–æ–∫ (–º—ñ–Ω—ñ–º–∞–ª—å–Ω–µ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è) ---
          if (data.values.hasHandles === "yes") {
            // –®—É–∫–∞—î–º–æ —Å–µ–ª–µ–∫—Ç–æ—Ä –∞–±–æ –±–ª–æ–∫ —Ä—É—á–æ–∫, —è–∫—â–æ –≤—ñ–Ω —î
            const handleSelect = document.getElementById("newHandleType");

            // –Ø–∫—â–æ —î –≤–∏–ø–∞–¥–∞—é—á–∏–π —Å–ø–∏—Å–æ–∫ —Ç–∏–ø—É —Ä—É—á–æ–∫ ‚Äî –ø—ñ–¥—Å—Ç–∞–≤–ª—è—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è
            if (handleSelect && data.values.newHandleType) {
              handleSelect.value = data.values.newHandleType;
            }
          }
          
          // –í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ –¥–∏–Ω–∞–º—ñ—á–Ω—ñ —Å–ø–∏—Å–∫–∏
          if (data.dynamic) {
            // –û—á–∏—â—É—î–º–æ —ñ—Å–Ω—É—é—á—ñ –¥–∏–Ω–∞–º—ñ—á–Ω—ñ —Å–ø–∏—Å–∫–∏
               document.getElementById('facadeMaterialsList').innerHTML = '';
               document.getElementById('additionalElementsList').innerHTML = '';
               document.getElementById('handlesList').innerHTML = '';
               document.getElementById('lightingList').innerHTML = '';
            // –í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏
            Object.keys(data.dynamic).forEach(key => {
              if (key.startsWith('material_')) {
                const materialData = data.dynamic[key];
                addMaterialFromLoad(materialData.type, materialData.quantity);
              }
            });
                        // –í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏
                        Object.keys(data.dynamic).forEach(key => {
              if (key.startsWith('material_')) {
                const materialData = data.dynamic[key];
                console.log('–í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ –º–∞—Ç–µ—Ä—ñ–∞–ª:', materialData);
                addMaterialFromLoad(materialData.type, materialData.quantity);
              }
            });
                        
            // –í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –µ–ª–µ–º–µ–Ω—Ç–∏
            Object.keys(data.dynamic).forEach(key => {
              if (key.startsWith('element_')) {
                const elementData = data.dynamic[key];
                addElementFromLoad(elementData.type, elementData.quantity);
              }
            });
            
            // –í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ —Ä—É—á–∫–∏
            Object.keys(data.dynamic).forEach(key => {
              if (key.startsWith('handle_')) {
                const handleData = data.dynamic[key];
                addHandleFromLoad(handleData.type);
              }
            });
            
            // –í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ –ø—ñ–¥—Å–≤—ñ—Ç–∫—É
            Object.keys(data.dynamic).forEach(key => {
              if (key.startsWith('lighting_')) {
                const lightingData = data.dynamic[key];
                addLightingFromLoad(lightingData.type, lightingData.quantity);
              }
            });
          }
                                  // –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ–ª—è –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤ —è–∫—â–æ —î –¥–∞–Ω—ñ
            const hasMaterials = Object.keys(data.dynamic).some(key => key.startsWith('material_'));
            if (hasMaterials) {
              document.getElementById('hasFacadeMaterials').value = 'yes';
              document.getElementById('facadeMaterialsFields').classList.remove('hidden');
              document.getElementById('addFacadeMaterialBtn').classList.remove('hidden');
            }
            
            // –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ–ª—è –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ —è–∫—â–æ —î –¥–∞–Ω—ñ
            const hasElements = Object.keys(data.dynamic).some(key => key.startsWith('element_'));
            if (hasElements) {
              document.getElementById('hasAdditionalElements').value = 'yes';
              // –î–ª—è –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –Ω–µ–º–∞—î –æ–∫—Ä–µ–º–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø–æ–ª—ñ–≤
              document.getElementById('addAdditionalElementBtn').style.display = 'inline-block';
            }
            
            // –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ–ª—è —Ä—É—á–æ–∫ —è–∫—â–æ —î –¥–∞–Ω—ñ
            const hasHandles = Object.keys(data.dynamic).some(key => key.startsWith('handle_'));
            if (hasHandles) {
              document.getElementById('hasHandles').value = 'yes';
              document.getElementById('handlesFields').classList.remove('hidden');
              document.getElementById('addHandleBtn').classList.remove('hidden');
            }
            
            // –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ–ª—è –ø—ñ–¥—Å–≤—ñ—Ç–∫–∏ —è–∫—â–æ —î –¥–∞–Ω—ñ
            const hasLighting = Object.keys(data.dynamic).some(key => key.startsWith('lighting_'));
            if (hasLighting) {
              document.getElementById('hasLighting').value = 'yes';
              document.getElementById('lightingFields').classList.remove('hidden');
              document.getElementById('addLightingBtn').classList.remove('hidden');
            }
          
          alert('–î–∞–Ω—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ!');
        }
      } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:', error);
        alert('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É');
      }
    };
    reader.readAsText(file);
  };
  
  input.click();
}


// –§—É–Ω–∫—Ü—ñ—ó –¥–ª—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–∏–Ω–∞–º—ñ—á–Ω–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
function addMaterialFromLoad(materialType, quantity) {
  const materialNames = {
    "dsp_mat_corpus": "–î–°–ü –º–∞—Ç. –∫–æ—Ä–ø—É—Å—É",
    "dsp": "–î–°–ü", 
    "mdf_boards": "–ú–î–§ –ø–ª–∏—Ç–∏",
    "paint_film_straight": "–§–∞—Ä–±–∞/–ø–ª—ñ–≤–∫–∞ \"–ø—Ä—è–º—ñ\"",
    "paint_film_milled": "–§–∞—Ä–±–∞/–ø–ª—ñ–≤–∫–∞ \"—Ñ—Ä–µ–∑–µ—Ä–æ–≤–∞–Ω—ñ\"",
    "veneered_straight": "–®–ø–æ–Ω–æ–≤–∞–Ω—ñ \"–ø—Ä—è–º—ñ\"",
    "veneered_milled": "–®–ø–æ–Ω–æ–≤–∞–Ω—ñ \"—Ñ—Ä–µ–∑–µ—Ä–æ–≤–∞–Ω—ñ\"",
    "aluminum_frame": "–ê–ª—é–º. —Ä–∞–º–∫–æ–≤—ñ",
    "arpa_fenix": "ARPA/Fenix",
    "fiushin": "Fiushin",
    "hpl": "HPL",
    "rd_facades_individual": "R&D —Ñ–∞—Å–∞–¥–∏ —ñ–Ω–¥–∏–≤—ñ–¥.",
    "mdf_facades_individual_milling": "–ú–î–§ —Ñ–∞—Å–∞–¥–∏ –∑ —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–∏–º —Ñ—Ä–µ–∑–µ—Ä—É–≤–∞–Ω–Ω—è–º"
  };
  
  const displayName = materialNames[materialType] || materialType;
  const materialsList = document.getElementById("facadeMaterialsList");
  
  const materialDiv = document.createElement("div");
  materialDiv.id = `material_${materialType}`;
  materialDiv.style.cssText = "padding: 4px 0; margin-bottom: 3px;";
  materialDiv.setAttribute('data-material-type', materialType);
  materialDiv.setAttribute('data-quantity', quantity);
  
  materialDiv.innerHTML = `
    <div style="display: flex; align-items: center; gap: 10px; font-size: 14px;">
      <span class="material-number"></span>. ${displayName}
      <button onclick="removeMaterial('material_${materialType}')" class="remove-btn" title="–í–∏–¥–∞–ª–∏—Ç–∏" style="background: #ef4444; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer;">√ó</button>
    </div>
  `;
  
  materialsList.appendChild(materialDiv);
  updateMaterialNumbers();
}

function addElementFromLoad(elementType, quantity) {
  const elementNames = {
    "metal_frame": "–ú–µ—Ç–∞–ª–æ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è —Ä–∞–º–∫–æ–≤–∞",
    "metal_volume": "–ú–µ—Ç–∞–ª–æ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –æ–±'—î–º–Ω–∞",
    "rd_detail": "–î–µ—Ç–∞–ª—å R&D, –≥–Ω—É—Ç–∏–π –µ–ª–µ–º–µ–Ω—Ç —Ç–æ—â–æ",
    "false_horizontal": "–§–∞–ª—å—à –ø–∞–Ω–µ–ª—ñ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ñ",
    "false_vertical": "–§–∞–ª—å—à –ø–∞–Ω–µ–ª—ñ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ñ"
  };
  
  const displayName = elementNames[elementType] || elementType;
  const elementsList = document.getElementById("additionalElementsList");
  
  const elementDiv = document.createElement("div");
  elementDiv.id = `additionalElement_${elementType}`;
  elementDiv.style.cssText = "padding: 4px 0; margin-bottom: 3px;";
  elementDiv.setAttribute('data-element-type', elementType);
  elementDiv.setAttribute('data-quantity', quantity);
  
  elementDiv.innerHTML = `
    <div style="display: flex; align-items: center; gap: 10px; font-size: 14px;">
      <span class="element-number"></span>. ${displayName}
      <input type="number" id="quantity_${elementDiv.id}" value="${quantity}" min="1" onchange="updateElementQuantity('${elementDiv.id}')" style="width: 100px; padding: 5px; border: 1px solid #ccc; border-radius: 4px;">
      <button onclick="removeElement('additionalElement_${elementType}')" class="remove-btn" title="–í–∏–¥–∞–ª–∏—Ç–∏" style="background: #ef4444; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer;">√ó</button>
    </div>
  `;
  
  elementsList.appendChild(elementDiv);
  updateElementNumbers();
}

function addHandleFromLoad(handleType) {
  const handleNames = {
    "handles_gola": "GOLA",
    "handles_end": "–¢–æ—Ä—Ü–µ–≤—ñ",
    "handles_milled": "–§—Ä–µ–∑–µ—Ä–æ–≤–∞–Ω—ñ",
    "handles_other": "–Ü–Ω—à—ñ"
  };
  
  const displayName = handleNames[handleType] || handleType;
  const handlesList = document.getElementById("handlesList");
  
  const handleDiv = document.createElement("div");
  handleDiv.id = `handle_${handleType}`;
  handleDiv.style.cssText = "padding: 4px 0; margin-bottom: 3px;";
  handleDiv.setAttribute('data-type', handleType);
  
  handleDiv.innerHTML = `
    <div style="display: flex; align-items: center; gap: 10px; font-size: 14px;">
      <span class="handle-number"></span>. ${displayName}
      <button onclick="removeHandle('handle_${handleType}')" class="remove-btn" title="–í–∏–¥–∞–ª–∏—Ç–∏" style="background: #ef4444; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer;">√ó</button>
    </div>
  `;
  
  handlesList.appendChild(handleDiv);
  updateHandleNumbers();
}

function addLightingFromLoad(lightingType, quantity) {
  const lightingNames = {
    "light_elements": "–ï–ª–µ–º–µ–Ω—Ç—ñ–≤ (–¥–µ—Ç–∞–ª–µ–π) –∑ –ø—ñ–¥—Å–≤—ñ—Ç–∫–æ—é",
    "light_control": "–ü—Ä–∏—Å—Ç—Ä–æ—ó–≤ –∫–µ—Ä—É–≤–∞–Ω–Ω—è —ñ –≤–∏–º—ñ—Ä—é—é—Ç—å—Å—è –≤ –∫—ñ–ª—å–∫–æ—Å—Ç—è—Ö"
  };
  
  const displayName = lightingNames[lightingType] || lightingType;
  const lightingList = document.getElementById("lightingList");
  
  const lightingDiv = document.createElement("div");
  lightingDiv.id = `lighting_${lightingType}`;
  lightingDiv.style.cssText = "padding: 4px 0; margin-bottom: 3px;";
  lightingDiv.setAttribute('data-type', lightingType);
  lightingDiv.setAttribute('data-quantity', quantity);
  
  lightingDiv.innerHTML = `
    <div style="display: flex; align-items: center; gap: 10px; font-size: 14px;">
      <span class="lighting-number"></span>. ${displayName}
      <input type="number" id="quantity_${lightingDiv.id}" value="${quantity}" min="1" onchange="updateLightingQuantity('${lightingDiv.id}')" style="width: 100px; padding: 5px; border: 1px solid #ccc; border-radius: 4px;">
      <button onclick="removeLighting('lighting_${lightingType}')" class="remove-btn" title="–í–∏–¥–∞–ª–∏—Ç–∏" style="background: #ef4444; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer;">√ó</button>
    </div>
  `;
  
  lightingList.appendChild(lightingDiv);
  updateLightingNumbers();
}

// –§—É–Ω–∫—Ü—ñ—è –æ—á–∏—â–µ–Ω–Ω—è —Ñ–æ—Ä–º–∏
function clearForm() {
  if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –æ—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –¥–∞–Ω—ñ?')) {
    // –û—á–∏—â—É—î–º–æ –≤—Å—ñ –ø–æ–ª—è –≤–≤–æ–¥—É
    document.querySelectorAll("input, select, textarea").forEach(el => {
      if (el.id !== "dateField" && !el.closest('#settingsModal')) {
        if (el.type === 'checkbox' || el.type === 'radio') {
          el.checked = false;
        } else {
          el.value = "";
        }
      }
    });
    
    // –û—á–∏—â—É—î–º–æ –¥–∏–Ω–∞–º—ñ—á–Ω—ñ —Å–ø–∏—Å–∫–∏
    document.getElementById("materialsList").innerHTML = "";
    document.getElementById("additionalElementsList").innerHTML = "";
    document.getElementById("handlesList").innerHTML = "";
    document.getElementById("lightingList").innerHTML = "";
    
    // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ –ø–æ–ª—è –¥–∏–Ω–∞–º—ñ—á–Ω–∏—Ö —Ä–æ–∑–¥—ñ–ª—ñ–≤
    document.getElementById("materialsFields").classList.add("hidden");
    document.getElementById("additionalElementsFields").classList.add("hidden");
    document.getElementById("handlesFields").classList.add("hidden");
    document.getElementById("lightingFields").classList.add("hidden");
    
    // –°–∫–∏–¥–∞—î–º–æ —Å–µ–ª–µ–∫—Ç–∏ –Ω–∞ "no"
    document.getElementById("hasMaterials").value = "no";
    document.getElementById("hasElements").value = "no";
    document.getElementById("hasHandles").value = "no";
    document.getElementById("hasLighting").value = "no";
    
    // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ –ª—ñ—á–∏–ª—å–Ω–∏–∫ –ø–æ—ñ–Ω—Ç—ñ–≤
    document.getElementById("pointsHUD").style.display = "none";
    
    alert('–§–æ—Ä–º–∞ –æ—á–∏—â–µ–Ω–∞!');
  }
}

function calculate() {
  // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –≤—Å—ñ –æ–±–æ–≤'—è–∑–∫–æ–≤—ñ –ø–æ–ª—è –∑–∞–ø–æ–≤–Ω–µ–Ω—ñ
  const missingFields = checkRequiredFields();
  
  if (missingFields.length > 0) {
    showMissingFieldsWarning(missingFields);
    return;
  }
  
  points = 0; // –°–∫–∏–¥–∞—î–º–æ –≥–ª–æ–±–∞–ª—å–Ω—É –∑–º—ñ–Ω–Ω—É
  
  // ===== 1. –û—Å–Ω–æ–≤–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ =====
  (function(){
    // –î–∏–Ω–∞–º—ñ—á–Ω—ñ –≤–∏—Ä–æ–±–∏
    addedProducts.forEach(product => {
      const productNames = {
        "–°—Ç–µ–ª–∞–∂–Ω–∞ —Å-–º–∞ ( –∫-—Å—Ç—å –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∏—Ö —Å–µ–∫—Ü—ñ–π/–º–æ–¥—É–ª—ñ–≤)": "–°—Ç–µ–ª–∞–∂–Ω–∞ —Å-–º–∞",
        "–ü—Ä–∏—Å—Ç—ñ–Ω–Ω–∞ —Å-–º–∞  ( –∫-—Å—Ç—å –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∏—Ö —Å–µ–∫—Ü—ñ–π/–º–æ–¥—É–ª—ñ–≤)": "–ü—Ä–∏—Å—Ç—ñ–Ω–Ω–∞ —Å-–º–∞"
      };
      
      const productName = productNames[product.type] || product.type;
      
      // –ú–∞–ø–∞ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è ID –ø–æ–ª—ñ–≤
      const productIdMap = {
        "–°—Ç–µ–ª–∞–∂–Ω–∞ —Å-–º–∞ ( –∫-—Å—Ç—å –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∏—Ö —Å–µ–∫—Ü—ñ–π/–º–æ–¥—É–ª—ñ–≤)": "p_wardrobe_systems_product_—Å—Ç–µ–ª–∞–∂–Ω–∞_–ø—ñ–¥–ª–æ–≥–∞_—Å—Ç—ñ–Ω–∞",
        "–ü—Ä–∏—Å—Ç—ñ–Ω–Ω–∞ —Å-–º–∞  ( –∫-—Å—Ç—å –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∏—Ö —Å–µ–∫—Ü—ñ–π/–º–æ–¥—É–ª—ñ–≤)": "p_wardrobe_systems_product_–ø—Ä–∏—Å—Ç—ñ–Ω–Ω–∞_—Å-–º–∞"
      };
      
      const productId = productIdMap[product.type] || "p_wardrobe_systems_product_—Å—Ç–µ–ª–∞–∂–Ω–∞_–ø—ñ–¥–ª–æ–≥–∞_—Å—Ç—ñ–Ω–∞";
      addDetail(`–í–∏–¥ –≤–∏—Ä–æ–±—É: ${productName}`, product.quantity, productId);
    });
  })();
  
 // ===== –§–æ—Ä–º–∞ –≤–∏—Ä–æ–±—É =====
 (function(){
    const productShape = document.getElementById("productShape")?.value;
    if (productShape) {
      const shapeMap = {
        "–ü—Ä—è–º–∞": "p_wardrobe_systems_shape_straight",
        "–ö—É—Ç–æ–≤–∞": "p_wardrobe_systems_shape_corner", 
        "–ü-–ø–æ–¥—ñ–±–Ω–∞": "p_wardrobe_systems_shape_u",
        "G-–ø–æ –ø–µ—Ä–∏–º–µ—Ç—Ä—É": "p_wardrobe_systems_shape_g"
      };
      const shapeId = shapeMap[productShape];
      if (shapeId) {
        addDetail(`–§–æ—Ä–º–∞ –≤–∏—Ä–æ–±—É: ${productShape}`, 1, shapeId);
      }
    }
  })();
  
  // ===== –ó–∞–º—ñ—Ä–∏ =====
  (function(){
    const measure = document.getElementById("measure")?.value;
    if (measure) {
      const measureMap = {
        "–ë–µ–∑ –∑–∞–º—ñ—Ä—ñ–≤": "p_wardrobe_systems_measure_no",
        "–ü–æ –∑–∞–º—ñ—Ä–∞–º 3D": "p_wardrobe_systems_measure_3d", 
        "–ü–æ –∑–∞–º—ñ—Ä–∞–º —Ñ–æ—Ç–æ-–µ—Å–∫—ñ–∑": "p_wardrobe_systems_measure_photo"
      };
      const measureId = measureMap[measure];
      if (measureId) {
        addDetail(`–ó–∞–º—ñ—Ä–∏: ${measure}`, 1, measureId);
      }
    }
  })();
  
  // ===== –î–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ =====
  (function(){
    const geometry = document.getElementById("geom")?.value;
    if (geometry === "–¢–∞–∫") {
      addDetail("–ù–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ –≥–µ–æ–º–µ—Ç—Ä—ñ—è –ø—Ä–∏–º—ñ—â–µ–Ω–Ω—è", 1, "p_wardrobe_systems_geometry");
    }
    
    
    const corpus = valInt("corpus");
    if (corpus > 0) {
      addDetail("–ú–∞—Ç–µ—Ä—ñ–∞–ª –∫–æ—Ä–ø—É—Å—É (—à—Ç.)", corpus, "p_wardrobe_systems_corpus");
    }
    
    const glass = document.getElementById("glassSelect")?.value;
    if (glass === "–¢–∞–∫") {
      addDetail("–°–∫–ª–æ-–¥–∑–µ—Ä–∫–∞–ª–æ", 1, "p_wardrobe_systems_glass");
    }
  })();
  
  // ===== 2. –ú–∞—Ç–µ—Ä—ñ–∞–ª–∏ =====
  (function(){
    // –î–∏–Ω–∞–º—ñ—á–Ω—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏
    const materials = document.querySelectorAll('[id^="facadeMaterial_"]');
    materials.forEach(material => {
      const materialType = material.getAttribute('data-material-type');
      const materialNames = {
        "dsp_mat_corpus": "–î–°–ü –º–∞—Ç. –∫–æ—Ä–ø—É—Å—É",
        "dsp": "–î–°–ü",
        "mdf_boards": "–ú–î–§ –ø–ª–∏—Ç–∏",
        "paint_film_straight": "–§–∞—Ä–±–∞/–ø–ª—ñ–≤–∫–∞ \"–ø—Ä—è–º—ñ\"",
        "paint_film_milled": "–§–∞—Ä–±–∞/–ø–ª—ñ–≤–∫–∞ \"—Ñ—Ä–µ–∑–µ—Ä–æ–≤–∞–Ω—ñ\"",
        "veneered_straight": "–®–ø–æ–Ω–æ–≤–∞–Ω—ñ \"–ø—Ä—è–º—ñ\"",
        "veneered_milled": "–®–ø–æ–Ω–æ–≤–∞–Ω—ñ \"—Ñ—Ä–µ–∑–µ—Ä–æ–≤–∞–Ω—ñ\"",
        "aluminum_frame": "–ê–ª—é–º. —Ä–∞–º–∫–æ–≤—ñ",
        "arpa_fenix": "ARPA/Fenix",
        "fiushin": "Fiushin",
        "hpl": "HPL",
        "rd_facades_individual": "R&D —Ñ–∞—Å–∞–¥–∏ —ñ–Ω–¥–∏–≤—ñ–¥.",
        "mdf_facades_individual_milling": "–ú–î–§ —Ñ–∞—Å–∞–¥–∏ –∑ —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–∏–º —Ñ—Ä–µ–∑–µ—Ä—É–≤–∞–Ω–Ω—è–º"
      };
      
      const materialName = materialNames[materialType] || materialType;
      const count = 1; // –ö–æ–∂–µ–Ω –º–∞—Ç–µ—Ä—ñ–∞–ª —Ä–∞—Ö—É—î—Ç—å—Å—è —è–∫ 1
      addDetail(`–ú–∞—Ç–µ—Ä—ñ–∞–ª: ${materialName}`, count, `p_wardrobe_systems_material_${materialType}`);
    });
  })();
   
  // ===== 3. –î–æ–¥–∞—Ç–∫–æ–≤—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ =====
  (function(){
    const elements = document.querySelectorAll('[id^="additionalElement_"]');
    elements.forEach(element => {
      const elementType = element.getAttribute('data-element-type');
      const quantity = parseInt(element.getAttribute('data-quantity')) || 1;
      
      const elementNames = {
        "metal_frame": "–ú–µ—Ç–∞–ª–æ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è —Ä–∞–º–∫–æ–≤–∞",
        "metal_volume": "–ú–µ—Ç–∞–ª–æ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –æ–±'—î–º–Ω–∞",
        "rd_detail": "–î–µ—Ç–∞–ª—å R&D, –≥–Ω—É—Ç–∏–π –µ–ª–µ–º–µ–Ω—Ç —Ç–æ—â–æ",
        "false_horizontal": "–§–∞–ª—å—à –ø–∞–Ω–µ–ª—ñ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ñ",
        "false_vertical": "–§–∞–ª—å—à –ø–∞–Ω–µ–ª—ñ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ñ"
      };
      
      const elementName = elementNames[elementType] || elementType;
      addDetail(`–î–æ–¥–∞—Ç–∫–æ–≤–∏–π –µ–ª–µ–º–µ–Ω—Ç: ${elementName}`, quantity, `p_wardrobe_systems_element_${elementType}`);
    });
  })();
  
  // ===== 4. –°–∫–ª–∞–¥–æ–≤—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –≥–∞—Ä–¥–µ—Ä–æ–±–Ω–æ—ó =====
  (function(){
    addDetail("–¢—É–º–±–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è 90*", valInt("furnTumba90"), "p_wardrobe_systems_furn_tumba_90");
    addDetail("–¢—É–º–±–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è 45*", valInt("furnTumba45"), "p_wardrobe_systems_furn_tumba_45");
    addDetail("–ü–æ–ª–∏—Ü—è –ø—Ä—è–º–∞", valInt("furnShelfStraight"), "p_wardrobe_systems_furn_shelf_straight");
    addDetail("–ü–æ–ª–∏—Ü—è –∑–±—ñ—Ä–Ω–∞ (–±–∞–≥–∞—Ç–æ–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∞)", valInt("furnShelfMulti"), "p_wardrobe_systems_furn_shelf_multi");
    addDetail("–ü–æ–¥—ñ—É–º", valInt("furnPodium"), "p_wardrobe_systems_furn_podium");
    addDetail("–Ø—â–∏–∫–∏", valInt("furnDrawers"), "p_wardrobe_systems_furn_drawers");
    addDetail("–ë–∞—Ä–Ω—ñ –º–µ—Ö–∞–Ω—ñ–∑–º–∏", valInt("furnBarMechanisms"), "p_wardrobe_systems_furn_bar");
    addDetail("–ê–∫—Å–µ—Å—É–∞—Ä–∏: –∫–æ—à–∏–∫–∏, –ø–æ–ª–∏—Ü—ñ –¥–ª—è –≤–∑—É—Ç—Ç—è —Ç–æ—â–æ", valInt("furnWardrobeAccessories"), "p_wardrobe_systems_furn_accessories");
    addDetail("–ö-—Å—Ç—å —à—Ç–∞–Ω–≥ –¥–ª—è –æ–¥—è–≥—É", valInt("furnClothingRods"), "p_wardrobe_systems_furn_rods");
    addDetail("–ü—ñ–¥–π–æ–º–Ω—ñ –º–µ—Ö–∞–Ω—ñ–∑–º–∏", valInt("furnLifts"), "p_wardrobe_systems_furn_lifts");
  })();
  
  // ===== 5. –Ü–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ =====
  (function(){
    const integratedElements = document.querySelectorAll('[id^="integratedElement_"]');
    console.log('–ó–Ω–∞–π–¥–µ–Ω–æ —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤:', integratedElements.length);
    integratedElements.forEach(element => {
      const elementType = element.getAttribute('data-type');
      const quantity = parseInt(element.getAttribute('data-quantity')) || 1;
      
      console.log('–û–±—Ä–æ–±–ª—è—î–º–æ —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–∏–π –µ–ª–µ–º–µ–Ω—Ç:', elementType, '–∫—ñ–ª—å–∫—ñ—Å—Ç—å:', quantity);
      
      const elementNames = {
        "technical_hatch": "–õ—é–∫ —Ç–µ—Ö–Ω—ñ—á–Ω–∏–π (—Ä–µ–≤—ñ–∑—ñ–π–Ω–∏–π, –µ–ª–µ–∫—Ç—Ä–æ - —Ç–æ—â–æ)",
        "appliances": "–¢–µ—Ö–Ω—ñ–∫–∞ (–ø—Ä–∞–ª–∫–∞, —Å—É—à–∫–∞, —Å–µ–π—Ñ, –≤–∏–Ω–∏–Ω–∞ —à–∞—Ñ–∞ —Ç–æ—â–æ)"
      };
      
      const elementName = elementNames[elementType] || elementType;
      addDetail(`–Ü–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–∏–π –µ–ª–µ–º–µ–Ω—Ç: ${elementName}`, quantity, `p_wardrobe_systems_integrated_${elementType}`);
    });
  })();
  
  // ===== 6. –†—É—á–∫–∏ =====
  (function(){
    const handles = document.querySelectorAll('[id^="handle_"]');
    handles.forEach(handle => {
      const handleType = handle.getAttribute('data-type');
      const handleNames = {
        "handles_gola": "GOLA",
        "handles_end": "–¢–æ—Ä—Ü–µ–≤—ñ",
        "handles_milled": "–§—Ä–µ–∑–µ—Ä–æ–≤–∞–Ω—ñ",
        "handles_other": "–Ü–Ω—à—ñ"
      };
      
      const handleName = handleNames[handleType] || handleType;
      addDetail(`–†—É—á–∫–∞: ${handleName}`, 1, `p_wardrobe_systems_handle_${handleType.replace('handles_', '')}`);
    });
  })();
  
  // ===== 7. –ü—ñ–¥—Å–≤—ñ—Ç–∫–∞ =====
  (function(){
    const lightings = document.querySelectorAll('[id^="lighting_"]');
    lightings.forEach(lighting => {
      const lightingType = lighting.getAttribute('data-type');
      const quantity = parseInt(lighting.getAttribute('data-quantity')) || 1;
      
      const lightingNames = {
        "light_elements": "–ï–ª–µ–º–µ–Ω—Ç—ñ–≤ (–¥–µ—Ç–∞–ª–µ–π) –∑ –ø—ñ–¥—Å–≤—ñ—Ç–∫–æ—é",
        "light_control": "–ü—Ä–∏—Å—Ç—Ä–æ—ó–≤ –∫–µ—Ä—É–≤–∞–Ω–Ω—è —ñ –≤–∏–º—ñ—Ä—é—é—Ç—å—Å—è –≤ –∫—ñ–ª—å–∫–æ—Å—Ç—è—Ö"
      };
      
      const lightingName = lightingNames[lightingType] || lightingType;
      addDetail(`–ü—ñ–¥—Å–≤—ñ—Ç–∫–∞: ${lightingName}`, quantity, `p_wardrobe_systems_lighting_${lightingType}`);
    });
  })();
  
  // ===== –î–æ–¥–∞—î–º–æ –ø–æ—Å—Ç—ñ–π–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è =====
  const constantValue = parseFloat(document.getElementById('constant_value')?.value || 0);
  if (constantValue !== 0) {
    points += constantValue;
    console.log(`–ü–æ—Å—Ç—ñ–π–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è: ${constantValue} (–∑–∞–≥–∞–ª–æ–º: ${points})`);
  }
  
  // –ü–æ–∫–∞–∑—É—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
  document.getElementById('pointsHUD').style.display = 'inline-block';
  document.getElementById('pointsHUD').textContent = `–ü–æ—ñ–Ω—Ç–∏: ${points}`;
  
  return points;
}



// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è PDF
async function downloadPDF() {
  try {
    // –ü–æ–∫–∞–∑—É—î–º–æ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
    const button = document.querySelector('button[onclick="downloadPDF()"]');
    const originalText = button.textContent;
    button.textContent = '–ì–µ–Ω–µ—Ä—É—î–º–æ PDF...';
    button.disabled = true;
    
    // –Ü–º–ø–æ—Ä—Ç—É—î–º–æ html2canvas
    const html2canvas = window.html2canvas;
    const jsPDF = window.jspdf.jsPDF;
    
    // –û—Ç—Ä–∏–º—É—î–º–æ –µ–ª–µ–º–µ–Ω—Ç –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó
    const element = document.querySelector('.wrapper');
    
    // –ö–æ–Ω–≤–µ—Ä—Ç—É—î–º–æ –≤ canvas
    const canvas = await html2canvas(element, {
      scale: 2, // –í–∏—â–∞ —è–∫—ñ—Å—Ç—å
      useCORS: true,
      allowTaint: true,
      backgroundColor: '#ffffff',
      width: element.scrollWidth,
      height: element.scrollHeight
    });
    
    // –°—Ç–≤–æ—Ä—é—î–º–æ PDF
    const imgData = canvas.toDataURL('image/png');
    const pdf = new jsPDF('p', 'mm', 'a4');
    
    // –†–æ–∑—Ä–∞—Ö–æ–≤—É—î–º–æ —Ä–æ–∑–º—ñ—Ä–∏ –¥–ª—è A4
    const pdfWidth = pdf.internal.pageSize.getWidth();
    const pdfHeight = pdf.internal.pageSize.getHeight();
    const imgWidth = canvas.width;
    const imgHeight = canvas.height;
    const ratio = Math.min(pdfWidth / imgWidth, pdfHeight / imgHeight);
    const imgX = (pdfWidth - imgWidth * ratio) / 2;
    const imgY = 0;
    
    // –î–æ–¥–∞—î–º–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –¥–æ PDF
    pdf.addImage(imgData, 'PNG', imgX, imgY, imgWidth * ratio, imgHeight * ratio);
    
    // –ì–µ–Ω–µ—Ä—É—î–º–æ –Ω–∞–∑–≤—É —Ñ–∞–π–ª—É
    const projectNum = document.getElementById('projectNum').value || '–ë–µ–∑_–Ω–æ–º–µ—Ä–∞';
    const productName = document.getElementById('productName').value || '–ë–µ–∑_–Ω–∞–∑–≤–∏';
    const date = document.getElementById('dateField').value || new Date().toLocaleDateString('uk-UA');
    const fileName = `–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä_—ñ–Ω—à—ñ_–º–µ–±–ª—ñ_${projectNum}_${productName}_${date}.pdf`;
    
    // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ PDF
    pdf.save(fileName);
    
    // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –∫–Ω–æ–ø–∫—É –≤ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π —Å—Ç–∞–Ω
    button.textContent = originalText;
    button.disabled = false;
    
  } catch (error) {
    console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ PDF:', error);
    alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ PDF. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.');
    
    // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –∫–Ω–æ–ø–∫—É –≤ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π —Å—Ç–∞–Ω
    const button = document.querySelector('button[onclick="downloadPDF()"]');
    button.textContent = '–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ PDF';
    button.disabled = false;
  }
}


</script>
</body>
</html>
</html>