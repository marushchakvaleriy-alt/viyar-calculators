<html lang="uk">
<head>
<meta charset="utf-8"/>
<title>Калькулятор поінтів — Viyar</title>
<style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f3f4f6;
      font-size: 14px;
    }
    .wrapper {
      max-width: 1100px;
      margin: 20px auto;
      background: white;
      padding: 10px 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    header {
      padding: 10px 0;
      position: relative;
      background: white;
    }
    .title-small {
      font-size: 12px;
      color: #4b5563;
      margin-bottom: 4px;
    }
    .header-line {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }
    header img { height: 32px; }
    header label { margin-left: 6px; font-size: 13px; }
    input, select {
      font-size: 14px;
      padding: 6px 10px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      background: #fff;
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    input:focus, select:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 2px rgba(37,99,235,0.2);
    }
    header input { width: 110px; }
    button {
      background: #2563eb;
      color: white;
      border: none;
      padding: 6px 14px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
    }
    button:hover { background: #1d4ed8; }
    .section { margin: 20px 0; }
    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      align-items: start;
    }
    .facade-list label {
      display: block;
      margin: 8px 0 4px;
    }
    .hidden { display: none; }
        /* Модальне вікно - сучасний дизайн */
        .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px);
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-content {
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      padding: 0;
      border-radius: 16px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow: hidden;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
      animation: slideUp 0.3s ease-out;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    @keyframes slideUp {
      from { 
        transform: translateY(30px);
        opacity: 0;
      }
      to { 
        transform: translateY(0);
        opacity: 1;
      }
    }

    .modal-header {
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      color: white;
      padding: 20px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .modal-header h3 {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
      color: white;
    }

    /* Стилі для кнопки видалення (×) */
    .remove-btn {
      background: none !important;
      border: none !important;
      color: #000 !important;
      font-size: 16px !important;
      cursor: pointer !important;
      padding: 2px 6px !important;
      margin-left: 8px !important;
      border-radius: 0 !important;
      font-weight: bold !important;
    }
    .remove-btn:hover {
      color: #dc2626 !important;
      background: none !important;
    }
  
    .settings-modal { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; background: rgba(0,0,0,.35); z-index: 9999; }
    .settings-content { position: relative; background:#fff; padding:16px 20px; border-radius:12px; max-width:720px; width:95%; max-height:80vh; overflow:auto; box-shadow:0 10px 30px rgba(0,0,0,.2); }
    .settings-close { position:absolute; top:10px; right:12px; border:none; background:transparent; font-size:20px; line-height:1; cursor:pointer; color:#6b7280; }
    .settings-close:hover { color:#111827; }
  
    .header-bar { display:flex; align-items:center; justify-content:space-between; gap:12px; }
    .points-hud { display:inline-block; padding:8px 14px; border-radius:999px; background:#eef2ff; color:#1d4ed8; font-weight:700; border:1px solid #c7d2fe; font-size:16px; }
    @media (max-width:640px){ .points-hud { font-size:12px; padding:4px 8px; } }
    
   /* Підказки */
   .tooltip-container {
      position: relative;
      display: inline-block;
      margin-left: 5px;
    }
    .tooltip-icon {
      display: inline-block;
      width: 16px;
      height: 16px;
      background: #6b7280;
      color: white;
      border-radius: 50%;
      text-align: center;
      line-height: 16px;
      font-size: 12px;
      font-weight: bold;
      cursor: help;
      vertical-align: middle;
    }
    .tooltip-icon:hover {
      background: #374151;
    }
    .tooltip-content {
      position: absolute;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      background: #1f2937;
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 12px;
      line-height: 1.4;
      white-space: nowrap;
      max-width: 300px;
      white-space: normal;
      z-index: 1000;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s, visibility 0.3s;
    }
    .tooltip-content::after {
      content: "";
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      border: 5px solid transparent;
      border-top-color: #1f2937;
    }
    .tooltip-container:hover .tooltip-content {
      opacity: 1;
      visibility: visible;
    }
    
       /* Стилі для друку - оптимізовано для А4 */
    @media print {
      @page {
        size: A4;
        margin: 0.5cm 0.5cm 0.5cm 0.5cm;
      }
      
      .no-print,
      .header-bar,
      .password-field,
      .calc-actions,
      .modal,
      .password-modal,
      .settings-modal {
        display: none !important;
      }
      
      /* Показуємо поінти при друку */
      .points-hud {
        display: inline-block !important;
        background: #f0f0f0 !important;
        border: 1px solid #ccc !important;
        padding: 3px 6px !important;
        margin: 5px 0 !important;
        font-weight: bold !important;
        font-size: 12px !important;
      }
      
      * {
        box-sizing: border-box;
      }
      
      body {
        font-size: 10px !important;
        line-height: 1.2 !important;
        margin: 0 !important;
        padding: 0 !important;
        color: #000 !important;
        background: white !important;
      }
      
      .wrapper {
        margin: 0 !important;
        padding: 0 !important;
        width: 100% !important;
        max-width: none !important;
      }
      
      header {
        margin: 0 0 5px 0 !important;
        padding: 0 !important;
        page-break-after: avoid;
      }
      
      .container {
        margin: 0 !important;
        padding: 0 !important;
        width: 100% !important;
      }
      
      .section {
        margin: 0 0 5px 0 !important;
        padding: 0 !important;
        page-break-inside: avoid;
        break-inside: avoid;
        orphans: 1;
        widows: 1;
      }
      
      h3 {
        font-size: 11px !important;
        margin: 3px 0 2px 0 !important;
        color: #000 !important;
        page-break-after: avoid;
        font-weight: bold !important;
      }
      
      label {
        font-size: 9px !important;
        margin: 0 0 1px 0 !important;
        display: inline-block !important;
        width: auto !important;
      }
      
      input, select {
        font-size: 9px !important;
        padding: 1px 2px !important;
        margin: 0 0 1px 0 !important;
        border: 1px solid #ccc !important;
        width: 60px !important;
        height: 16px !important;
      }
      
      /* Компактний макет для полів */
      .section > div {
        margin: 0 !important;
        padding: 0 !important;
      }
      
      /* Групування полів в рядки */
      .section label {
        display: inline-block !important;
        width: 120px !important;
        margin-right: 5px !important;
        vertical-align: top !important;
      }
      
      .section input, .section select {
        display: inline-block !important;
        width: 50px !important;
        margin-right: 15px !important;
        margin-bottom: 2px !important;
      }
      
      /* Спеціальні правила для flex-контейнерів */
      .section div[style*="flex"] {
        display: block !important;
      }
      
      .section div[style*="flex"] > div {
        display: inline-block !important;
        margin-right: 20px !important;
        vertical-align: top !important;
      }
      
      /* Приховуємо зайві елементи */
      .tooltip-container {
        display: none !important;
      }
      
      /* Мінімальні відступи */
      br {
        line-height: 0.5 !important;
      }
      
      /* Уникаємо розривів сторінки */
      .section:nth-child(5),
      .section:nth-child(6),
      .section:nth-child(7),
      .section:nth-child(8),
      .section:nth-child(9),
      .section:nth-child(10) {
        page-break-before: avoid !important;
        page-break-inside: avoid !important;
        break-inside: avoid !important;
      }
    }
</style>
</head>

<body>
<div class="wrapper">
<header>
  <div class="title-small">
    <span>Калькулятор Стінові панелі v1</span>
  </div>
<div class="header-line">
<img alt="Viyar" src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAMCAgMCAgMDAwMEAwMEBQgFBQQEBQoHBwYIDAoMDAsKCwsNDhIQDQ4RDgsLEBYQERMUFRUVDA8XGBYUGBIUFRT/2wBDAQMEBAUEBQkFBQkUDQsNFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBT/wAARCAEbAnEDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD9U6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACk3UtNY0AG7HY1Tuta0+xOLm9gtz/01kVf5muI+InjiTTnOnafJtnxmWXrsyOAPf8Axry6SZ5ZC8rs8jdWZsn86/EeJvEuhk2KlgsHT9rOPxNuyv29T6XA5LPFU1VqS5U9u59GWupWt6pNvcRzjrmNg38qsbvY1832d5Pp86zW0zwSr0eM4NeyeAvFx8SWLpcbVvYcCTbwGHZgM16HCfiFhuIqywdeHs6z27PyRlmGUVMHH2kXzROtzRSUor9dPnxaKKKYBRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFRyfyqSmMOfaplqrAfO+uTPca5fyyHLNM55/3jx+HT8Ko9a6Xx9oMmjeIZ5NhFvcsZI26gknJH1zn8xXNZDciv89s9wtfB5niKOJVpqT/ABd7n69hKkKtGEobWQvPeuo+G1y9v4utlXpKrIw9RtJ/mP1rl+PWvQPhPockl9JqcikRRjy4892PUj8P517fBeFxGKz7CrDp3jK7fZLdnLmlSFPCVObqrHqhPBpy96TG4U5a/vA/KxaKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKa3HNAC5oz+FN+9yOadikAZozSbaM4oAWik3D1oWgB1FFFMAooooAKSlprdaAF3UZpPejtSAXNLTdtByKAHU1qBQevSmBR1fR7XXLNra7iEsZ6diD6g9jXnt98H5/MY2d8pTsJgQR+I6/lXqHakX8a+SznhXKc+kp46jeS6rR/ed+Gx1fC/wpWR5zo/whSOYPqN35yj/AJZQjaD9T1r0CzsorC3SGCNYo0GFVRwBU/50jVvk/DmW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L6V4+R8o5/CkzuG4Hce/ft/Kjua/qXA4WOCw8MPTWkUl/wAE/lfG4qWNxE8RN6ydxKM9v8ilz2Fdz8FfhvP8VPiTo/h9IpHtZpRJeugP7u2U5kJPbI+UE/xMvrWuJrwwtGdao9Iq7MsPQnia0aNNaydkfbn7F/wz/wCEH+FMWr3UHlaprzi8cMOVgAIhX6bSX/7aGvoNagsbWGxtIba3jWKCFBGkaDAVQMAD2FWK/lvHYqeOxM8RPeTuf1Nl+EjgcLTw0PsoWiiiuE9AKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigArJ8SeFtJ8Xae9hrOnWuqWTjmC7iWRfTIBHB68itaiqjJxalF2aJlGM4uMldM+Svih+wZo2qLLd+C9SfR7n7wsb5mlt/orffT8d30r5l8T/s2/EnwrdvBP4R1G9VTgT6XCbuNx6jywSPxANfqfRX2uB4uzHBx5JtVF/e/zPh8fwfl2MlzwvTfl/kfl94P/AGWfiT4xuo4l8OXGkQMfmudWH2dEBI5Kt85/BTX3V8B/gDo/wS0F4bZxf6zcgfa9SkQBpMdEUfwoM9Px+nq9FcWa8SY3No+znaMOy/U7Mp4ZweUz9rC8p92NCn1paWivlT64KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/Z"/>
<label>Проєкт № <input id="projectNum" placeholder="Номер" type="text"/></label>
<label>Назва виробу <input id="productName" placeholder="Назва" type="text"/></label>
<label>Менеджер <input id="managerName" placeholder="Прізвище" type="text"/></label>
<label>Дата 
<input id="dateField" placeholder="Дата автоматично" type="text" readonly style="background-color: #f5f5f5; cursor: not-allowed;" value=""/>

</label>
<button class="no-print" onclick="saveData()">Зберегти</button>
<button class="no-print" onclick="loadData()">Завантажити</button>
<button class="no-print" onclick="downloadPDF()" style="margin-left:8px;background:#2563eb;color:#fff;border:none;border-radius:6px;padding:6px 12px;cursor:pointer;">Зберегти PDF</button>
</div>
</header>
<div class="container">
  <h3>1. Основні параметри</h3>
  <div style="display: flex; gap: 20px; align-items: flex-start; margin-bottom: 20px;">
    <div style="flex: 1;">
      <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
        <label>Вид виробу:</label>
        <button type="button" id="addProductBtn" onclick="showAddProductModal()" style="background: #2563eb; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 13px;">
          + Додати виріб
        </button>
      </div>
      <div id="productsList"></div>
      
      <div style="margin-top: 15px;">
        <label for="productShape">Форма виробу:</label><br/>
        <select id="productShape" style="width: 60%;">
          <option value="">-- Виберіть --</option>
          <option value="Пряма">Пряма</option>
          <option value="Кутова">Кутова</option>
          <option value="П-подібна">П-подібна</option>
          <option value="G-по периметру">G-по периметру</option>
        </select>
      </div>
    </div>
       

    
    <div style="flex: 1;">
      <label for="measure">Заміри:</label><br/>
      <select id="measure" style="width: 40%;">
        <option value="">-- Виберіть --</option>
        <option value="Без замірів">Без замірів</option>
        <option value="По замірам 3D">По замірам 3D</option>
        <option value="По замірам фото-ескіз">По замірам фото-ескіз</option>
      </select>
    </div>
    
    <div style="margin-left: 30px;">
      <label for="geom">Нестандартна геометрія приміщення:<span class="tooltip-container"><span class="tooltip-icon">?</span><div class="tooltip-content">Наявність колон, вент-шахт, виступів, балок тощо</div></span></label><br/>
      <select id="geom">
        <option value="">-- Виберіть --</option>
        <option value="Так">Так</option>
        <option value="Ні">Ні</option>
      </select>
    </div>
  </div>
  <div class="section">
  <h3>2. Тип конструкції</h3>
  <div style="display: flex; gap: 20px; align-items: flex-start; margin-bottom: 20px;">
    <div style="flex: 1;">
      <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
        <label>Тип конструкції:</label>
        <button type="button" id="addConstructionTypeBtn" onclick="showAddConstructionTypeModal()" style="background: #2563eb; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 13px;">
          + Додати тип
        </button>
      </div>
      <div id="constructionTypesList"></div>
    </div>
    
    <div style="flex: 1;">
      <label for="installationType">Тип монтажу:</label><br/>
      <select id="installationType" style="width: 100%;">
        <option value="">-- Виберіть --</option>
        <option value="mechanical">Механічний монтаж</option>
        <option value="adhesive">Клейовий монтаж</option>
      </select>
    </div>
  </div>
  </div>
  <div class="section">
  <h3>3. Матеріали</h3>
  <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
    <label for="hasFacadeMaterials">Матеріали панелей:</label>
    <select id="hasFacadeMaterials" onchange="toggleFacadeMaterialsFields()">
      <option value="">-- Виберіть --</option>
      <option value="yes">Так</option>
      <option value="no">Ні</option>
    </select>
    <button type="button" id="addFacadeMaterialBtn" onclick="showAddFacadeMaterialModal()" class="hidden" style="background: #2563eb; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
      + Додати матеріал
    </button>
  </div>
  <div class="hidden" id="facadeMaterialsFields">
  <div id="facadeMaterialsList"></div>
  </div>
  </div>
  <div class="section">
    <h3>4. Додаткові елементи - конструкції</h3>
    <label for="furnRevisionDoors">Ревізійні дверки/лючки:</label>
    <input id="furnRevisionDoors" min="0" onfocus="this.select()" placeholder="Вкажіть кількість або 0" type="number"/><br/><br/>
    <label for="furnSwingDoor">Наявність розпашної двері як частина стінпанелей:</label>
    <input id="furnSwingDoor" min="0" onfocus="this.select()" placeholder="Вкажіть кількість або 0" type="number"/><br/><br/>
    <label for="furnDoorBlockConnection">Стиковка панелей з дверним блоком прихованого монтажу:</label>
    <input id="furnDoorBlockConnection" min="0" onfocus="this.select()" placeholder="Вкажіть кількість або 0" type="number"/><br/><br/>
    <label for="furnDoorOpening">Обшивка проему дверного:</label>
    <input id="furnDoorOpening" min="0" onfocus="this.select()" placeholder="Вкажіть кількість або 0" type="number"/><br/><br/>
    <label for="furnWindowOpening">Обшивка проему віконного:</label>
    <input id="furnWindowOpening" min="0" onfocus="this.select()" placeholder="Вкажіть кількість або 0" type="number"/><br/><br/>
    <label for="furnDoorOverlay">Елемент дверної накладки:</label>
    <input id="furnDoorOverlay" min="0" onfocus="this.select()" placeholder="Вкажіть кількість або 0" type="number"/><br/><br/>
    <label for="furnOverlayElements">Накладні елеменити (молдинги, декри - тощо):</label>
    <input id="furnOverlayElements" min="0" onfocus="this.select()" placeholder="Вкажіть кількість або 0" type="number"/><br/><br/>
    <label for="furnExpansionStrips">Розшивки/стиковочні планки-профілі:</label>
    <input id="furnExpansionStrips" min="0" onfocus="this.select()" placeholder="Вкажіть кількість або 0" type="number"/><br/><br/>
    <label for="furnMirrorCutouts">Вирізи в дзеркальних панелях:</label>
    <input id="furnMirrorCutouts" min="0" onfocus="this.select()" placeholder="Вкажіть кількість або 0" type="number"/>
    </div>
  <div class="section">
  <h3>5. Інтегровані елементи
    <span class="tooltip-container" style="margin-left: 8px;">
      <span class="tooltip-icon">?</span>
      <div class="tooltip-content">Люк технічний, Техніка</div>
    </span>
  </h3>
  <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
    <label for="hasIntegratedElements">Інтегровані елементи:</label>
    <select id="hasIntegratedElements" onchange="toggleIntegratedElementsFields()">
      <option value="">-- Виберіть --</option>
      <option value="yes">Так</option>
      <option value="no">Ні</option>
    </select>
    <button type="button" id="addIntegratedElementBtn" onclick="showAddIntegratedElementModal()" class="hidden" style="background: #2563eb; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
      + Додати елемент
    </button>
  </div>
  <div class="hidden" id="integratedElementsFields">
  <div id="integratedElementsList"></div>
  </div>
  </div>
  <div class="section">
  <h3>6. Підсвітка</h3>
  <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
    <label for="hasLighting">Підсвітка:</label>
    <select id="hasLighting" onchange="toggleLightingFields()">
      <option value="">-- Виберіть --</option>
      <option value="yes">Так</option>
      <option value="no">Ні</option>
    </select>
    <button type="button" id="addLightingBtn" onclick="showAddLightingModal()" class="hidden" style="background: #2563eb; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
      + Додати підсвітку
    </button>
  </div>
  <div class="hidden" id="lightingFields">
  <div id="lightingList"></div>
  </div>
  </div>
  <div style="display: flex; align-items: center; gap: 15px;">
    <button class="no-print" onclick="calculate()">Розрахувати</button>
    <div class="points-hud" id="pointsHUD" style="display: none;">Поінти: 0</div>
  </div>
  </div>
  </div>

<!-- Модальне вікно для введення пароля -->
<div id="passwordModal" class="modal" style="display: none;">
  <div class="modal-content" style="max-width: 400px;">
    <div class="modal-header">
      <h3>Введіть пароль</h3>
      <button class="close" onclick="closePasswordModal()">&times;</button>
    </div>
    <div>
      <label for="passwordInput">Пароль:</label><br/>
      <input type="password" id="passwordInput" onkeypress="handlePasswordKeypress(event)" style="width: 100%; margin-bottom: 15px; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" placeholder="Введіть пароль для доступу до налаштувань">
    </div>
    <div class="modal-actions">
      <button onclick="closePasswordModal()" style="background: #6b7280;">Скасувати</button>
      <button onclick="checkPassword()" style="background: #2563eb;">Відкрити налаштування</button>
    </div>
  </div>
</div>

<!-- Модальне вікно для додавання виробу -->
<div id="productModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Додати виріб</h3>
      <button class="close" onclick="closeProductModal()">&times;</button>
    </div>
    <div>
      <label for="productType">Тип виробу:</label><br/>
      <select id="productType" onchange="toggleProductTypeFields()" style="width: 100%; margin-bottom: 15px;">
        <option value="">-- Виберіть тип --</option>
        <option value="Стінові панелі">Стінові панелі</option>
        <option value="Стельові панелі">Стельові панелі</option>
        <option value="Колони">Колони</option>
        <option value="Панелі до стелі">Панелі до стелі</option>
        <option value="Перегородки рейкові">Перегородки рейкові</option>
      </select>
     <div id="productConstructionFields" style="display: none;">
      <label for="productConstructionType">Тип конструкції:</label><br/>
      <select id="productConstructionType" style="width: 100%; margin-bottom: 15px;">
        <option value="">-- Виберіть тип конструкції --</option>
        <option value="floor_wall">Конструкція підлога-стіна</option>
        <option value="floor_ceiling">Конструкція підлога-стеля</option>
      </select>
    </div>
      <label for="productQuantity">Кількість:</label><br/>
      <input type="number" id="productQuantity" min="1" value="1" style="width: 100%; margin-bottom: 15px;">
    </div>
    <div class="modal-actions">
      <button onclick="closeProductModal()" style="background: #6b7280;">Скасувати</button>
      <button onclick="addProduct()" style="background: #2563eb;">Додати</button>
    </div>
  </div>
</div>

<!-- Модальне вікно для додавання типу конструкції -->
<div id="addConstructionTypeModal" class="modal" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Додати тип конструкції</h3>
      <button class="close" onclick="closeAddConstructionTypeModal()">&times;</button>
    </div>
    <div>
      <label for="newConstructionType">Тип конструкції:</label><br/>
      <select id="newConstructionType" onchange="toggleIndividualCharacteristics()" style="width: 100%; margin-bottom: 15px;">
        <option value="">-- Виберіть тип --</option>
        <option value="solid">Суцільні</option>
        <option value="framed">Каркасні</option>
        <option value="profiled">Профільні панелі (AGT)</option>
        <option value="slatted">Рейкові</option>
        <option value="modular">Модульні</option>
        <option value="individual">Панель індивідуальна R&D</option>
      </select>
      
      <div id="individualCharacteristics" style="display: none; margin-bottom: 15px; padding: 15px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px;">
        <h4 style="margin: 0 0 15px 0; color: #374151; font-size: 14px;">Тип R&D панелі:</h4>
        
        <div style="display: flex; flex-direction: column; gap: 8px;">
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px 12px; background: #f3f4f6; border-radius: 6px; border: 1px solid #d1d5db;">
            <input type="radio" name="rdType" value="simple" id="rdSimple" style="margin: 0;">
            <span>Просте</span>
          </label>
          
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px 12px; background: #f3f4f6; border-radius: 6px; border: 1px solid #d1d5db;">
            <input type="radio" name="rdType" value="complex" id="rdComplex" style="margin: 0;">
            <span>Складне</span>
          </label>
          
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px 12px; background: #f3f4f6; border-radius: 6px; border: 1px solid #d1d5db;">
            <input type="radio" name="rdType" value="development" id="rdDevelopment" style="margin: 0;">
            <span>Розробка нового</span>
          </label>
        </div>
      </div>
      
      <label for="constructionTypeQuantity">Кількість:</label><br/>
      <input type="number" id="constructionTypeQuantity" min="1" value="1" style="width: 100%; margin-bottom: 15px;">
    </div>
    <div class="modal-actions">
      <button onclick="closeAddConstructionTypeModal()" style="background: #6b7280;">Скасувати</button>
      <button onclick="addConstructionType()" style="background: #2563eb;">Додати</button>
    </div>
  </div>
</div>

<!-- Модальне вікно для додавання матеріалу панелі -->
<div id="addFacadeMaterialModal" class="modal" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Додати матеріал панелі</h3>
      <span class="close" onclick="closeAddFacadeMaterialModal()">&times;</span>
    </div>
    <div>
      <label for="newFacadeMaterial">Матеріал панелі:</label><br/>
      <select id="newFacadeMaterial" onchange="toggleTextureFields()" style="width: 100%; margin-bottom: 15px;">
        <option value="">-- Виберіть матеріал --</option>
        <option value="dsp">ДСП</option>
        <option value="mdf_boards">МДФ плити</option>
        <option value="paint_straight">Фарба/плівка "прямі"</option>
        <option value="paint_milled">Фарба/плівка "фрезеровані"</option>
        <option value="veneered_straight">Шпоновані "прямі"</option>
        <option value="veneered_milled">Шпоновані "фрезеровані"</option>
        <option value="aluminum_frame">Алюм. рамкові</option>
        <option value="arpa_fenix">ARPA/Fenix</option>
        <option value="hpl">HPL</option>
        <option value="rd_individual">R&D фасади індивід.</option>
        <option value="mdf_individual">МДФ фасади з індивідуальним фрезеруванням</option>
        <option value="mirror">Дзеркало</option>
        <option value="glass">Скло</option>
        <option value="quartzite">Кварцит-керамограніт-мрамор</option>
      </select>
      
      <div id="textureFields" style="display: none; margin-bottom: 15px; padding: 15px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px;">
        <h4 style="margin: 0 0 15px 0; color: #374151; font-size: 14px;">Додаткові параметри:</h4>
        
        <div style="margin-bottom: 15px;">
          <label for="textureType">Текстура:</label><br/>
          <select id="textureType" style="width: 100%;">
            <option value="none">Ні</option>
            <option value="texture_selection">Підбір текстури</option>
            <option value="milling_transition">Перехід фрезерування</option>
          </select>
        </div>
      </div>
      
      <label for="facadeMaterialQuantity">Площа (м²):</label><br/>
      <input type="number" id="facadeMaterialQuantity" min="0.1" step="0.1" value="1.0" style="width: 100%; margin-bottom: 15px;">
    </div>
    <div class="modal-actions">
      <button onclick="closeAddFacadeMaterialModal()" style="background: #6b7280;">Скасувати</button>
      <button onclick="addFacadeMaterial()" style="background: #2563eb;">Додати</button>
    </div>
  </div>
</div>

<!-- Модальне вікно для додавання додаткового елемента -->
<div id="addAdditionalElementModal" class="modal" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Додати елемент</h3>
      <span class="close" onclick="closeAddAdditionalElementModal()">&times;</span>
    </div>
    <div>
      <label for="newAdditionalElementType">Тип елемента:</label><br/>
      <select id="newAdditionalElementType" style="width: 100%; margin-bottom: 15px;">
        <option value="">-- Виберіть тип --</option>
        <option value="metal_frame">Металоконструкція рамкова</option>
        <option value="metal_volume">Металоконструкція об'ємна</option>
        <option value="rd_detail">Деталь R&D, гнутий елемент тощо</option>
      </select>
      
      <label for="newAdditionalElementQuantity">Кількість:</label><br/>
      <input type="number" id="newAdditionalElementQuantity" min="1" value="1" style="width: 100%; margin-bottom: 15px;">
    </div>
    <div class="modal-actions">
      <button onclick="closeAddAdditionalElementModal()" style="background: #6b7280;">Скасувати</button>
      <button onclick="addAdditionalElement()" style="background: #2563eb;">Додати</button>
    </div>
  </div>
</div>

<!-- Модальне вікно для додавання ручки -->
<div id="addHandleModal" class="modal" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Додати ручку</h3>
      <span class="close" onclick="closeAddHandleModal()">&times;</span>
    </div>
    <label for="newHandleType">Тип ручки:</label>
    <select id="newHandleType" onchange="selectedHandleType = this.value;" style="width: 100%; margin-bottom: 15px;">
      <option value="">-- Виберіть --</option>
      <option value="handles_gola">GOLA</option>
      <option value="handles_end">Торцеві</option>
      <option value="handles_milled">Фрезеровані</option>
      <option value="handles_other">Інші</option>
    </select>
    
    <div class="modal-actions">
      <button onclick="closeAddHandleModal()" style="background: #6b7280;">Скасувати</button>
      <button onclick="addHandle()" style="background: #2563eb;">Додати</button>
    </div>
  </div>
</div>

<!-- Модальне вікно для додавання інтегрованого елемента -->
<div id="addIntegratedElementModal" class="modal" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Додати інтегрований елемент</h3>
      <span class="close" onclick="closeAddIntegratedElementModal()">&times;</span>
    </div>
    <label for="newIntegratedElementType">Тип елемента:</label>
    <select id="newIntegratedElementType" style="width: 100%; margin-bottom: 15px;">
      <option value="">-- Виберіть --</option>
      <option value="technical_hatch">Люк технічний (ревізійний, електро - тощо)</option>
      <option value="appliances">Техніка (пралка, сушка, сейф, винина шафа тощо)</option>
    </select>
    
    <label for="newIntegratedElementQuantity">Кількість:</label>
    <input type="number" id="newIntegratedElementQuantity" min="1" value="1" style="width: 100%; margin-bottom: 15px;">
    
    <div class="modal-actions">
      <button onclick="closeAddIntegratedElementModal()" style="background: #6b7280;">Скасувати</button>
      <button onclick="addIntegratedElement()" style="background: #2563eb;">Додати</button>
    </div>
  </div>
</div>

<!-- Модальне вікно для додавання підсвітки -->
<div id="addLightingModal" class="modal" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Додати підсвітку</h3>
      <span class="close" onclick="closeAddLightingModal()">&times;</span>
    </div>
    <label for="newLightingType">Тип підсвітки:</label>
    <select id="newLightingType" style="width: 100%; margin-bottom: 15px;">
      <option value="">-- Виберіть --</option>
      <option value="light_elements">Елементів (деталей) з підсвіткою</option>
      <option value="light_control">Пристроїв керування і вимірюються в кількостях</option>
    </select>
    
    <label for="newLightingQuantity">Кількість:</label>
    <input type="number" id="newLightingQuantity" min="1" value="1" style="width: 100%; margin-bottom: 15px;">
    
    <div class="modal-actions">
      <button onclick="closeAddLightingModal()" style="background: #6b7280;">Скасувати</button>
      <button onclick="addLighting()" style="background: #2563eb;">Додати</button>
    </div>
  </div>
</div>

<!-- Модальне вікно попередження -->
<div class="modal" id="warningModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5);">
  <div class="modal-content">
    <h3>⚠ Помилка</h3>
    <p id="warningText"></p>
    <button onclick="closeModal()">OK</button>
  </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
(function() {
  const dateField = document.getElementById("dateField");
  if (dateField) {
    const today = new Date();
    const day = String(today.getDate()).padStart(2, '0');
    const month = String(today.getMonth() + 1).padStart(2, '0');
    const year = today.getFullYear();
    dateField.value = `${day}-${month}-${year}`;
  }
})();
</script>
<script>
        </script>
<script>
// ===== СТАТИЧНІ ЗНАЧЕННЯ ПОІНТІВ =====
// Всі значення поінтів для розрахунків - легко змінювати тут
const POINT_VALUES = {
  // 1. Основні параметри виробу - стінові панелі
  "p_product_стінові_панелі": 1,        // Стінові панелі
  "p_product_стельові_панелі": 2,       // Стельові панелі
  "p_product_колони": 3,                // Колони
  "p_product_панелі_до_стелі": 2,       // Панелі до стелі
  "p_product_перегородки_рейкові": 4,   // Перегородки рейкові
  
  // Форма виробу
  "p_shape_straight": 1,    // Пряма
  "p_shape_corner": 3,      // Кутова
  "p_shape_u": 5,           // П-подібна
  "p_shape_g": 8,           // G-по периметру
  
  // Заміри
  "p_measure_no": 1,       // Без замірів
  "p_measure_3d": 8,       // По замірам 3D
  "p_measure_photo": 12,   // По замірам фото-ескіз
  
  // Додаткові параметри
  "p_geometry": 8,         // Нестандартна геометрія приміщення
  
  // 2. Тип конструкції
  "p_construction_solid": 1,           // Суцільні
  "p_construction_framed": 2,          // Каркасні
  "p_construction_profiled": 3,        // Профільні панелі (AGT)
  "p_construction_slatted": 2,         // Рейкові
  "p_construction_modular": 4,         // Модульні
  "p_construction_individual_simple": 8,    // Панель індивідуальна R&D - Просте
  "p_construction_individual_complex": 12,  // Панель індивідуальна R&D - Складне
  "p_construction_individual_development": 20, // Панель індивідуальна R&D - Розробка нового
  
  // Тип монтажу
  "p_installation_mechanical": 1,      // Механічний монтаж
  "p_installation_adhesive": 2,        // Клейовий монтаж
  
  // 3. Матеріали панелей
  "p_material_dsp": 3,               // ДСП
  "p_material_mdf_boards": 6,        // МДФ плити
  "p_material_paint_straight": 10,   // Фарба/плівка "прямі"
  "p_material_paint_milled": 14,     // Фарба/плівка "фрезеровані"
  "p_material_veneered_straight": 12, // Шпоновані "прямі"
  "p_material_veneered_milled": 16,   // Шпоновані "фрезеровані"
  "p_material_aluminum_frame": 8,     // Алюм. рамкові
  "p_material_arpa_fenix": 8,         // ARPA/Fenix
  "p_material_hpl": 14,               // HPL
  "p_material_rd_individual": 30,     // R&D фасади індивід.
  "p_material_mdf_individual": 17,    // МДФ фасади з індивідуальним фрезеруванням
  "p_material_mirror": 15,            // Дзеркало
  "p_material_glass": 12,             // Скло
  "p_material_quartzite": 25,         // Кварцит-керамограніт-мрамор
  
  // Додаткові параметри матеріалів
  "p_texture_none": 0,                // Ні
  "p_texture_selection": 3,           // Підбір текстури
  "p_texture_milling": 5,             // Перехід фрезерування
  
  // 4. Додаткові елементи - конструкції
  "p_furn_revision_doors": 2,         // Ревізійні дверки/лючки
  "p_furn_swing_door": 4,             // Наявність розпашної двері як частина стінпанелей
  "p_furn_door_block_connection": 3,  // Стиковка панелей з дверним блоком прихованого монтажу
  "p_furn_door_opening": 2,           // Обшивка проему дверного
  "p_furn_window_opening": 2,         // Обшивка проему віконного
  "p_furn_door_overlay": 1,           // Елемент дверної накладки
  "p_furn_overlay_elements": 3,       // Накладні елементи (молдинги, декри - тощо)
  "p_furn_expansion_strips": 2,       // Розшивки/стиковочні планки-профілі
  "p_furn_mirror_cutouts": 4,         // Вирізи в дзеркальних панелях
  
  // 5. Інтегровані елементи
  "p_integrated_technical_hatch": 6,  // Люк технічний (ревізійний, електро - тощо)
  "p_integrated_appliances": 8,       // Техніка (пралка, сушка, сейф, винина шафа тощо)
  
  // 6. Підсвітка
  "p_lighting_light_elements": 2,     // Елементів (деталей) з підсвіткою
  "p_lighting_light_control": 3,      // Пристроїв керування і вимірюються в кількостях
};

// Масив для зберігання доданих виробів
let addedProducts = [];

// Функція для відкриття модального вікна додавання виробу
function showAddProductModal() {
  document.getElementById('productModal').style.display = 'flex';
  document.getElementById('productType').value = '';
  document.getElementById('productQuantity').value = '1';
}

// Функція для закриття модального вікна
function closeProductModal() {
  document.getElementById('productModal').style.display = 'none';
}
// Функція для переключення полів типу конструкції
function toggleProductTypeFields() {
  const productType = document.getElementById('productType').value;
  const constructionFields = document.getElementById('productConstructionFields');
  
  if (productType === 'Стелажна с-ма ( к-сть вертикальних секцій/модулів)' || 
      productType === 'Пристінна с-ма  ( к-сть вертикальних секцій/модулів)') {
    constructionFields.style.display = 'block';
  } else {
    constructionFields.style.display = 'none';
  }
}

// Функція для додавання виробу
function addProduct() {
  const type = document.getElementById('productType').value;
  const quantity = parseInt(document.getElementById('productQuantity').value);
  const constructionType = document.getElementById('productConstructionType').value;
  
  if (!type || quantity < 1) {
    alert('Будь ласка, виберіть тип виробу та вкажіть коректну кількість');
    return;
  }
  
  // Перевіряємо, чи потрібно вибрати тип конструкції
  if ((type === 'Стелажна с-ма ( к-сть вертикальних секцій/модулів)' || 
       type === 'Пристінна с-ма  ( к-сть вертикальних секцій/модулів)') && !constructionType) {
    alert('Будь ласка, виберіть тип конструкції');
    return;
  }
  
  // Створюємо назву з урахуванням типу конструкції
  let displayType = type;
  if (constructionType) {
    const constructionNames = {
      'floor_wall': 'Конструкція підлога-стіна',
      'floor_ceiling': 'Конструкція підлога-стеля'
    };
    displayType = `${type} (${constructionNames[constructionType]})`;
  }
  
  // Перевіряємо, чи вже існує такий тип виробу
  const existingProduct = addedProducts.find(p => p.type === displayType);
  
  if (existingProduct) {
    existingProduct.quantity += quantity;
  } else {
    addedProducts.push({
      type: displayType,
      quantity: quantity,
      id: Date.now()
    });
  }
  
  renderProductsList();
  closeProductModal();
}

// Функція для відображення списку виробів
function renderProductsList() {
  const productsList = document.getElementById('productsList');
  
  if (addedProducts.length === 0) {
    productsList.innerHTML = '<div style="color: #6b7280; font-style: italic;">Виробів не додано</div>';
    return;
  }
  
  // Функція для скорочення довгих назв
  function getShortName(type) {
    const shortNames = {
      'Стелажна с-ма ( к-сть вертикальних секцій/модулів)': 'Стелажна с-ма',
      'Пристінна с-ма  ( к-сть вертикальних секцій/модулів)': 'Пристінна с-ма'
    };
    
    return shortNames[type] || type;
  }
  
  let html = '';
  addedProducts.forEach((product, index) => {
    const shortName = getShortName(product.type);
    html += `
      <div style="display: flex; align-items: center; padding: 4px 0; margin-bottom: 3px;">
        <span style="font-size: 14px; margin-right: 8px;" title="${product.type}">${index + 1}. ${shortName}</span>
        <input type="number" 
               id="quantity_${product.id}" 
               value="${product.quantity}" 
               min="1" 
               style="width: 60px; padding: 2px 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 12px; margin-right: 4px;"
               onchange="updateProductQuantity(${product.id}, this.value)"
               onblur="updateProductQuantity(${product.id}, this.value)">
        <span style="font-size: 12px; color: #666; margin-right: 8px;">шт.</span>
        <button onclick="removeProduct(${product.id})" class="remove-btn" title="Видалити" style="background: #ef4444; color: white; border: none; padding: 2px 6px; border-radius: 3px; cursor: pointer; font-size: 12px;">×</button>
      </div>
    `;
  });
  
  productsList.innerHTML = html;
}

// Функція для оновлення кількості виробу
function updateProductQuantity(id, newQuantity) {
  const quantity = parseInt(newQuantity);
  
  if (quantity < 1) {
    alert('Кількість повинна бути не менше 1');
    // Повертаємо попереднє значення
    const product = addedProducts.find(p => p.id === id);
    if (product) {
      document.getElementById(`quantity_${id}`).value = product.quantity;
    }
    return;
  }
  
  const product = addedProducts.find(p => p.id === id);
  if (product) {
    product.quantity = quantity;
    // Не перерендерюємо весь список, щоб не втратити фокус
    console.log(`Оновлено кількість для ${product.type}: ${quantity}`);
  }
}

// Функція для видалення виробу
function removeProduct(id) {
  addedProducts = addedProducts.filter(p => p.id !== id);
  renderProductsList();
}

// Ініціалізація списку виробів при завантаженні сторінки
document.addEventListener('DOMContentLoaded', function() {
  renderProductsList();
});

// Закриття модального вікна при кліку на фон
document.addEventListener('click', function(event) {
  const modal = document.getElementById('productModal');
  if (event.target === modal) {
    closeProductModal();
  }
});

// ===== ФУНКЦІЇ ДЛЯ ФАСАДНИХ МАТЕРІАЛІВ =====

// Функція для переключення полів фасадних матеріалів
function toggleFacadeMaterialsFields() {
  const hasFacadeMaterials = document.getElementById("hasFacadeMaterials").value;
  const fields = document.getElementById("facadeMaterialsFields");
  const addButton = document.getElementById("addFacadeMaterialBtn");
  
  if (hasFacadeMaterials === "yes") {
    fields.classList.remove("hidden");
    addButton.classList.remove("hidden");
  } else {
    fields.classList.add("hidden");
    addButton.classList.add("hidden");
    // Очищаємо список матеріалів
    document.getElementById("facadeMaterialsList").innerHTML = "";
  }
}

// Функція для відкриття модального вікна додавання фасадного матеріалу
function showAddFacadeMaterialModal() {
  document.getElementById('addFacadeMaterialModal').style.display = 'flex';
}

// Функція для закриття модального вікна фасадних матеріалів
function closeAddFacadeMaterialModal() {
  document.getElementById('addFacadeMaterialModal').style.display = 'none';
  // Скидаємо поля
  document.getElementById('newFacadeMaterialType').value = '';
}

// Функція для додавання фасадного матеріалу при виборі
function addFacadeMaterialOnSelect() {
  const select = document.getElementById("newFacadeMaterialType");
  const materialType = select.value;
  
  if (!materialType) return;

  // Отримуємо назву з option тексту
  const selectedOption = select.options[select.selectedIndex];
  const displayName = selectedOption.text;
  
  const materialsList = document.getElementById("facadeMaterialsList");
  
  // Перевіряємо, чи вже існує такий матеріал
  const existingMaterial = document.getElementById(`facadeMaterial_${materialType}`);
  if (existingMaterial) {
    alert('Цей матеріал вже додано!');
    closeAddFacadeMaterialModal();
    return;
  }
  
  // Створюємо новий елемент
  const materialDiv = document.createElement("div");
  materialDiv.id = `facadeMaterial_${materialType}`;
  materialDiv.setAttribute('data-material-type', materialType);
  materialDiv.style.cssText = "padding: 4px 0; margin-bottom: 3px;";
  
  materialDiv.innerHTML = `
    <span style="font-size: 14px;">
      <span class="material-number"></span>. ${displayName} 
      <button onclick="removeFacadeMaterial('facadeMaterial_${materialType}')" class="remove-btn" title="Видалити" style="margin-left: 8px;">×</button>
    </span>
  `;
  
  materialsList.appendChild(materialDiv);
  
  // Оновлюємо нумерацію
  updateFacadeMaterialNumbers();
  
  // Закриваємо модальне вікно
  closeAddFacadeMaterialModal();
}

// Функція для оновлення нумерації фасадних матеріалів
function updateFacadeMaterialNumbers() {
  const materialsList = document.getElementById("facadeMaterialsList");
  const materials = materialsList.querySelectorAll('[id^="facadeMaterial_"]');
  
  materials.forEach((material, index) => {
    const numberSpan = material.querySelector('.material-number');
    if (numberSpan) {
      numberSpan.textContent = index + 1;
    }
  });
}

// Функція для видалення фасадного матеріалу
function removeFacadeMaterial(elementId) {
  const element = document.getElementById(elementId);
  if (element) {
    element.remove();
    // Перенумеровуємо матеріали після видалення
    updateFacadeMaterialNumbers();
  }
}

// Функції для роботи з додатковими елементами
function toggleAdditionalElementsFields() {
  const hasAdditionalElements = document.getElementById("hasAdditionalElements").value;
  const addAdditionalElementBtn = document.getElementById("addAdditionalElementBtn");
  const additionalElementsList = document.getElementById("additionalElementsList");
  
  if (hasAdditionalElements === "yes") {
    addAdditionalElementBtn.style.display = "inline-block";
    additionalElementsList.style.display = "block";
  } else {
    addAdditionalElementBtn.style.display = "none";
    additionalElementsList.style.display = "none";
    // Очищаємо список елементів
    additionalElementsList.innerHTML = "";
  }
  
}

// Функція для відкриття модального вікна додавання додаткового елемента
function showAddAdditionalElementModal() {
  document.getElementById('addAdditionalElementModal').style.display = 'flex';
  // Скидаємо поля
  document.getElementById('newAdditionalElementType').value = '';
  document.getElementById('newAdditionalElementQuantity').value = '1';
}

// Функція для закриття модального вікна додаткових елементів
function closeAddAdditionalElementModal() {
  document.getElementById('addAdditionalElementModal').style.display = 'none';
}

// Функція для додавання додаткового елемента
function addAdditionalElement() {
  const type = document.getElementById("newAdditionalElementType").value;
  const quantity = parseInt(document.getElementById("newAdditionalElementQuantity").value) || 1;
  
  if (!type) {
    alert('Будь ласка, виберіть тип елемента');
    return;
  }

  const typeNames = {
    "metal_frame": "Металоконструкція рамкова",
    "metal_volume": "Металоконструкція об'ємна",
    "rd_detail": "Деталь R&D, гнутий елемент тощо",
    "false_horizontal": "Фальш панелі горизонтальні",
    "false_vertical": "Фальш панелі вертикальні"
  };

  const typeName = typeNames[type] || type;
  
  const additionalElementsList = document.getElementById("additionalElementsList");
  const elementId = `additionalElement_${Date.now()}`;
  
  // Створюємо новий елемент
  const elementDiv = document.createElement("div");
  elementDiv.id = elementId;
  elementDiv.style.cssText = "padding: 4px 0; margin-bottom: 3px;";
  elementDiv.setAttribute('data-element-type', type);
  elementDiv.setAttribute('data-quantity', quantity);
  
  elementDiv.innerHTML = `
    <div style="display: flex; align-items: center; gap: 10px; font-size: 14px;">
      <span class="additional-element-number"></span>. ${typeName}
      <input type="number" id="quantity_${elementId}" value="${quantity}" min="1" onchange="updateAdditionalElementQuantity('${elementId}')" style="width: 100px; padding: 5px; border: 1px solid #ccc; border-radius: 4px;">
      <button onclick="removeAdditionalElement('${elementId}')" class="remove-btn" title="Видалити" style="background: #ef4444; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer;">×</button>
    </div>
  `;
  
  additionalElementsList.appendChild(elementDiv);
  
  // Оновлюємо нумерацію
  updateAdditionalElementNumbers();
  
  // Закриваємо модальне вікно
  closeAddAdditionalElementModal();
  
}

// Функція для оновлення нумерації додаткових елементів
function updateAdditionalElementNumbers() {
  const additionalElementsList = document.getElementById("additionalElementsList");
  const elements = additionalElementsList.querySelectorAll('[id^="additionalElement_"]');
  
  elements.forEach((element, index) => {
    const numberSpan = element.querySelector('.additional-element-number');
    if (numberSpan) {
      numberSpan.textContent = index + 1;
    }
  });
}

// Функція для видалення додаткового елемента
function removeAdditionalElement(elementId) {
  const element = document.getElementById(elementId);
  if (element) {
    element.remove();
    // Перенумеровуємо елементи після видалення
    updateAdditionalElementNumbers();
    
    // Автоматично зберігаємо налаштування
    saveSettings();
  }
}

// Функція для оновлення кількості додаткового елемента
function updateAdditionalElementQuantity(elementId) {
  const element = document.getElementById(elementId);
  if (!element) return;
  
  const input = element.querySelector('input[type="number"]');
  const newQuantity = parseInt(input.value) || 1;
  
  if (newQuantity < 1) {
    input.value = 1;
    element.setAttribute('data-quantity', 1);
  } else {
    element.setAttribute('data-quantity', newQuantity);
  }
}

// Глобальна змінна для збереження вибраного типу ручки
let selectedHandleType = '';

// Функції для роботи з ручками
function toggleHandlesFields() {
  const hasHandles = document.getElementById("hasHandles").value;
  const addHandleBtn = document.getElementById("addHandleBtn");
  const handlesFields = document.getElementById("handlesFields");
  
  if (hasHandles === "yes") {
    addHandleBtn.classList.remove("hidden");
    handlesFields.classList.remove("hidden");
  } else {
    addHandleBtn.classList.add("hidden");
    handlesFields.classList.add("hidden");
    // Очищаємо список ручок
    document.getElementById("handlesList").innerHTML = "";
  }
  
}

function showAddHandleModal() {
  document.getElementById('addHandleModal').style.display = 'flex';
  // Встановлюємо збережений тип ручки, якщо є
  if (selectedHandleType) {
    document.getElementById('newHandleType').value = selectedHandleType;
  }
  // Не очищаємо поле - залишаємо попереднє значення
}

function closeAddHandleModal() {
  // Зберігаємо вибраний тип ручки перед закриттям
  const newHandleType = document.getElementById('newHandleType');
  console.log('closeAddHandleModal - newHandleType element:', newHandleType);
  console.log('closeAddHandleModal - newHandleType value:', newHandleType ? newHandleType.value : 'не знайдено');
  
  if (newHandleType && newHandleType.value) {
    selectedHandleType = newHandleType.value;
    console.log('closeAddHandleModal - збережено selectedHandleType:', selectedHandleType);
  } else {
    console.log('closeAddHandleModal - newHandleType порожній або не знайдено');
  }
  document.getElementById('addHandleModal').style.display = 'none';
}

function addHandle() {
  const handleType = document.getElementById("newHandleType").value;
  
  if (!handleType) {
    alert('Будь ласка, виберіть тип ручки');
    return;
  }

  const handleNames = {
    "handles_gola_low": "GOLA низ",
    "handles_gola_up": "GOLA верх",
    "handles_gola_vert": "GOLA вертикал.",
    "handles_end": "Торцеві",
    "handles_milled": "Фрезеровані",
    "handles_other": "Інші"
  };

  const displayName = handleNames[handleType] || handleType;
  const handlesList = document.getElementById("handlesList");
  
  // Перевіряємо, чи вже існує такий тип ручки
  const existingHandle = document.getElementById(`handle_${handleType}`);
  if (existingHandle) {
    // Якщо існує, не додаємо дублікат
    return;
  } else {
    // Якщо не існує, створюємо новий
    const handleDiv = document.createElement("div");
    handleDiv.id = `handle_${handleType}`;
    handleDiv.style.cssText = "padding: 4px 0; margin-bottom: 3px;";
    handleDiv.setAttribute('data-type', handleType);
    
    handleDiv.innerHTML = `
      <div style="display: flex; align-items: center; gap: 10px; font-size: 14px;">
        <span class="handle-number"></span>. ${displayName}
        <button onclick="removeHandle('handle_${handleType}')" class="remove-btn" title="Видалити" style="background: #ef4444; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer;">×</button>
      </div>
    `;
    
    handlesList.appendChild(handleDiv);
  }
  
  // Оновлюємо нумерацію
  updateHandleNumbers();
  
  // Очищаємо поле типу ручки
  document.getElementById('newHandleType').value = '';
  
  // Закриваємо модальне вікно
  closeAddHandleModal();
  
}

function updateHandleNumbers() {
  const handlesList = document.getElementById("handlesList");
  const handles = handlesList.querySelectorAll('[id^="handle_"]');
  
  handles.forEach((handle, index) => {
    const numberSpan = handle.querySelector('.handle-number');
    if (numberSpan) {
      numberSpan.textContent = index + 1;
    }
  });
}

function removeHandle(elementId) {
  const element = document.getElementById(elementId);
  if (element) {
    element.remove();
    // Перенумеровуємо ручки після видалення
    updateHandleNumbers();
    
    // Автоматично зберігаємо налаштування
    saveSettings();
  }
}

// Функції для інтегрованих елементів
function toggleIntegratedElementsFields() {
  const hasIntegratedElements = document.getElementById('hasIntegratedElements').value;
  const integratedElementsFields = document.getElementById('integratedElementsFields');
  const addIntegratedElementBtn = document.getElementById('addIntegratedElementBtn');
  
  if (hasIntegratedElements === 'yes') {
    integratedElementsFields.classList.remove('hidden');
    addIntegratedElementBtn.classList.remove('hidden');
  } else {
    integratedElementsFields.classList.add('hidden');
    addIntegratedElementBtn.classList.add('hidden');
    // Очищаємо список елементів
    document.getElementById('integratedElementsList').innerHTML = '';
  }
}

function showAddIntegratedElementModal() {
  document.getElementById('addIntegratedElementModal').style.display = 'flex';
  // Скидаємо поля
  document.getElementById('newIntegratedElementType').value = '';
  document.getElementById('newIntegratedElementQuantity').value = '1';
}

function closeAddIntegratedElementModal() {
  document.getElementById('addIntegratedElementModal').style.display = 'none';
}

function addIntegratedElement() {
  const type = document.getElementById("newIntegratedElementType").value;
  const quantity = parseInt(document.getElementById("newIntegratedElementQuantity").value) || 1;
  
  if (!type) {
    alert('Будь ласка, виберіть тип елемента');
    return;
  }

  const typeNames = {
    "technical_hatch": "Люк технічний (ревізійний, електро - тощо)",
    "appliances": "Техніка (пралка, сушка, сейф, винина шафа тощо)"
  };

  const typeName = typeNames[type] || type;
  
  const integratedElementsList = document.getElementById("integratedElementsList");
  const elementId = `integratedElement_${Date.now()}`;
  
  // Створюємо новий елемент
  const elementDiv = document.createElement("div");
  elementDiv.id = elementId;
  elementDiv.style.cssText = "padding: 4px 0; margin-bottom: 3px;";
  elementDiv.setAttribute('data-type', type);
  elementDiv.setAttribute('data-quantity', quantity);
  
  elementDiv.innerHTML = `
    <div style="display: flex; align-items: center; gap: 10px; font-size: 14px;">
      <span class="integrated-element-number"></span>. ${typeName}
      <input type="number" id="quantity_${elementId}" value="${quantity}" min="1" onchange="updateIntegratedElementQuantity('${elementId}')" style="width: 100px; padding: 5px; border: 1px solid #ccc; border-radius: 4px;">
      <button onclick="removeIntegratedElement('${elementId}')" class="remove-btn" title="Видалити" style="background: #ef4444; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer;">×</button>
    </div>
  `;
  
  integratedElementsList.appendChild(elementDiv);
  
  // Оновлюємо нумерацію
  updateIntegratedElementNumbers();
  
  // Закриваємо модальне вікно
  closeAddIntegratedElementModal();
}

function updateIntegratedElementNumbers() {
  const integratedElementsList = document.getElementById("integratedElementsList");
  const elements = integratedElementsList.querySelectorAll('[id^="integratedElement_"]');
  
  elements.forEach((element, index) => {
    const numberSpan = element.querySelector('.integrated-element-number');
    if (numberSpan) {
      numberSpan.textContent = index + 1;
    }
  });
}

function updateIntegratedElementQuantity(elementId) {
  const element = document.getElementById(elementId);
  const quantityInput = element.querySelector('input[type="number"]');
  const newQuantity = parseInt(quantityInput.value) || 1;
  element.setAttribute('data-quantity', newQuantity);
}

function removeIntegratedElement(elementId) {
  const element = document.getElementById(elementId);
  if (element) {
    element.remove();
    updateIntegratedElementNumbers();
  }
}

// Функції для підсвітки
function showAddLightingModal() {
  document.getElementById('addLightingModal').style.display = 'flex';
}

function closeAddLightingModal() {
  document.getElementById('addLightingModal').style.display = 'none';
  document.getElementById('newLightingType').value = '';
  document.getElementById('newLightingQuantity').value = '1';
}

function addLighting() {
  const lightingType = document.getElementById("newLightingType").value;
  const quantity = parseInt(document.getElementById("newLightingQuantity").value) || 1;
  
  if (!lightingType) {
    alert('Будь ласка, виберіть тип підсвітки');
    return;
  }

  const lightingNames = {
    "light_elements": "Елементів (деталей) з підсвіткою",
    "light_control": "Пристроїв керування і вимірюються в кількостях"
  };

  const displayName = lightingNames[lightingType] || lightingType;
  const lightingList = document.getElementById("lightingList");
  
  // Перевіряємо, чи вже існує такий тип підсвітки
  const existingLighting = document.getElementById(`lighting_${lightingType}`);
  if (existingLighting) {
    // Якщо існує, оновлюємо кількість
    existingLighting.setAttribute('data-quantity', quantity);
    const quantityInput = existingLighting.querySelector('input[type="number"]');
    if (quantityInput) {
      quantityInput.value = quantity;
    }
  } else {
    // Якщо не існує, створюємо новий
    const lightingDiv = document.createElement("div");
    lightingDiv.id = `lighting_${lightingType}`;
    lightingDiv.style.cssText = "padding: 4px 0; margin-bottom: 3px;";
    lightingDiv.setAttribute('data-type', lightingType);
    lightingDiv.setAttribute('data-quantity', quantity);
    
    lightingDiv.innerHTML = `
      <div style="display: flex; align-items: center; gap: 10px; font-size: 14px;">
        <span class="lighting-number"></span>. ${displayName}
        <input type="number" id="quantity_${lightingDiv.id}" value="${quantity}" min="1" onchange="updateLightingQuantity('${lightingDiv.id}')" style="width: 100px; padding: 5px; border: 1px solid #ccc; border-radius: 4px;">
        <button onclick="removeLighting('lighting_${lightingType}')" class="remove-btn" title="Видалити" style="background: #ef4444; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer;">×</button>
      </div>
    `;
    
    lightingList.appendChild(lightingDiv);
  }
  
  // Оновлюємо нумерацію
  updateLightingNumbers();
  
  // Закриваємо модальне вікно
  closeAddLightingModal();
  
}

function updateLightingNumbers() {
  const lightingList = document.getElementById("lightingList");
  const lightings = lightingList.querySelectorAll('[id^="lighting_"]');
  
  lightings.forEach((lighting, index) => {
    const numberSpan = lighting.querySelector('.lighting-number');
    if (numberSpan) {
      numberSpan.textContent = `${index + 1}`;
    }
  });
}

function updateLightingQuantity(elementId) {
  const element = document.getElementById(elementId);
  if (element) {
    const quantity = parseInt(element.querySelector('input[type="number"]').value) || 1;
    element.setAttribute('data-quantity', quantity);
  }
}

function removeLighting(elementId) {
  const element = document.getElementById(elementId);
  if (element) {
    element.remove();
    updateLightingNumbers();
    
    // Автоматично зберігаємо налаштування
    saveSettings();
  }
}

function toggleLightingFields() {
  const hasLighting = document.getElementById("hasLighting").value;
  const fields = document.getElementById("lightingFields");
  const addButton = document.getElementById("addLightingBtn");
  
  if (hasLighting === "yes") {
    fields.classList.remove("hidden");
    addButton.classList.remove("hidden");
  } else {
    fields.classList.add("hidden");
    addButton.classList.add("hidden");
    // Очищаємо список підсвітки
    document.getElementById("lightingList").innerHTML = "";
  }
  
}

function getSettingValue(id) {
  // Використовуємо глобальну константу POINT_VALUES з початку коду
  return POINT_VALUES[id] || 1;
}

function valInt(id) {
  const el = document.getElementById(id);
  if (!el) return 0;
  const v = parseInt(el.value);
  return (Number.isFinite(v) && v > 0) ? v : 0;
}

function valYes(id) {
  const el = document.getElementById(id);
  if (!el) return false;
  if (el.type === "checkbox") return !!el.checked;
  const v = (el.value || "").toString().trim().toLowerCase();
  return v === "так" || v === "yes" || v === "1" || v === "true";
}

let points = 0; // Глобальна змінна для накопичення балів

function addDetail(label, count, tariffId) {
  if (!count || count <= 0) return;
  const t = getSettingValue(tariffId);
  if (!t || t <= 0) return;
  const addedPoints = count * t;
  points += addedPoints;
  console.log(`${label}: ${count} × ${t} = ${addedPoints} (загалом: ${points})`);
}

function checkRequiredFields() {
  const missing = [];
  
  console.log("=== Початок перевірки полів ===");
  
  // 1. Основні параметри
  if (addedProducts.length === 0) {
    missing.push("1. Вид виробу");
  }
  if (!document.getElementById("productShape")?.value) {
    missing.push("1. Форма виробу");
  }
  // Поле "measure" необов'язкове, оскільки є опція "Без замірів"
  if (!document.getElementById("geom")?.value) {
    missing.push("1. Нестандартна геометрія приміщення");
  }
  
  // 2. Тип конструкції - перевіряємо динамічні типи конструкції
  if (typeof addedConstructionTypes !== 'undefined' && addedConstructionTypes.length === 0) {
    missing.push("2. Тип конструкції (не додано жодного)");
  }
  
  // 3. Матеріали панелей - перевіряємо динамічні матеріали
  const hasMaterials = document.getElementById("hasFacadeMaterials");
  if (!hasMaterials || !hasMaterials.value) {
    missing.push("3. Матеріали панелей (вибір)");
  } else if (hasMaterials.value === "yes") {
    if (typeof addedFacadeMaterials !== 'undefined' && addedFacadeMaterials.length === 0) {
      missing.push("3. Матеріали панелей (не додано жодного)");
    }
  }
  
  // 4. Додаткові елементи - конструкції - всі поля необов'язкові (можуть бути 0)
  // Перевіряємо тільки наявність полів, але не вимагаємо їх заповнення
  
  // 5. Інтегровані елементи
  const hasIntegratedElements = document.getElementById("hasIntegratedElements");
  if (!hasIntegratedElements || !hasIntegratedElements.value) {
    missing.push("5. Інтегровані елементи (вибір)");
  } else if (hasIntegratedElements.value === "yes") {
    const integratedElements = document.querySelectorAll('[id^="integratedElement_"]');
    if (integratedElements.length === 0) {
      missing.push("5. Інтегровані елементи (не додано жодного)");
    }
  }
  
  // 6. Підсвітка - перевіряємо динамічну підсвітку
  const hasLighting = document.getElementById("hasLighting");
  if (!hasLighting || !hasLighting.value) {
    missing.push("6. Підсвітка (вибір)");
  } else if (hasLighting.value === "yes") {
    const lights = document.querySelectorAll('[id^="lighting_"]');
    if (lights.length === 0) {
      missing.push("6. Підсвітка (не додано жодного типу)");
    }
  }
  
  console.log("=== Кінець перевірки полів ===");
  console.log("Всього відсутніх полів:", missing.length);
  console.log("Список відсутніх полів:", missing);
  
  return missing;
}

function showMissingFieldsWarning(missingFields) {
  let warningText = "Не заповнені наступні поля:\n\n";
  missingFields.forEach((field) => {
    warningText += `${field}\n`;
  });
  
  document.getElementById("warningText").innerText = warningText;
  document.getElementById("warningModal").style.display = "flex";
}

function closeModal() {
  document.getElementById("warningModal").style.display = "none";
}

function saveData() {
  try {
    // Збираємо всі дані форми
    const formData = {};
    document.querySelectorAll('input, select, textarea').forEach(el => {
      if (el.id && !el.closest('#settingsModal')) {
        const value = el.type === 'checkbox' || el.type === 'radio' ? el.checked : el.value;
        formData[el.id] = value;
      }
    });
    
    // Додаємо динамічні списки
    const dynamicData = {};
    
    // Матеріали
    const materials = document.querySelectorAll('[id^="facadeMaterial_"]');
    materials.forEach(material => {
      const materialType = material.getAttribute('data-material-type');
      if (materialType) {
        dynamicData[`material_${materialType}`] = {
          type: materialType,
          quantity: material.getAttribute('data-quantity') || 1
        };
      }
    });
        
    // Додаткові елементи
    const elements = document.querySelectorAll('[id^="additionalElement_"]');
    elements.forEach(element => {
      const elementType = element.getAttribute('data-element-type');
      const quantity = element.getAttribute('data-quantity') || 1;
      if (elementType) {
        dynamicData[`element_${elementType}`] = {
          type: elementType,
          quantity
        };
      }
    });
    
    // Ручки
    const handles = document.querySelectorAll('[id^="handle_"]');
    handles.forEach(handle => {
      const handleType = handle.getAttribute('data-handle-type');
      if (handleType) {
        dynamicData[`handle_${handleType}`] = {
          type: handleType
        };
      }
    });
    
    // Просто додаємо newHandleType в dynamic, якщо hasHandles = "yes"
    if (formData.hasHandles === "yes" && formData.newHandleType) {
      console.log('Додаємо ручку в dynamic:', formData.newHandleType);
      dynamicData[`handle_${formData.newHandleType}`] = {
        type: formData.newHandleType
      };
    }
    
    // Підсвітка
    const lightings = document.querySelectorAll('[id^="lighting_"]');
    lightings.forEach(lighting => {
      const lightingType = lighting.getAttribute('data-type');
      const quantity = lighting.getAttribute('data-quantity') || 1;
      if (lightingType) {
        dynamicData[`lighting_${lightingType}`] = {
          type: lightingType,
          quantity
        };
      }
    });
    
    // Додаємо метадані
    const data = {
      meta: {
        kind: 'viyar-other-furniture-calc',
        version: '1.6',
        timestamp: new Date().toISOString(),
        title: document.getElementById('productName')?.value || 'Інші меблі'
      },
      values: formData,
      dynamic: dynamicData
    };
    
    // Створюємо та завантажуємо файл
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    
    // Генеруємо назву файлу з усіма необхідними полями
    const projectNum = document.getElementById('projectNum')?.value || 'Без_номера';
    const productName = document.getElementById('productName')?.value || 'Без_назви';
    const manager = document.getElementById('manager')?.value || 'Без_менеджера';
    const date = document.getElementById('dateField')?.value || new Date().toLocaleDateString('uk-UA');
    
    // Очищаємо назви від спеціальних символів
    const cleanProjectNum = projectNum.replace(/[^a-zA-Z0-9а-яА-Я]/gi, '_');
    const cleanProductName = productName.replace(/[^a-zA-Z0-9а-яА-Я]/gi, '_');
    const cleanManager = manager.replace(/[^a-zA-Z0-9а-яА-Я]/gi, '_');
    const cleanDate = date.replace(/[^a-zA-Z0-9а-яА-Я]/gi, '_');
    
    a.download = `Калькулятор_${cleanProjectNum}_${cleanProductName}_${cleanManager}_${cleanDate}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    alert('Дані збережено успішно!');
  } catch (error) {
    console.error('Помилка збереження:', error);
    alert('Помилка збереження даних');
  }
}

function loadData() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.json,.vcalc.json';
  
  input.onchange = function(e) {
    const file = e.target.files && e.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = function(ev) {
      try {
        const data = JSON.parse(ev.target.result);
        if (data && data.values) {
          // Застосовуємо збережені дані
          Object.keys(data.values).forEach(key => {
            const element = document.getElementById(key);
            if (element) {
              if (element.type === 'checkbox' || element.type === 'radio') {
                element.checked = data.values[key];
              } else {
                element.value = data.values[key];
              }
            }
          });
          
          // Викликаємо функції для оновлення динамічних полів
          if (data.values.hasHandles) {
            toggleHandlesFields();
          }
          
          // --- Додаткове завантаження ручок (мінімальне виправлення) ---
          if (data.values.hasHandles === "yes") {
            // Шукаємо селектор або блок ручок, якщо він є
            const handleSelect = document.getElementById("newHandleType");

            // Якщо є випадаючий список типу ручок — підставляємо значення
            if (handleSelect && data.values.newHandleType) {
              handleSelect.value = data.values.newHandleType;
            }
          }
          
          // Відновлюємо динамічні списки
          if (data.dynamic) {
            // Очищуємо існуючі динамічні списки
               document.getElementById('facadeMaterialsList').innerHTML = '';
               document.getElementById('additionalElementsList').innerHTML = '';
               document.getElementById('handlesList').innerHTML = '';
               document.getElementById('lightingList').innerHTML = '';
            // Відновлюємо матеріали
            Object.keys(data.dynamic).forEach(key => {
              if (key.startsWith('material_')) {
                const materialData = data.dynamic[key];
                addMaterialFromLoad(materialData.type, materialData.quantity);
              }
            });
                        // Відновлюємо матеріали
                        Object.keys(data.dynamic).forEach(key => {
              if (key.startsWith('material_')) {
                const materialData = data.dynamic[key];
                console.log('Відновлюємо матеріал:', materialData);
                addMaterialFromLoad(materialData.type, materialData.quantity);
              }
            });
                        
            // Відновлюємо додаткові елементи
            Object.keys(data.dynamic).forEach(key => {
              if (key.startsWith('element_')) {
                const elementData = data.dynamic[key];
                addElementFromLoad(elementData.type, elementData.quantity);
              }
            });
            
            // Відновлюємо ручки
            Object.keys(data.dynamic).forEach(key => {
              if (key.startsWith('handle_')) {
                const handleData = data.dynamic[key];
                addHandleFromLoad(handleData.type);
              }
            });
            
            // Відновлюємо підсвітку
            Object.keys(data.dynamic).forEach(key => {
              if (key.startsWith('lighting_')) {
                const lightingData = data.dynamic[key];
                addLightingFromLoad(lightingData.type, lightingData.quantity);
              }
            });
          }
                                  // Показуємо поля матеріалів якщо є дані
            const hasMaterials = Object.keys(data.dynamic).some(key => key.startsWith('material_'));
            if (hasMaterials) {
              document.getElementById('hasFacadeMaterials').value = 'yes';
              document.getElementById('facadeMaterialsFields').classList.remove('hidden');
              document.getElementById('addFacadeMaterialBtn').classList.remove('hidden');
            }
            
            // Показуємо поля додаткових елементів якщо є дані
            const hasElements = Object.keys(data.dynamic).some(key => key.startsWith('element_'));
            if (hasElements) {
              document.getElementById('hasAdditionalElements').value = 'yes';
              // Для додаткових елементів немає окремого контейнера полів
              document.getElementById('addAdditionalElementBtn').style.display = 'inline-block';
            }
            
            // Показуємо поля ручок якщо є дані
            const hasHandles = Object.keys(data.dynamic).some(key => key.startsWith('handle_'));
            if (hasHandles) {
              document.getElementById('hasHandles').value = 'yes';
              document.getElementById('handlesFields').classList.remove('hidden');
              document.getElementById('addHandleBtn').classList.remove('hidden');
            }
            
            // Показуємо поля підсвітки якщо є дані
            const hasLighting = Object.keys(data.dynamic).some(key => key.startsWith('lighting_'));
            if (hasLighting) {
              document.getElementById('hasLighting').value = 'yes';
              document.getElementById('lightingFields').classList.remove('hidden');
              document.getElementById('addLightingBtn').classList.remove('hidden');
            }
          
          alert('Дані завантажено успішно!');
        }
      } catch (error) {
        console.error('Помилка завантаження:', error);
        alert('Помилка завантаження файлу');
      }
    };
    reader.readAsText(file);
  };
  
  input.click();
}


// Функції для відновлення динамічних елементів при завантаженні
function addMaterialFromLoad(materialType, quantity) {
  const materialNames = {
    "dsp_mat_corpus": "ДСП мат. корпусу",
    "dsp": "ДСП", 
    "mdf_boards": "МДФ плити",
    "paint_film_straight": "Фарба/плівка \"прямі\"",
    "paint_film_milled": "Фарба/плівка \"фрезеровані\"",
    "veneered_straight": "Шпоновані \"прямі\"",
    "veneered_milled": "Шпоновані \"фрезеровані\"",
    "aluminum_frame": "Алюм. рамкові",
    "arpa_fenix": "ARPA/Fenix",
    "fiushin": "Fiushin",
    "hpl": "HPL",
    "rd_facades_individual": "R&D фасади індивід.",
    "mdf_facades_individual_milling": "МДФ фасади з індивідуальним фрезеруванням"
  };
  
  const displayName = materialNames[materialType] || materialType;
  const materialsList = document.getElementById("facadeMaterialsList");
  
  const materialDiv = document.createElement("div");
  materialDiv.id = `material_${materialType}`;
  materialDiv.style.cssText = "padding: 4px 0; margin-bottom: 3px;";
  materialDiv.setAttribute('data-material-type', materialType);
  materialDiv.setAttribute('data-quantity', quantity);
  
  materialDiv.innerHTML = `
    <div style="display: flex; align-items: center; gap: 10px; font-size: 14px;">
      <span class="material-number"></span>. ${displayName}
      <button onclick="removeMaterial('material_${materialType}')" class="remove-btn" title="Видалити" style="background: #ef4444; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer;">×</button>
    </div>
  `;
  
  materialsList.appendChild(materialDiv);
  updateMaterialNumbers();
}

function addElementFromLoad(elementType, quantity) {
  const elementNames = {
    "metal_frame": "Металоконструкція рамкова",
    "metal_volume": "Металоконструкція об'ємна",
    "rd_detail": "Деталь R&D, гнутий елемент тощо",
    "false_horizontal": "Фальш панелі горизонтальні",
    "false_vertical": "Фальш панелі вертикальні"
  };
  
  const displayName = elementNames[elementType] || elementType;
  const elementsList = document.getElementById("additionalElementsList");
  
  const elementDiv = document.createElement("div");
  elementDiv.id = `additionalElement_${elementType}`;
  elementDiv.style.cssText = "padding: 4px 0; margin-bottom: 3px;";
  elementDiv.setAttribute('data-element-type', elementType);
  elementDiv.setAttribute('data-quantity', quantity);
  
  elementDiv.innerHTML = `
    <div style="display: flex; align-items: center; gap: 10px; font-size: 14px;">
      <span class="element-number"></span>. ${displayName}
      <input type="number" id="quantity_${elementDiv.id}" value="${quantity}" min="1" onchange="updateElementQuantity('${elementDiv.id}')" style="width: 100px; padding: 5px; border: 1px solid #ccc; border-radius: 4px;">
      <button onclick="removeElement('additionalElement_${elementType}')" class="remove-btn" title="Видалити" style="background: #ef4444; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer;">×</button>
    </div>
  `;
  
  elementsList.appendChild(elementDiv);
  updateElementNumbers();
}

function addHandleFromLoad(handleType) {
  const handleNames = {
    "handles_gola": "GOLA",
    "handles_end": "Торцеві",
    "handles_milled": "Фрезеровані",
    "handles_other": "Інші"
  };
  
  const displayName = handleNames[handleType] || handleType;
  const handlesList = document.getElementById("handlesList");
  
  const handleDiv = document.createElement("div");
  handleDiv.id = `handle_${handleType}`;
  handleDiv.style.cssText = "padding: 4px 0; margin-bottom: 3px;";
  handleDiv.setAttribute('data-type', handleType);
  
  handleDiv.innerHTML = `
    <div style="display: flex; align-items: center; gap: 10px; font-size: 14px;">
      <span class="handle-number"></span>. ${displayName}
      <button onclick="removeHandle('handle_${handleType}')" class="remove-btn" title="Видалити" style="background: #ef4444; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer;">×</button>
    </div>
  `;
  
  handlesList.appendChild(handleDiv);
  updateHandleNumbers();
}

function addLightingFromLoad(lightingType, quantity) {
  const lightingNames = {
    "light_elements": "Елементів (деталей) з підсвіткою",
    "light_control": "Пристроїв керування і вимірюються в кількостях"
  };
  
  const displayName = lightingNames[lightingType] || lightingType;
  const lightingList = document.getElementById("lightingList");
  
  const lightingDiv = document.createElement("div");
  lightingDiv.id = `lighting_${lightingType}`;
  lightingDiv.style.cssText = "padding: 4px 0; margin-bottom: 3px;";
  lightingDiv.setAttribute('data-type', lightingType);
  lightingDiv.setAttribute('data-quantity', quantity);
  
  lightingDiv.innerHTML = `
    <div style="display: flex; align-items: center; gap: 10px; font-size: 14px;">
      <span class="lighting-number"></span>. ${displayName}
      <input type="number" id="quantity_${lightingDiv.id}" value="${quantity}" min="1" onchange="updateLightingQuantity('${lightingDiv.id}')" style="width: 100px; padding: 5px; border: 1px solid #ccc; border-radius: 4px;">
      <button onclick="removeLighting('lighting_${lightingType}')" class="remove-btn" title="Видалити" style="background: #ef4444; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer;">×</button>
    </div>
  `;
  
  lightingList.appendChild(lightingDiv);
  updateLightingNumbers();
}

// Функція очищення форми
function clearForm() {
  if (confirm('Ви впевнені, що хочете очистити всі дані?')) {
    // Очищуємо всі поля вводу
    document.querySelectorAll("input, select, textarea").forEach(el => {
      if (el.id !== "dateField" && !el.closest('#settingsModal')) {
        if (el.type === 'checkbox' || el.type === 'radio') {
          el.checked = false;
        } else {
          el.value = "";
        }
      }
    });
    
    // Очищуємо динамічні списки
    document.getElementById("materialsList").innerHTML = "";
    document.getElementById("additionalElementsList").innerHTML = "";
    document.getElementById("handlesList").innerHTML = "";
    document.getElementById("lightingList").innerHTML = "";
    
    // Приховуємо поля динамічних розділів
    document.getElementById("materialsFields").classList.add("hidden");
    document.getElementById("additionalElementsFields").classList.add("hidden");
    document.getElementById("handlesFields").classList.add("hidden");
    document.getElementById("lightingFields").classList.add("hidden");
    
    // Скидаємо селекти на "no"
    document.getElementById("hasMaterials").value = "no";
    document.getElementById("hasElements").value = "no";
    document.getElementById("hasHandles").value = "no";
    document.getElementById("hasLighting").value = "no";
    
    // Приховуємо лічильник поінтів
    document.getElementById("pointsHUD").style.display = "none";
    
    alert('Форма очищена!');
  }
}

function calculate() {
  // Перевіряємо, чи всі обов'язкові поля заповнені
  const missingFields = checkRequiredFields();
  
  if (missingFields.length > 0) {
    showMissingFieldsWarning(missingFields);
    return;
  }
  
  points = 0; // Скидаємо глобальну змінну
  
  // ===== 1. Основні параметри =====
  (function(){
    // Динамічні вироби - стінові панелі
    addedProducts.forEach(product => {
      const productNames = {
        "Стінові панелі": "Стінові панелі",
        "Стельові панелі": "Стельові панелі",
        "Колони": "Колони",
        "Панелі до стелі": "Панелі до стелі",
        "Перегородки рейкові": "Перегородки рейкові"
      };
      
      const productName = productNames[product.type] || product.type;
      
      // Мапа для правильного відображення ID полів
      const productIdMap = {
        "Стінові панелі": "p_product_стінові_панелі",
        "Стельові панелі": "p_product_стельові_панелі",
        "Колони": "p_product_колони",
        "Панелі до стелі": "p_product_панелі_до_стелі",
        "Перегородки рейкові": "p_product_перегородки_рейкові"
      };
      
      const productId = productIdMap[product.type] || `p_product_${product.type.replace(/\s+/g, '_').toLowerCase()}`;
      addDetail(`Вид виробу: ${productName}`, product.quantity, productId);
    });
  })();
  
 // ===== Форма виробу =====
 (function(){
    const productShape = document.getElementById("productShape")?.value;
    if (productShape) {
      const shapeMap = {
        "Пряма": "p_shape_straight",
        "Кутова": "p_shape_corner", 
        "П-подібна": "p_shape_u",
        "G-по периметру": "p_shape_g"
      };
      const shapeId = shapeMap[productShape];
      if (shapeId) {
        addDetail(`Форма виробу: ${productShape}`, 1, shapeId);
      }
    }
  })();
  
  // ===== Заміри =====
  (function(){
    const measure = document.getElementById("measure")?.value;
    if (measure) {
      const measureMap = {
        "Без замірів": "p_measure_no",
        "По замірам 3D": "p_measure_3d", 
        "По замірам фото-ескіз": "p_measure_photo"
      };
      const measureId = measureMap[measure];
      if (measureId) {
        addDetail(`Заміри: ${measure}`, 1, measureId);
      }
    }
  })();
  
  // ===== Додаткові параметри =====
  (function(){
    const geometry = document.getElementById("geom")?.value;
    if (geometry === "Так") {
      addDetail("Нестандартна геометрія приміщення", 1, "p_geometry");
    }
    
    
    const corpus = valInt("corpus");
    if (corpus > 0) {
      addDetail("Матеріал корпусу (шт.)", corpus, "p_corpus");
    }
    
    const glass = document.getElementById("glassSelect")?.value;
    if (glass === "Так") {
      addDetail("Скло-дзеркало", 1, "p_glass");
    }
  })();
  
  // ===== 2. Тип конструкції =====
  (function(){
    // Динамічні типи конструкції
    if (typeof addedConstructionTypes !== 'undefined') {
      addedConstructionTypes.forEach(constructionType => {
        const typeNames = {
          'solid': 'Суцільні',
          'framed': 'Каркасні',
          'profiled': 'Профільні панелі (AGT)',
          'slatted': 'Рейкові',
          'modular': 'Модульні',
          'individual': 'Панель індивідуальна R&D'
        };
        
        const typeName = typeNames[constructionType.type] || constructionType.type;
        let pointId = `p_construction_${constructionType.type}`;
        
        // Для R&D панелей враховуємо додаткові характеристики
        if (constructionType.type === 'individual' && constructionType.rdType) {
          pointId = `p_construction_individual_${constructionType.rdType}`;
        }
        
        addDetail(`Тип конструкції: ${typeName}`, constructionType.quantity, pointId);
      });
    }
    
    // Тип монтажу
    const installationType = document.getElementById("installationType")?.value;
    if (installationType) {
      const installationNames = {
        "mechanical": "Механічний монтаж",
        "adhesive": "Клейовий монтаж"
      };
      const installationName = installationNames[installationType] || installationType;
      addDetail(`Тип монтажу: ${installationName}`, 1, `p_installation_${installationType}`);
    }
  })();
  
  // ===== 3. Матеріали панелей =====
  (function(){
    // Динамічні матеріали панелей
    if (typeof addedFacadeMaterials !== 'undefined') {
      addedFacadeMaterials.forEach(material => {
        const materialNames = {
          "dsp": "ДСП",
          "mdf_boards": "МДФ плити",
          "paint_straight": "Фарба/плівка \"прямі\"",
          "paint_milled": "Фарба/плівка \"фрезеровані\"",
          "veneered_straight": "Шпоновані \"прямі\"",
          "veneered_milled": "Шпоновані \"фрезеровані\"",
          "aluminum_frame": "Алюм. рамкові",
          "arpa_fenix": "ARPA/Fenix",
          "hpl": "HPL",
          "rd_individual": "R&D фасади індивід.",
          "mdf_individual": "МДФ фасади з індивідуальним фрезеруванням",
          "mirror": "Дзеркало",
          "glass": "Скло",
          "quartzite": "Кварцит-керамограніт-мрамор"
        };
        
        const materialName = materialNames[material.type] || material.type;
        let pointId = `p_material_${material.type}`;
        
        // Додаємо поінти за текстуру/фрезерування
        if (material.textureType && material.textureType !== 'none') {
          const texturePointId = `p_texture_${material.textureType}`;
          addDetail(`Текстура: ${material.textureType}`, 1, texturePointId);
        }
        
        addDetail(`Матеріал панелі: ${materialName}`, material.quantity, pointId);
      });
    }
  })();
   
  // ===== 4. Додаткові елементи - конструкції =====
  (function(){
    // Ревізійні дверки/лючки
    const revisionDoors = valInt("furnRevisionDoors");
    if (revisionDoors > 0) {
      addDetail("Ревізійні дверки/лючки", revisionDoors, "p_furn_revision_doors");
    }
    
    // Наявність розпашної двері як частина стінпанелей
    const swingDoor = valInt("furnSwingDoor");
    if (swingDoor > 0) {
      addDetail("Наявність розпашної двері як частина стінпанелей", swingDoor, "p_furn_swing_door");
    }
    
    // Стиковка панелей з дверним блоком прихованого монтажу
    const doorBlockConnection = valInt("furnDoorBlockConnection");
    if (doorBlockConnection > 0) {
      addDetail("Стиковка панелей з дверним блоком прихованого монтажу", doorBlockConnection, "p_furn_door_block_connection");
    }
    
    // Обшивка проему дверного
    const doorOpening = valInt("furnDoorOpening");
    if (doorOpening > 0) {
      addDetail("Обшивка проему дверного", doorOpening, "p_furn_door_opening");
    }
    
    // Обшивка проему віконного
    const windowOpening = valInt("furnWindowOpening");
    if (windowOpening > 0) {
      addDetail("Обшивка проему віконного", windowOpening, "p_furn_window_opening");
    }
    
    // Елемент дверної накладки
    const doorOverlay = valInt("furnDoorOverlay");
    if (doorOverlay > 0) {
      addDetail("Елемент дверної накладки", doorOverlay, "p_furn_door_overlay");
    }
    
    // Накладні елементи (молдинги, декри - тощо)
    const overlayElements = valInt("furnOverlayElements");
    if (overlayElements > 0) {
      addDetail("Накладні елементи (молдинги, декри - тощо)", overlayElements, "p_furn_overlay_elements");
    }
    
    // Розшивки/стиковочні планки-профілі
    const expansionStrips = valInt("furnExpansionStrips");
    if (expansionStrips > 0) {
      addDetail("Розшивки/стиковочні планки-профілі", expansionStrips, "p_furn_expansion_strips");
    }
    
    // Вирізи в дзеркальних панелях
    const mirrorCutouts = valInt("furnMirrorCutouts");
    if (mirrorCutouts > 0) {
      addDetail("Вирізи в дзеркальних панелях", mirrorCutouts, "p_furn_mirror_cutouts");
    }
  })();
  
  
  // ===== 5. Інтегровані елементи =====
  (function(){
    const integratedElements = document.querySelectorAll('[id^="integratedElement_"]');
    console.log('Знайдено інтегрованих елементів:', integratedElements.length);
    integratedElements.forEach(element => {
      const elementType = element.getAttribute('data-type');
      const quantity = parseInt(element.getAttribute('data-quantity')) || 1;
      
      console.log('Обробляємо інтегрований елемент:', elementType, 'кількість:', quantity);
      
      const elementNames = {
        "technical_hatch": "Люк технічний (ревізійний, електро - тощо)",
        "appliances": "Техніка (пралка, сушка, сейф, винина шафа тощо)"
      };
      
      const elementName = elementNames[elementType] || elementType;
      addDetail(`Інтегрований елемент: ${elementName}`, quantity, `p_integrated_${elementType}`);
    });
  })();
  
  
  // ===== 6. Підсвітка =====
  (function(){
    const lightings = document.querySelectorAll('[id^="lighting_"]');
    lightings.forEach(lighting => {
      const lightingType = lighting.getAttribute('data-type');
      const quantity = parseInt(lighting.getAttribute('data-quantity')) || 1;
      
      const lightingNames = {
        "light_elements": "Елементів (деталей) з підсвіткою",
        "light_control": "Пристроїв керування і вимірюються в кількостях"
      };
      
      const lightingName = lightingNames[lightingType] || lightingType;
      addDetail(`Підсвітка: ${lightingName}`, quantity, `p_lighting_${lightingType}`);
    });
  })();
  
  // ===== Додаємо постійне значення =====
  const constantValue = parseFloat(document.getElementById('constant_value')?.value || 0);
  if (constantValue !== 0) {
    points += constantValue;
    console.log(`Постійне значення: ${constantValue} (загалом: ${points})`);
  }
  
  // Показуємо результат
  document.getElementById('pointsHUD').style.display = 'inline-block';
  document.getElementById('pointsHUD').textContent = `Поінти: ${points}`;
  
  return points;
}



// Функція для завантаження PDF
async function downloadPDF() {
  try {
    // Показуємо індикатор завантаження
    const button = document.querySelector('button[onclick="downloadPDF()"]');
    const originalText = button.textContent;
    button.textContent = 'Генеруємо PDF...';
    button.disabled = true;
    
    // Імпортуємо html2canvas
    const html2canvas = window.html2canvas;
    const jsPDF = window.jspdf.jsPDF;
    
    // Отримуємо елемент для конвертації
    const element = document.querySelector('.wrapper');
    
    // Конвертуємо в canvas
    const canvas = await html2canvas(element, {
      scale: 2, // Вища якість
      useCORS: true,
      allowTaint: true,
      backgroundColor: '#ffffff',
      width: element.scrollWidth,
      height: element.scrollHeight
    });
    
    // Створюємо PDF
    const imgData = canvas.toDataURL('image/png');
    const pdf = new jsPDF('p', 'mm', 'a4');
    
    // Розраховуємо розміри для A4
    const pdfWidth = pdf.internal.pageSize.getWidth();
    const pdfHeight = pdf.internal.pageSize.getHeight();
    const imgWidth = canvas.width;
    const imgHeight = canvas.height;
    const ratio = Math.min(pdfWidth / imgWidth, pdfHeight / imgHeight);
    const imgX = (pdfWidth - imgWidth * ratio) / 2;
    const imgY = 0;
    
    // Додаємо зображення до PDF
    pdf.addImage(imgData, 'PNG', imgX, imgY, imgWidth * ratio, imgHeight * ratio);
    
    // Генеруємо назву файлу
    const projectNum = document.getElementById('projectNum').value || 'Без_номера';
    const productName = document.getElementById('productName').value || 'Без_назви';
    const date = document.getElementById('dateField').value || new Date().toLocaleDateString('uk-UA');
    const fileName = `Калькулятор_інші_меблі_${projectNum}_${productName}_${date}.pdf`;
    
    // Завантажуємо PDF
    pdf.save(fileName);
    
    // Повертаємо кнопку в початковий стан
    button.textContent = originalText;
    button.disabled = false;
    
  } catch (error) {
    console.error('Помилка при створенні PDF:', error);
    alert('Помилка при створенні PDF. Спробуйте ще раз.');
    
    // Повертаємо кнопку в початковий стан
    const button = document.querySelector('button[onclick="downloadPDF()"]');
    button.textContent = 'Завантажити PDF';
    button.disabled = false;
  }
}

// Функції для роботи з типами конструкції
function showAddConstructionTypeModal() {
  document.getElementById('addConstructionTypeModal').style.display = 'flex';
}

function closeAddConstructionTypeModal() {
  document.getElementById('addConstructionTypeModal').style.display = 'none';
  // Очищаємо поля
  document.getElementById('newConstructionType').value = '';
  document.getElementById('constructionTypeQuantity').value = '1';
  // Приховуємо додаткові характеристики
  document.getElementById('individualCharacteristics').style.display = 'none';
  // Очищаємо радіо-кнопки
  document.querySelectorAll('input[name="rdType"]').forEach(radio => {
    radio.checked = false;
  });
}

// Функція для показу/приховування додаткових характеристик R&D панелі
function toggleIndividualCharacteristics() {
  const constructionType = document.getElementById('newConstructionType').value;
  const characteristicsDiv = document.getElementById('individualCharacteristics');
  
  if (constructionType === 'individual') {
    characteristicsDiv.style.display = 'block';
  } else {
    characteristicsDiv.style.display = 'none';
  }
}

// Глобальний масив для зберігання доданих фасадних матеріалів
let addedFacadeMaterials = [];

// Функції для роботи з фасадними матеріалами
function showAddFacadeMaterialModal() {
  document.getElementById('addFacadeMaterialModal').style.display = 'flex';
}

function closeAddFacadeMaterialModal() {
  document.getElementById('addFacadeMaterialModal').style.display = 'none';
  // Очищаємо поля
  document.getElementById('newFacadeMaterial').value = '';
  document.getElementById('facadeMaterialQuantity').value = '1.0';
  // Приховуємо додаткові поля
  document.getElementById('textureFields').style.display = 'none';
  // Очищаємо додаткові поля
  document.getElementById('textureType').value = 'none';
}

function addFacadeMaterial() {
  const material = document.getElementById('newFacadeMaterial').value;
  const quantity = parseFloat(document.getElementById('facadeMaterialQuantity').value);
  
  if (!material) {
    alert('Будь ласка, виберіть матеріал панелі');
    return;
  }
  
  if (quantity < 0.1) {
    alert('Площа повинна бути не менше 0.1 м²');
    return;
  }
  
  const materialNames = {
    'dsp': 'ДСП',
    'mdf': 'МДФ плити',
    'paint_straight': 'Фарба/плівка "прямі"',
    'paint_milled': 'Фарба/плівка "фрезеровані"',
    'veneer_straight': 'Шпоновані "прямі"',
    'veneer_milled': 'Шпоновані "фрезеровані"',
    'aluminum': 'Алюм. рамкові',
    'arpa': 'ARPA/Fenix',
    'hpl': 'HPL',
    'rd_individual': 'R&D фасади індивід.',
    'mdf_individual': 'МДФ фасади з індивідуальним фрезеруванням',
    'mirror': 'Дзеркало',
    'glass': 'Скло',
    'quartzite': 'Кварцит-керамограніт-мрамор'
  };
  
  const materialName = materialNames[material] || material;
  
  // Збираємо додаткову інформацію про текстуру
  let additionalInfo = '';
  const textureType = document.getElementById('textureType').value;
  if (textureType && textureType !== 'none') {
    const textureNames = {
      'texture_selection': 'Підбір текстури',
      'milling_transition': 'Перехід фрезерування'
    };
    additionalInfo = ` (${textureNames[textureType]})`;
  }
  
  // Додаємо до масиву
  const newFacadeMaterial = {
    id: Date.now(),
    type: material,  // Зберігаємо технічний ID
    material: materialName + additionalInfo,  // Зберігаємо відображувану назву
    quantity: quantity,
    textureType: textureType
  };
  
  addedFacadeMaterials.push(newFacadeMaterial);
  renderFacadeMaterialsList();
  closeAddFacadeMaterialModal();
}

// Функція для відображення списку фасадних матеріалів
function renderFacadeMaterialsList() {
  const facadeMaterialsList = document.getElementById('facadeMaterialsList');
  
  if (addedFacadeMaterials.length === 0) {
    facadeMaterialsList.innerHTML = '<div style="color: #6b7280; font-style: italic;">Матеріалів панелей не додано</div>';
    return;
  }
  
  let html = '';
  addedFacadeMaterials.forEach((facadeMaterial, index) => {
    // Використовуємо збережену назву матеріалу
    const displayName = facadeMaterial.material;
    
    html += `
      <div style="display: flex; align-items: center; padding: 4px 0; margin-bottom: 3px;">
        <span style="font-size: 14px; margin-right: 8px;" title="${displayName}">${index + 1}. ${displayName}</span>
        <input type="number" 
               id="quantity_${facadeMaterial.id}" 
               value="${facadeMaterial.quantity}" 
               min="1" 
               style="width: 60px; padding: 2px 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 12px; margin-right: 4px;"
               onchange="updateFacadeMaterialQuantity(${facadeMaterial.id}, this.value)"
               onblur="updateFacadeMaterialQuantity(${facadeMaterial.id}, this.value)">
        <span style="font-size: 12px; color: #666; margin-right: 8px;">м²</span>
        <button onclick="removeFacadeMaterial(${facadeMaterial.id})" class="remove-btn" title="Видалити" style="background: #ef4444; color: white; border: none; padding: 2px 6px; border-radius: 3px; cursor: pointer; font-size: 12px;">×</button>
      </div>
    `;
  });
  
  facadeMaterialsList.innerHTML = html;
}

function updateFacadeMaterialQuantity(id, newQuantity) {
  const quantity = parseFloat(newQuantity);
  
  if (quantity < 0.1) {
    alert('Площа повинна бути не менше 0.1 м²');
    document.getElementById(`quantity_${id}`).value = '0.1';
    return;
  }
  
  // Оновлюємо в масиві
  const facadeMaterial = addedFacadeMaterials.find(fm => fm.id === id);
  if (facadeMaterial) {
    facadeMaterial.quantity = quantity;
  }
}

function removeFacadeMaterial(id) {
  // Видаляємо з масиву
  addedFacadeMaterials = addedFacadeMaterials.filter(fm => fm.id !== id);
  renderFacadeMaterialsList();
}

// Функція для показу/приховування полів фасадних матеріалів
function toggleFacadeMaterialsFields() {
  const hasFacadeMaterials = document.getElementById('hasFacadeMaterials').value;
  const facadeMaterialsFields = document.getElementById('facadeMaterialsFields');
  const addFacadeMaterialBtn = document.getElementById('addFacadeMaterialBtn');
  
  if (hasFacadeMaterials === 'yes') {
    facadeMaterialsFields.classList.remove('hidden');
    addFacadeMaterialBtn.classList.remove('hidden');
  } else {
    facadeMaterialsFields.classList.add('hidden');
    addFacadeMaterialBtn.classList.add('hidden');
  }
}

// Функція для показу/приховування полів текстури
function toggleTextureFields() {
  const material = document.getElementById('newFacadeMaterial').value;
  const textureFields = document.getElementById('textureFields');
  
  // Показуємо поля текстури для всіх матеріалів крім дзеркала та скла
  if (material && material !== 'mirror' && material !== 'glass') {
    textureFields.style.display = 'block';
  } else {
    textureFields.style.display = 'none';
  }
}


// Глобальний масив для зберігання доданих типів конструкції
let addedConstructionTypes = [];

function addConstructionType() {
  const type = document.getElementById('newConstructionType').value;
  const quantity = parseInt(document.getElementById('constructionTypeQuantity').value);
  
  if (!type) {
    alert('Будь ласка, виберіть тип конструкції');
    return;
  }
  
  if (quantity < 1) {
    alert('Кількість повинна бути більше 0');
    return;
  }
  
  const typeNames = {
    'solid': 'Суцільні',
    'framed': 'Каркасні',
    'profiled': 'Профільні панелі (AGT)',
    'slatted': 'Рейкові',
    'modular': 'Модульні',
    'individual': 'Панель індивідуальна R&D'
  };
  
  const typeName = typeNames[type] || type;
  
  // Збираємо додаткові характеристики для R&D панелі
  let additionalInfo = '';
  let selectedRdType = null;
  
  if (type === 'individual') {
    selectedRdType = document.querySelector('input[name="rdType"]:checked');
    if (!selectedRdType) {
      alert('Будь ласка, виберіть тип R&D панелі');
      return;
    }
    
    const rdTypeNames = {
      'simple': 'Просте',
      'complex': 'Складне',
      'development': 'Розробка нового'
    };
    additionalInfo = ` (${rdTypeNames[selectedRdType.value]})`;
  }
  
  // Додаємо до масиву
  const newConstructionType = {
    id: Date.now(),
    type: typeName + additionalInfo,
    quantity: quantity,
    originalType: type,
    additionalInfo: type === 'individual' ? {
      rdType: selectedRdType ? selectedRdType.value : null
    } : null
  };
  
  addedConstructionTypes.push(newConstructionType);
  renderConstructionTypesList();
  closeAddConstructionTypeModal();
}

// Функція для відображення списку типів конструкції
function renderConstructionTypesList() {
  const constructionTypesList = document.getElementById('constructionTypesList');
  
  if (addedConstructionTypes.length === 0) {
    constructionTypesList.innerHTML = '<div style="color: #6b7280; font-style: italic;">Типів конструкції не додано</div>';
    return;
  }
  
  let html = '';
  addedConstructionTypes.forEach((constructionType, index) => {
    html += `
      <div style="display: flex; align-items: center; padding: 4px 0; margin-bottom: 3px;">
        <span style="font-size: 14px; margin-right: 8px;" title="${constructionType.type}">${index + 1}. ${constructionType.type}</span>
        <input type="number" 
               id="quantity_${constructionType.id}" 
               value="${constructionType.quantity}" 
               min="1" 
               style="width: 60px; padding: 2px 4px; border: 1px solid #ccc; border-radius: 3px; font-size: 12px; margin-right: 4px;"
               onchange="updateConstructionTypeQuantity(${constructionType.id}, this.value)"
               onblur="updateConstructionTypeQuantity(${constructionType.id}, this.value)">
        <span style="font-size: 12px; color: #666; margin-right: 8px;">шт.</span>
        <button onclick="removeConstructionType(${constructionType.id})" class="remove-btn" title="Видалити" style="background: #ef4444; color: white; border: none; padding: 2px 6px; border-radius: 3px; cursor: pointer; font-size: 12px;">×</button>
      </div>
    `;
  });
  
  constructionTypesList.innerHTML = html;
}

function updateConstructionTypeQuantity(id, newQuantity) {
  const quantity = parseInt(newQuantity);
  
  if (quantity < 1) {
    alert('Кількість повинна бути не менше 1');
    document.getElementById(`quantity_${id}`).value = '1';
    return;
  }
  
  // Оновлюємо в масиві
  const constructionType = addedConstructionTypes.find(ct => ct.id === id);
  if (constructionType) {
    constructionType.quantity = quantity;
  }
}

function removeConstructionType(id) {
  // Видаляємо з масиву
  addedConstructionTypes = addedConstructionTypes.filter(ct => ct.id !== id);
  renderConstructionTypesList();
}


</script>
</body>
</html>
</html>